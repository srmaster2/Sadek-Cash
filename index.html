		<!DOCTYPE html>
		<html dir="rtl">
		  <head>
			<base target="_top">
			<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
			<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
			<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
			<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">  
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
			<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="stylesheet" href="styles.css">
<script src="config.js"></script>
<script src="utils.js" defer></script>
<script src="auth.js" defer></script>
<script src="accounts.js" defer></script>
<script src="transactions.js" defer></script>
<script src="reports.js" defer></script>
<script src="app.js" defer></script>
<script src="members.js"></script>			  
			<style>
      /* ØªÙ†Ø³ÙŠÙ‚ ØªØ¸Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ */
.profit-blur {
    filter: blur(5px); /* Ø¯Ø±Ø¬Ø© Ø§Ù„ØªØ¸Ù„ÙŠÙ„ */
    cursor: pointer;
    transition: filter 0.3s ease;
    user-select: none; /* Ù…Ù†Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ Ø¨Ø§Ù„Ø®Ø·Ø£ */
}

/* Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø£Ùˆ Ø§Ù„Ù†Ù‚Ø± (Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ¸Ù„ÙŠÙ„) */
.profit-blur.revealed {
    filter: blur(0);
}  
        /* --- ğŸš€ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ (Modern Nav Bar) --- */
.modern-nav-container {
    background: rgba(255, 255, 255, 0.6); /* Ø®Ù„ÙÙŠØ© Ù†ØµÙ Ø´ÙØ§ÙØ© */
    backdrop-filter: blur(12px); /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ Ø§Ù„Ø¶Ø¨Ø§Ø¨ÙŠ */	
    -webkit-backdrop-filter: blur(12px); /* Ø¯Ø¹Ù… Ù„Ù…ØªØµÙØ­ Ø³ÙØ§Ø±ÙŠ */
    border: 1px solid rgba(255, 255, 255, 0.4);
    border-radius: 20px; /* Ø­ÙˆØ§Ù Ø¯Ø§Ø¦Ø±ÙŠØ© Ù†Ø§Ø¹Ù…Ø© */
    padding: 6px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05); /* Ø¸Ù„ Ù†Ø§Ø¹Ù… */
    margin-bottom: 20px;
    position: sticky; /* ØªØ«Ø¨ÙŠØª Ø§Ù„Ø´Ø±ÙŠØ· Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) */
    top: 10px;
    z-index: 100;
}

.modern-nav-item {
    border-radius: 16px !important;
    color: var(--text-muted) !important;
    font-weight: 700;
    font-size: 11px;
    padding: 10px 5px !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid transparent;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.modern-nav-item i {
    font-size: 18px;
    margin-bottom: 2px;
    transition: 0.3s;
}

/* --- Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· (Active State) --- */
.nav-pills .nav-link.active.modern-nav-item {
    background: linear-gradient(135deg, var(--header-grad-2) 0%, var(--header-grad-1) 100%) !important;
    color: #fff !important;
    box-shadow: 0 6px 15px rgba(59, 130, 246, 0.4); /* Ø¸Ù„ Ù…Ù„ÙˆÙ† Ù„Ù„Ø²Ø± Ø§Ù„Ù†Ø´Ø· */
    transform: translateY(-2px); /* Ø±ÙØ¹Ø© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ */
}

/* --- ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± (Hover) --- */
.modern-nav-item:not(.active):hover {
    background: rgba(0, 0, 0, 0.03);
    color: var(--header-grad-2) !important;
    transform: translateY(-1px);
}

/* --- ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† (Dark Mode) --- */
[data-theme="dark"] .modern-nav-container {
    background: rgba(30, 41, 59, 0.7) !important;
    border-color: rgba(255, 255, 255, 0.1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .modern-nav-item:not(.active):hover {
    background: rgba(255, 255, 255, 0.05);
    color: #fff !important;
}
        /* =========================================
   ğŸ“± Ø¥ØµÙ„Ø§Ø­ Ø­Ù‚Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„Ø¹Ù…ÙˆÙ„Ø© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
   ========================================= */
@media (max-width: 768px) {
    /* 1. ØªÙƒØ¨ÙŠØ± ÙˆØ¶Ø¨Ø· Ø­Ù‚Ù„ Ø§Ù„Ù…Ø¨Ù„Øº */
    #amount {
        font-size: 28px !important; /* Ø®Ø· ÙƒØ¨ÙŠØ± ÙˆÙˆØ§Ø¶Ø­ Ù„Ù„Ø£Ø±Ù‚Ø§Ù… */
        height: 60px !important;    /* Ø§Ø±ØªÙØ§Ø¹ Ù…Ø±ÙŠØ­ Ù„Ù„Ù…Ø³ */
        text-align: center !important;
        font-weight: 800 !important;
        background-color: #f8fafc !important;
        border: 2px solid #e2e8f0 !important;
        margin-bottom: 5px !important;
        padding: 0 !important; /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø´Ùˆ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ø¶Ø¨Ø· Ø§Ù„ØªÙˆØ³Ø· */
    }

    /* 2. Ø¶Ø¨Ø· Ø­Ù‚Ù„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© Ù„ÙŠØªÙ†Ø§Ø³Ù‚ Ù…Ø¹Ù‡ */
    #comm {
        height: 60px !important;
        font-size: 20px !important;
        font-weight: bold !important;
        text-align: center !important;
        padding: 0 !important;
    }

    /* 3. ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† (ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„Ø¹Ù…ÙˆÙ„Ø©) */
    .card-box label.small {
        font-size: 14px !important; /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
        color: #64748b !important;
        margin-bottom: 8px !important;
        display: block;
    }

    /* 4. ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙÙŠ Ø§Ù„ØµÙ */
    .card-box .row.g-3 {
        --bs-gutter-x: 10px !important; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„Ø¹Ù…ÙˆÙ„Ø© */
    }
}

/* ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø§Ù… Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ù„ÙŠÙƒÙˆÙ† Ù…Ù…ÙŠØ²Ø§Ù‹ Ø¯Ø§Ø¦Ù…Ø§Ù‹ */
#amount:focus {
    border-color: #3b82f6 !important;
    background-color: #ffffff !important;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15) !important;
}
        /* ÙƒÙ„Ø§Ø³ Ù…Ø®ØµØµ Ù„Ù„Ø¸Ù„ Ø§Ù„Ù…Ù…ÙŠØ² (ÙÙ‚Ø· Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©) */
.main-service-shadow {
    /* Ø¸Ù„ Ø£Ø²Ø±Ù‚ Ø®ÙÙŠÙ Ø¬Ø¯Ø§Ù‹ ÙˆÙ†Ø§Ø¹Ù… */
    box-shadow: 0 10px 30px -5px rgba(37, 99, 235, 0.15) !important;
    border: 1px solid rgba(37, 99, 235, 0.1) !important; /* Ø­Ø¯ÙˆØ¯ Ø²Ø±Ù‚Ø§Ø¡ Ø´ÙØ§ÙØ© Ø¬Ø¯Ø§Ù‹ */
    background: #ffffff;
}
/* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø§ÙˆØ³ Ù„Ù„ÙƒÙ„Ø§Ø³ Ø§Ù„Ù…Ø®ØµØµ Ø¯Ù‡ */
.main-service-shadow:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px -5px rgba(37, 99, 235, 0.25) !important;
    border-color: rgba(37, 99, 235, 0.3) !important;
}
.provider-btn {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px 20px;
    border: none;
    border-radius: 12px;
    font-weight: 800;
    font-size: 14px;
    transition: transform 0.2s;
    color: white;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
.provider-btn:hover {
    transform: translateY(-2px);
    opacity: 0.9;
}
.btn-fawry { background: linear-gradient(135deg, #ff6b00, #ff8f00); }
.btn-maksab { background: linear-gradient(135deg, #00c853, #00e676); }
.btn-moshtrayat { background: linear-gradient(135deg, #2979ff, #448aff); }
.btn-aman { background: linear-gradient(135deg, #d50000, #ff1744); } /* Ù„Ùˆ Ø­Ø¨ÙŠØª ØªØ¶ÙŠÙ Ø£Ù…Ø§Ù† Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹ */
        /* =========================================
   ğŸ’ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Modern UI Upgrade)
   ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¯ÙˆÙ† Ø­Ø°Ù
   ========================================= */

/* 1. ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„ÙƒØ±ÙˆØª */
#operationCardsContainer {
    background: #ffffff;
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.03); /* Ø¸Ù„ Ù†Ø§Ø¹Ù… Ø¬Ø¯Ø§Ù‹ */
    border: 1px solid #f1f5f9;
    margin-bottom: 20px;
}
[data-theme="dark"] #operationCardsContainer {
    background: #1e293b;
    border-color: #334155;
    box-shadow: none;
}

/* 2. Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (ÙÙˆØ±ÙŠØŒ Ù…ÙƒØ³Ø¨...) */
.op-group-title {
    font-size: 13px !important;
    font-weight: 800 !important;
    color: var(--text-muted);
    background: var(--bg-body);
    padding: 8px 15px;
    border-radius: 50px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin: 20px 0 12px 0 !important;
    border: 1px solid var(--border-color);
}
/* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ø· Ø§Ù„Ù‚Ø¯ÙŠÙ… */
.op-group-title::after { display: none !important; }

/* 3. ØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„ Ø§Ù„ÙƒØ±ÙˆØª (Tiles) */
.op-card {
    background: #fff;
    border: 1px solid #f1f5f9 !important; /* Ø­Ø¯ÙˆØ¯ Ø®ÙÙŠÙØ© Ø¬Ø¯Ø§Ù‹ */
    border-radius: 16px !important; /* Ø²ÙˆØ§ÙŠØ§ Ø£ÙƒØ«Ø± Ø§Ø³ØªØ¯Ø§Ø±Ø© */
    padding: 15px 10px !important;
    box-shadow: 0 4px 6px rgba(0,0,0,0.01); /* Ø¸Ù„ Ø®ÙÙŠÙ */
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important; /* Ø­Ø±ÙƒØ© Ù†Ø§Ø¹Ù…Ø© */
    position: relative;
    overflow: hidden;
    /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù„ÙˆÙ†Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø´ÙƒÙ„ */
    border-top: 1px solid #f1f5f9 !important; 
}

/* Ø¥Ø¶Ø§ÙØ© Ø®Ø· Ù…Ù„ÙˆÙ† Ù†Ø§Ø¹Ù… Ø£Ø³ÙÙ„ Ø§Ù„ÙƒØ§Ø±Øª Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ */
.card-fawry { border-bottom: 4px solid #ff6b00 !important; }
.card-maksab { border-bottom: 4px solid #00c853 !important; }
.card-wallets { border-bottom: 4px solid #2979ff !important; }
.card-safe { border-bottom: 4px solid #d50000 !important; }

/* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ø§Ù„Ù…Ø§ÙˆØ³ (Hover) */
.op-card:hover {
    transform: translateY(-5px) scale(1.02) !important;
    box-shadow: 0 12px 20px rgba(0,0,0,0.08) !important;
    border-color: #e2e8f0 !important;
    z-index: 2;
}

/* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ÙƒØ±ÙˆØª */
.op-card i {
    font-size: 22px !important;
    margin-bottom: 8px;
    transition: 0.3s;
}

/* Ø§Ù„Ù†Øµ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ§Ø±Øª */
.op-card span {
    font-size: 11px !important;
    font-weight: 700 !important;
    color: var(--text-main);
}

/* ğŸ”¥ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø© (Active) - ØªØ­Ø³ÙŠÙ† Ø¬Ø°Ø±ÙŠ */
.op-card.active {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
    border: none !important;
    box-shadow: 0 8px 15px rgba(37, 99, 235, 0.3) !important;
    transform: scale(0.98);
}
.op-card.active i, .op-card.active span {
    color: #fff !important;
}

/* 4. ØªØ­Ø³ÙŠÙ† Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Inputs & Selects) */
.card-box input, 
.card-box select, 
.card-box textarea {
    background-color: #f8fafc !important; /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ */
    border: 1px solid #e2e8f0 !important;
    border-radius: 12px !important;
    padding: 12px 15px !important;
    font-weight: 600;
    color: var(--text-main);
    box-shadow: none !important;
    transition: all 0.2s;
}

/* Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ù‚Ù„ */
.card-box input:focus, 
.card-box select:focus, 
.card-box textarea:focus {
    background-color: #fff !important;
    border-color: #3b82f6 !important;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1) !important;
}

/* ØªØ­Ø³ÙŠÙ† Ø­Ù‚Ù„ Ø§Ù„Ù…Ø¨Ù„Øº */
#amount {
    font-size: 20px !important;
    color: #2563eb !important;
    letter-spacing: 1px;
}

/* ØªØ­Ø³ÙŠÙ† Ø­Ù‚Ù„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© */
#comm {
    background-color: #fffbeb !important; /* Ø£ØµÙØ± ÙØ§ØªØ­ */
    border-color: #fcd34d !important;
    color: #d97706 !important;
}

/* 5. Ø²Ø± Ø§Ù„ØªÙ†ÙÙŠØ° (Big Button) */
#btnRun {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
    border: none !important;
    padding: 15px !important;
    border-radius: 14px !important;
    font-size: 16px !important;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    transition: 0.3s;
}
#btnRun:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
}

/* 6. Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø§Ù„Ù…Ø«Ø¨ØªØ© (Pinned Wallets) */
.pin-btn {
    background: #fff !important;
    border: 1px solid #e2e8f0 !important;
    color: #64748b !important;
    padding: 8px 16px !important;
    border-radius: 50px !important; /* Ø´ÙƒÙ„ ÙƒØ¨Ø³ÙˆÙ„Ø© */
    font-size: 11px !important;
    box-shadow: 0 2px 4px rgba(0,0,0,0.02);
    transition: 0.2s;
}

.pin-btn:hover {
    border-color: #3b82f6 !important;
    color: #3b82f6 !important;
    transform: translateY(-2px);
}

.pin-btn.active {
    background: #3b82f6 !important;
    color: #fff !important;
    border-color: #3b82f6 !important;
    box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
}

/* 7. Ø¯Ø§Ø±Ùƒ Ù…ÙˆØ¯ (ØªØµØ­ÙŠØ­Ø§Øª Ù„Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©) */
[data-theme="dark"] .op-card {
    background: #1e293b;
    border-color: #334155 !important;
    border-bottom-width: 4px !important; /* Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø· Ø§Ù„Ù…Ù„ÙˆÙ† */
}
[data-theme="dark"] .op-card:hover {
    background: #334155;
}
[data-theme="dark"] .card-box input, 
[data-theme="dark"] .card-box select,
[data-theme="dark"] .card-box textarea {
    background-color: #111827 !important;
    border-color: #374151 !important;
    color: #fff;
}
[data-theme="dark"] .pin-btn {
    background: #1e293b !important;
    border-color: #334155 !important;
    color: #cbd5e1 !important;
}
[data-theme="dark"] .pin-btn.active {
    background: #3b82f6 !important;
    color: #fff !important;
}
        .pin-tag-badge {
    background-color: #f59e0b;
    color: #fff;
    font-size: 9px;
    padding: 2px 6px;
    border-radius: 6px;
    margin-right: 6px;
    vertical-align: middle;
    font-weight: 800;
    box-shadow: 0 2px 5px rgba(245, 158, 11, 0.4);
}
	  /* --- ğŸ”¥ ØªØµÙ…ÙŠÙ… Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ… (Modern Transaction List) --- */
	.trans-list-container {
		display: flex;
		flex-direction: column;
		gap: 10px;
	}

	.trans-item {
		display: flex;
		align-items: center;
		justify-content: space-between;
		background: var(--bg-card);
		border: 1px solid var(--border-color);
		padding: 12px 15px;
		border-radius: 12px;
		transition: all 0.2s ease;
		position: relative;
		overflow: hidden;
	}

	/* Ø´Ø±ÙŠØ· Ø¬Ø§Ù†Ø¨ÙŠ Ù…Ù„ÙˆÙ† Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© */
	.trans-item::before {
		content: ''; position: absolute; right: 0; top: 0; bottom: 0; width: 4px;
		background: #cbd5e1; /* Ù„ÙˆÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠ */
	}
	.trans-type-in::before { background: #10b981; } /* ÙˆØ§Ø±Ø¯ - Ø£Ø®Ø¶Ø± */
	.trans-type-out::before { background: #ef4444; } /* ØµØ§Ø¯Ø± - Ø£Ø­Ù…Ø± */

	.trans-item:hover {
		transform: translateX(-3px);
		box-shadow: 0 4px 12px rgba(0,0,0,0.05);
	}

	.trans-icon-box {
		width: 38px; height: 38px;
		border-radius: 10px;
		display: flex; align-items: center; justify-content: center;
		font-size: 16px; margin-left: 12px;
	}
	.icon-in { background: rgba(16, 185, 129, 0.1); color: #10b981; }
	.icon-out { background: rgba(239, 68, 68, 0.1); color: #ef4444; }

	.trans-info h6 { margin: 0 0 3px 0; font-size: 13px; font-weight: bold; color: var(--text-main); }
	.trans-info span { font-size: 11px; color: var(--text-muted); display: block; }

	.trans-amount { font-family: 'Roboto Mono'; font-weight: 800; font-size: 15px; }

	/* --- ğŸ¦… ØªØµÙ…ÙŠÙ… ÙƒØ±ÙˆØª Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø§Ù„Ù…Ø·ÙˆØ± (Pro Wallet Cards) --- */
	.wallet-grid-pro {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); /* ÙƒØ§Ø±Øª Ø£Ø¹Ø±Ø¶ Ù„ØªÙØ§ØµÙŠÙ„ Ø£ÙƒØ«Ø± */
		gap: 15px;
	}

	.wallet-card-pro {
		background: var(--bg-card);
		border-radius: 16px;
		padding: 16px;
		border: 1px solid var(--border-color);
		box-shadow: 0 2px 8px rgba(0,0,0,0.03);
		position: relative;
		transition: 0.3s;
	}
	.wallet-card-pro:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.08); border-color: #3b82f6; }

	.wc-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
	.wc-icon { 
		width: 42px; height: 42px; border-radius: 12px; 
		background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
		color: #0284c7; display: flex; align-items: center; justify-content: center; font-size: 20px;
	}
	[data-theme="dark"] .wc-icon { background: #0c4a6e; color: #7dd3fc; }

	.wc-title { font-weight: 800; font-size: 14px; margin-bottom: 2px; }
	.wc-subtitle { font-size: 11px; color: var(--text-muted); }

	.wc-balance { font-size: 22px; font-weight: 800; font-family: 'Roboto Mono'; color: var(--text-main); margin: 10px 0; }
	.wc-balance small { font-size: 12px; color: var(--text-muted); font-weight: normal; margin-right: 4px; }

	.wc-stats { display: flex; gap: 8px; margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border-color); }
	.wc-stat-item { flex: 1; text-align: center; }
	.wc-stat-val { display: block; font-weight: bold; font-size: 12px; font-family: 'Roboto Mono'; }
	.wc-stat-lbl { font-size: 9px; color: var(--text-muted); }

	.wc-progress-bg { height: 6px; background: var(--bg-body); border-radius: 10px; margin-top: 5px; overflow: hidden; }
	.wc-progress-fill { height: 100%; border-radius: 10px; transition: width 1s ease; }

	/* Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· (Ù†Ù‚Ø·Ø©) */
	.wc-status-dot {
		width: 8px; height: 8px; border-radius: 50%;
		position: absolute; top: 15px; left: 15px;
	}
	.dot-active { background: #10b981; box-shadow: 0 0 8px #10b981; }
	.dot-idle { background: #94a3b8; }        
			  /* --- ğŸ§± Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø­Ø§ÙØ¸ (Wallet Grid Layout) --- */
	.wallet-grid-container {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* ÙƒØ±ÙˆØª Ù…ØªØ¬Ø§ÙˆØ¨Ø© */
		gap: 12px;
	}

	.wallet-box {
		background: #fff;
		border-radius: 15px;
		padding: 15px;
		text-align: center;
		border: 1px solid #f1f5f9;
		box-shadow: 0 4px 10px rgba(0,0,0,0.03);
		transition: 0.3s;
		position: relative;
		overflow: hidden;
	}
	.wallet-box:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }

	/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„Ø© */
	.status-indicator {
		width: 10px; height: 10px; border-radius: 50%;
		position: absolute; top: 10px; right: 10px;
	}
	.status-active { background: #10b981; box-shadow: 0 0 8px #10b981; } /* Ø£Ø®Ø¶Ø± Ù…Ø´Ø¹ */
	.status-idle { background: #cbd5e1; } /* Ø±Ù…Ø§Ø¯ÙŠ */

	.wallet-icon-large { font-size: 24px; margin-bottom: 8px; color: #3b82f6; }
	.wallet-name { font-weight: bold; font-size: 13px; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
	.wallet-profit { font-size: 16px; font-weight: 800; font-family: 'Roboto Mono'; color: #10b981; }
	.wallet-vol { font-size: 9px; color: #94a3b8; margin-top: 5px; }

	/* Ø¯Ø§Ø±Ùƒ Ù…ÙˆØ¯ */
	[data-theme="dark"] .wallet-box { background: #1e293b; border-color: #334155; }
			  /* --- ğŸ¨ ÙƒØ±ÙˆØª Ø°ÙƒØ§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© (Leaderboard) --- */
	.intel-card {
		display: flex;
		align-items: center;
		padding: 12px 15px;
		margin-bottom: 10px;
		background: #fff;
		border-radius: 16px;
		border: 1px solid #f1f5f9;
		box-shadow: 0 4px 6px rgba(0,0,0,0.02);
		transition: transform 0.2s;
	}
	.intel-card:hover { transform: translateY(-3px); }

	.rank-icon {
		width: 42px; height: 42px;
		border-radius: 12px;
		display: flex; align-items: center; justify-content: center;
		font-size: 20px; font-weight: bold;
		margin-left: 15px;
		background: #f8fafc; color: #64748b;
	}

	/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø£ÙˆÙ„Ù‰ */
	.rank-1 .rank-icon { background: linear-gradient(135deg, #FFD700, #FDB931); color: #fff; box-shadow: 0 4px 10px rgba(253, 185, 49, 0.4); }
	.rank-2 .rank-icon { background: linear-gradient(135deg, #E0E0E0, #BDBDBD); color: #fff; }
	.rank-3 .rank-icon { background: linear-gradient(135deg, #CD7F32, #A0522D); color: #fff; }

	/* --- ğŸŒ™ Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ùƒ Ù…ÙˆØ¯ Ø§Ù„Ø´Ø§Ù…Ù„Ø© --- */
	[data-theme="dark"] .intel-card {
		background: #1e293b !important;
		border-color: #334155 !important;
		color: #f1f5f9 !important;
	}
	[data-theme="dark"] .rank-icon {
		background: #334155; color: #cbd5e1;
	}
	[data-theme="dark"] .user-stat-row {
		background: #1e293b !important;
		border-color: #334155 !important;
	}
	[data-theme="dark"] .table {
		color: #e2e8f0 !important;
		border-color: #334155 !important;
	}
	[data-theme="dark"] .table thead th {
		background-color: #0f172a !important;
		color: #94a3b8 !important;
		border-color: #334155 !important;
	}
	[data-theme="dark"] .table td {
		border-color: #334155 !important;
	}
	/* ØªÙˆØ³ÙŠØ· Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù†ÙˆØ¹ ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª */
	.top-ops-table th:first-child, 
	.top-ops-table td:first-child {
		text-align: center !important;
	}
			  /* --- ğŸ¨ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø°ÙƒØ§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙØ¸ (Wallet Intel Pro) --- */
	.intel-card {
		display: flex;
		align-items: center;
		justify-content: space-between;
		padding: 15px;
		margin-bottom: 10px;
		background: #ffffff;
		border-radius: 12px;
		border: 1px solid #f1f5f9;
		box-shadow: 0 2px 5px rgba(0,0,0,0.02);
		transition: all 0.2s ease;
		position: relative;
		overflow: hidden;
	}
	.intel-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

	/* Ø§Ù„Ø±ØªØ¨ (1ØŒ 2ØŒ 3) */
	.rank-box {
		width: 45px; height: 45px;
		border-radius: 10px;
		display: flex; align-items: center; justify-content: center;
		font-size: 20px; font-weight: 800;
		margin-left: 15px;
		background: #f8fafc; color: #64748b;
	}
	.rank-1 .rank-box { background: linear-gradient(135deg, #ffd700 0%, #f59e0b 100%); color: #fff; box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3); }
	.rank-2 .rank-box { background: linear-gradient(135deg, #e2e8f0 0%, #94a3b8 100%); color: #fff; }
	.rank-3 .rank-box { background: linear-gradient(135deg, #fdba74 0%, #d97706 100%); color: #fff; }

	.intel-info h6 { margin: 0; font-weight: 700; font-size: 14px; color: var(--text-main); }
	.intel-stats { text-align: left; }

	/* --- ğŸŒ“ Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† (Dark Mode Fixes) --- */
	[data-theme="dark"] .intel-card {
		background: #1e293b !important;
		border-color: #334155 !important;
		color: #f8fafc !important;
	}
	[data-theme="dark"] .rank-box {
		background: #334155; color: #cbd5e1;
	}
	/* Ø¥ØµÙ„Ø§Ø­ Ø®Ù„ÙÙŠØ© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ£Ù‡Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙÙŠ Ø§Ù„Ø¯Ø§Ø±Ùƒ */
	[data-theme="dark"] .user-stat-row,
	[data-theme="dark"] .table {
		background: transparent !important;
		color: #e2e8f0 !important;
		border-color: #334155 !important;
	}
	[data-theme="dark"] .table thead th {
		background-color: #0f172a !important;
		color: #94a3b8 !important;
		border-color: #334155 !important;
	}
	[data-theme="dark"] .table td {
		border-color: #334155 !important;
	}
	/* Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù†ØµÙˆØµ */
	[data-theme="dark"] .text-dark { color: #f1f5f9 !important; }
	[data-theme="dark"] .text-muted { color: #94a3b8 !important; }

	/* --- ğŸ“Š ØªÙ†Ø³ÙŠÙ‚ Ø¬Ø¯ÙˆÙ„ Ø£Ù‡Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (ØªÙˆØ³Ø· Ø§Ù„Ù†ÙˆØ¹) --- */
	.top-trans-table th:nth-child(1),
	.top-trans-table td:nth-child(1) {
		text-align: center !important; /* ØªÙˆØ³ÙŠØ· Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù†ÙˆØ¹ */
	}
			  /* Ø¥ØµÙ„Ø§Ø­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù„ØªÙƒÙˆÙ† Ù…ØªÙ…Ø§Ø³ÙƒØ© */
	.user-stat-row {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 12px;
		border-bottom: 1px solid #f1f5f9;
		background: #fff;
		margin-bottom: 5px;
		border-radius: 8px;
		border: 1px solid #e2e8f0;
	}
	.user-info-side {
		display: flex;
		align-items: center;
		gap: 10px;
	}
	.user-numbers-side {
		text-align: left; /* Ù„Ù„Ø£Ø±Ù‚Ø§Ù… */
		display: flex;
		flex-direction: column;
		align-items: flex-end;
	}
	.top-trans-table th {
		font-size: 11px;
		color: #64748b;
		font-weight: normal;
		padding-bottom: 8px;
	}
	.top-trans-table td {
		font-size: 12px;
		font-weight: bold;
		padding: 8px 0;
		border-bottom: 1px dashed #e2e8f0;
	}
			  .monitor-lbl {
		font-size: 7px;
	}

			  /* ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø¯Ø§Ø®Ù„ Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
	.table-modern td {`
		padding: 15px 10px !important; /* Ù…Ø³Ø§ÙØ© Ù…Ø±ÙŠØ­Ø© */
	}

	/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£Ø®ÙŠØ± (Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡) Ø¹Ø´Ø§Ù† Ù…ÙŠÙƒÙˆÙ†Ø´ Ù„Ø§Ø²Ù‚ */
	.table-modern td:last-child {
		width: 60px; /* Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª Ù„Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
		text-align: center;
	}
	[data-theme="dark"] .action-menu:hover {
		background-color: #3b82f6 !important; /* Ø£Ø²Ø±Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù„Ù…Ø³ */
	}
	.table-modern tbody tr {
		position: relative; 
		transition: transform 0.2s, box-shadow 0.2s, z-index 0s; /* Ø´ÙŠÙ„Ù†Ø§ Ø§Ù„ØªØ§Ø®ÙŠØ± Ù…Ù† z-index */
	}}
	[data-theme="dark"] .table-modern td {
		color: #e2e8f0 !important;
		border-color: #334155 !important;
	}
	[data-theme="dark"] .text-dark {
		color: #f8fafc !important; /* ÙŠØ®Ù„ÙŠ Ø§Ù„Ù†Øµ Ø§Ù„Ø£Ø³ÙˆØ¯ Ø£Ø¨ÙŠØ¶ */
	}
	[data-theme="dark"] .text-main {
		color: #ffffff !important;
	}
	[data-theme="dark"] .table-modern {
		background: transparent !important;
	}

	[data-theme="dark"] .text-muted { color: #94a3b8 !important; }
	[data-theme="dark"] .action-menu {
		background-color: rgba(255, 255, 255, 0.1) !important;
		color: #fff !important;
	}
	[data-theme="dark"] .action-dropdown {
		background: #1e293b;
		border-color: #475569;
		box-shadow: 0 10px 40px rgba(0,0,0,0.5);
	}
	[data-theme="dark"] .action-item {
		color: #e2e8f0 !important;
	}
	[data-theme="dark"] .action-item:hover {
		background-color: #334155 !important;
	}
	[data-theme="dark"] .user-avatar, 
	[data-theme="dark"] div[style*="background:#e0e7ff"] {
		background-color: #312e81 !important; /* Ø®Ù„ÙÙŠØ© ÙƒØ­Ù„ÙŠ */
		color: #c7d2fe !important; /* Ù†Øµ Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­ */
	}
	[data-theme="dark"] div[style*="background:#f1f5f9"] {
		background-color: #334155 !important; /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠØ© */
		color: #cbd5e1 !important;
	}
	[data-theme="dark"] .table-modern td:first-child { border-right-color: inherit; } /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨ÙˆØ±Ø¯Ø± Ø§Ù„Ù…Ù„ÙˆÙ† ÙÙŠ Ø§Ù„Ø¯Ø§Ø±Ùƒ Ù„Ùˆ Ø­Ø¨ÙŠØª */
	/* ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø§Ù„Ù†ØµÙˆØµ Ø¹Ø´Ø§Ù† Ù…ØªØ¯Ø®Ù„Ø´ ÙÙŠ Ø¨Ø¹Ø¶ */
	.fw-bold.text-dark {
		display: block;
		margin-bottom: 4px;
	}
	.text-muted {
		font-size: 11px !important;
	}
	/* --- ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø¨Ø§Ø¯Ø¬Ø§Øª --- */
	.status-badge-modern {
		padding: 6px 14px;
		border-radius: 8px;
		font-size: 11px;
		font-weight: 800;
		letter-spacing: 0.3px;
	}
	/* Ø£Ù„ÙˆØ§Ù† Ø¹ØµØ±ÙŠØ© Ù‡Ø§Ø¯Ø¦Ø© */
	.status-in { background: #dcfce7; color: #166534; }  /* Ø£Ø®Ø¶Ø± Ø²Ù…Ø±Ø¯ÙŠ */
	.status-out { background: #fee2e2; color: #991b1b; } /* Ø£Ø­Ù…Ø± ÙŠØ§Ù‚ÙˆØªÙŠ */
	.status-warn { background: #fef9c3; color: #854d0e; } /* Ø£ØµÙØ± ÙƒÙ‡Ø±Ù…Ø§Ù†ÙŠ */

	/* Ø¨Ø§Ø¯Ø¬ Ø§Ù„Ø±Ø¨Ø­ */
	.profit-badge {
		background: linear-gradient(135deg, #10b981 0%, #059669 100%);
		color: white;
		padding: 4px 10px;
		border-radius: 50px;
		font-size: 11px;
		font-weight: bold;
		box-shadow: 0 2px 5px rgba(16, 185, 129, 0.2);
	}
	.profit-zero { background: #f3f4f6; color: #9ca3af; box-shadow: none; }

	/* Ø¨Ø§Ø¯Ø¬ Ø§Ù„Ù…ÙˆØ¸Ù */
	.user-badge {
		display: flex;
		align-items: center;
		gap: 6px;
		font-size: 12px;
		font-weight: 600;
		color: var(--text-muted);
	}
	.user-avatar {
		width: 24px;
		height: 24px;
		background: #e0e7ff;
		color: #4f46e5;
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 10px;
		font-weight: bold;
	}

	/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø§Ù„ØªÙØ§ØµÙŠÙ„) */
	.details-modal-overlay {
		position: fixed; top: 0; left: 0; width: 100%; height: 100%;
		background: rgba(0,0,0,0.5); z-index: 9999;
		display: none; justify-content: center; align-items: center;
		backdrop-filter: blur(4px);
	}
	.details-card {
		background: var(--bg-card); width: 90%; max-width: 400px;
		border-radius: 20px; padding: 25px;
		box-shadow: 0 20px 50px rgba(0,0,0,0.2);
		position: relative; animation: slideUp 0.3s ease;
	}
	@keyframes slideUp { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }

	/* --- ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© (Thermal Receipt) --- */
	@media print {
		body * { visibility: hidden; }
		#printableArea, #printableArea * { visibility: visible; }
		#printableArea { position: absolute; left: 0; top: 0; width: 100%; }
	}
	.modern-table-container {
		background: var(--bg-card);
		border-radius: 16px;
		padding: 20px;
		box-shadow: 0 10px 30px rgba(0,0,0,0.05);
	}

	.table-controls {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 20px;
		flex-wrap: wrap;
		gap: 10px;
	}

	.search-modern {
		position: relative;
		width: 100%; /* Ø¹Ø´Ø§Ù† ØªØ§Ø®Ø¯ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ§Ø­ */
		max-width: 300px;
	}
	.search-modern input:focus {
		background: #ffffff;
		border-color: #3b82f6;
		box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
		outline: none;
	}

	.search-modern input {
		width: 100%;
		height: 40px;
		border-radius: 12px;
		border: 1px solid #e2e8f0;
		background: #f8fafc;
		/* ğŸ‘‡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: ÙˆØ³Ø¹Ù†Ø§ Ø§Ù„Ù…Ø³Ø§ÙØ© ÙŠÙ…ÙŠÙ† Ø¹Ø´Ø§Ù† Ø§Ù„Ø¹Ø¯Ø³Ø© */
		padding: 0 45px 0 15px !important; 
		font-size: 13px;
		transition: all 0.2s;
	}
	.search-modern i {
		position: absolute;
		right: 15px; /* Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ø¯Ø³Ø© ÙŠÙ…ÙŠÙ† */
		top: 50%;
		transform: translateY(-50%);
		color: #94a3b8;
		pointer-events: none; /* Ø¹Ø´Ø§Ù† Ø§Ù„Ø¶ØºØ·Ø© ØªÙŠØ¬ÙŠ ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø© Ù…Ø´ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
	}


	.filter-btn-modern {
		background: var(--bg-body);
		border: 1px solid var(--border-color);
		padding: 10px 20px;
		border-radius: 12px;
		color: var(--text-main);
		font-weight: bold;
		display: flex;
		align-items: center;
		gap: 8px;
		cursor: pointer;
		transition: 0.3s;
	}
	.filter-btn-modern:hover {
		background: var(--header-grad-2);
		color: white;
		border-color: var(--header-grad-2);
	}
	.table-modern thead th {
		background: #f1f5f9; /* Ø®Ù„ÙÙŠØ© Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ Ù„Ù„Ù‡ÙŠØ¯Ø± */
		color: #475569; /* Ù„ÙˆÙ† Ø®Ø· ØºØ§Ù…Ù‚ */
		font-size: 12px;
		font-weight: 800;
		text-transform: uppercase;
		letter-spacing: 0.5px;
		padding: 12px 8px; /* Ø¶ØºØ·Ù†Ø§ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª */
		position: sticky;
		top: 0;
		z-index: 10; /* Ø¹Ø´Ø§Ù† ÙŠÙØ¶Ù„ Ø¸Ø§Ù‡Ø± Ù„Ù…Ø§ ØªÙ†Ø²Ù„ ØªØ­Øª */
		border-bottom: 2px solid #e2e8f0;
	}
	.table-modern thead th:first-child { border-radius: 0 8px 8px 0; }
	.table-modern thead th:last-child { border-radius: 8px 0 0 8px; }

	/* Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù†ÙØ³Ù‡ */
	.table-modern {
		width: 100%;
		/* Ù‚Ù„Ù„Ù†Ø§ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø¹Ø´Ø§Ù† Ù†Ø¶ØºØ· Ø§Ù„Ø¹ÙˆØ§Ù…ÙŠØ¯ */
		min-width: 900px; 
		border-collapse: separate; 
		border-spacing: 0 8px; /* Ù…Ø³Ø§ÙØ© Ø£Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙÙˆÙ */
	}
	.table-responsive::-webkit-scrollbar {
		height: 8px; /* Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³Ø·Ø±Ø© Ø§Ù„Ø£ÙÙ‚ÙŠØ© */
		width: 8px;  /* Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³Ø·Ø±Ø© Ø§Ù„Ø±Ø£Ø³ÙŠØ© */
	}
	.table-responsive::-webkit-scrollbar-track {
		background: #f1f5f9;
		border-radius: 4px;
	}
	.table-responsive::-webkit-scrollbar-thumb {
		background: #cbd5e1; /* Ù„ÙˆÙ† Ø§Ù„Ù…Ø³Ø·Ø±Ø© */
		border-radius: 4px;
	}
	.table-responsive::-webkit-scrollbar-thumb:hover {
		background: #94a3b8;
	}
	.table-modern th {
		color: var(--text-muted);
		font-size: 12px;
		font-weight: 700;
		text-transform: uppercase;
		padding: 15px;
		border: none;
	}

	.table-modern tbody tr {
		background: #ffffff;
		box-shadow: 0 2px 5px rgba(0,0,0,0.03); /* Ø´Ø§Ø¯Ùˆ Ù†Ø§Ø¹Ù… */
		transition: all 0.2s ease;
	}

	.table-modern tbody tr:hover {
		transform: translateY(-2px);
		box-shadow: 0 8px 15px rgba(0,0,0,0.08);
		background: #f8fafc; /* ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ù„Ù…Ø³ */
	}

	@keyframes fadeInMenu {
		from { opacity: 0; transform: translateY(-10px); }
		to { opacity: 1; transform: translateY(0); }
	}

	.row-in td:first-child { border-right-color: #10b981; }
	.row-out td:first-child { border-right-color: #ef4444; }
	.row-warn td:first-child { border-right-color: #f59e0b; }

	.table-modern td {
		padding: 12px 8px; /* ğŸ‘ˆ Ù‡Ù†Ø§ Ø§Ù„Ø³Ø±: Ù‚Ù„Ù„Ù†Ø§ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø¹Ø´Ø§Ù† Ù†Ø¶ØºØ· Ø§Ù„Ø¹ÙˆØ§Ù…ÙŠØ¯ */
		vertical-align: middle;
		color: #1e293b;
		font-size: 13px; /* Ø®Ø· Ø£ØµØºØ± ÙˆØ£Ø´ÙŠÙƒ */
		border-top: 1px solid #f1f5f9;
		border-bottom: 1px solid #f1f5f9;
		white-space: nowrap; /* ÙŠÙ…Ù†Ø¹ Ù†Ø²ÙˆÙ„ Ø§Ù„ÙƒÙ„Ø§Ù… Ø³Ø·Ø±ÙŠÙ† */
	}
	.table-modern td:first-child { 
		border-right: 1px solid #f1f5f9; 
		border-radius: 0 8px 8px 0;
		border-right: 4px solid transparent; /* Ù…ÙƒØ§Ù† Ù„Ù„Ø®Ø· Ø§Ù„Ù…Ù„ÙˆÙ† */
	}
	.table-modern td:last-child { 
		border-left: 1px solid #f1f5f9; 
		border-radius: 8px 0 0 8px; 
	}

	.row-in td:first-child { border-right-color: #10b981; }
	.row-out td:first-child { border-right-color: #ef4444; }
	.row-warn td:first-child { border-right-color: #f59e0b; }

	/* --- ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù†ØµÙˆØµ (Typography) --- */
	.fw-bold { font-weight: 700 !important; }
	.text-xs { font-size: 11px !important; }
	.text-main { color: #0f172a; }
	.text-sec { color: #64748b; }

	/* --- Ø§Ù„Ø¯Ø§Ø±Ùƒ Ù…ÙˆØ¯ --- */
	[data-theme="dark"] .table-modern thead th {
		background-color: #0f172a !important; /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø£ØºÙ…Ù‚ Ø­Ø§Ø¬Ø© */
		color: #cbd5e1 !important;
		border-bottom: 1px solid #334155 !important;
	}
	[data-theme="dark"] .table-modern tbody tr {
		background-color: #1e293b !important; /* Ù„ÙˆÙ† Ø§Ù„ØµÙ */
		box-shadow: 0 4px 6px rgba(0,0,0,0.3) !important; /* Ø¸Ù„ Ù†Ø§Ø¹Ù… */
		border: 1px solid #334155 !important;
	}
	[data-theme="dark"] .table-modern td { color: #e2e8f0; border-color: #334155; }
	[data-theme="dark"] .table-modern tbody tr:hover {
		background-color: #334155 !important; /* ØªÙØªÙŠØ­ Ø¹Ù†Ø¯ Ø§Ù„ÙˆÙ‚ÙˆÙ Ø¹Ù„ÙŠÙ‡ */
		transform: translateY(-2px);
	}
	.table-responsive {
		/* ÙŠÙ…Ù„Ø£ Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø¹ ØªØ±Ùƒ Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ù‡ÙŠØ¯Ø± ÙÙˆÙ‚ */
		height: calc(100vh - 180px); 
		overflow-y: auto !important;
		overflow-x: auto !important;
		padding-bottom: 80px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© */
		
		/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø³Ø·Ø±Ø© */
		scrollbar-width: thin;
		scrollbar-color: #94a3b8 #f1f5f9;
	} /* Badges */
	.status-badge-modern {
		padding: 5px 12px;
		border-radius: 20px;
		font-size: 11px;
		font-weight: 800;
		display: inline-block;
	}
	.action-menu:hover {
		background: #e2e8f0;
		color: #3b82f6;
	}
	.action-menu i {
		font-size: 16px;
		color: var(--text-muted);
		pointer-events: none; /* Ø¹Ø´Ø§Ù† Ø§Ù„Ø¶ØºØ·Ø© ØªÙŠØ¬ÙŠ Ø¹ Ø§Ù„Ø²Ø±Ø§Ø± Ù†ÙØ³Ù‡ */
	}
	.status-paid { background: rgba(16, 185, 129, 0.1); color: #10b981; }
	.status-unpaid { background: rgba(239, 68, 68, 0.1); color: #ef4444; }
	.status-pending { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }

	/* Action Menu (3 Dots) */
	.action-menu {
		position: relative;
		width: 36px;
		height: 36px;
		background: #f8fafc; /* Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© Ù„Ù„Ø²Ø±Ø§Ø± */
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		cursor: pointer;
		transition: 0.2s;
		margin: 0 auto;
		z-index: 2; /* ÙŠØ¶Ù…Ù† Ø¥Ù†Ù‡ ÙÙˆÙ‚ Ø£ÙŠ Ø­Ø§Ø¬Ø© ØªØ§Ù†ÙŠØ© */
	}

	@keyframes fadeInMenu { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
	.action-dropdown {
		position: absolute;
		top: 45px; /* Ø¨Ø¹Ø¯ Ø§Ù„Ø²Ø±Ø§Ø± Ø¨Ø´ÙˆÙŠØ© */
		left: 0; 
		width: 160px;
		background: #ffffff;
		border: 1px solid #e2e8f0;
		border-radius: 12px;
		box-shadow: 0 10px 40px rgba(0,0,0,0.2); /* Ø¸Ù„ Ù‚ÙˆÙŠ Ø¹Ø´Ø§Ù† ÙŠØ¨Ø§Ù† Ø¥Ù†Ù‡Ø§ Ø¹Ø§ÙŠÙ…Ø© */
		z-index: 99999 !important; /* Ø±Ù‚Ù… Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ */
		display: none;
		flex-direction: column;
	}
	.action-dropdown.show {
		display: flex;
		animation: fadeInMenu 0.2s ease-out;
	}

	.action-item {
		padding: 10px 12px;
		font-size: 13px;
		color: var(--text-main);
		border-radius: 8px;
		cursor: pointer;
		display: flex;
		align-items: center;
		gap: 8px;
		transition: 0.2s;
	}
	.action-item:hover { background: #f1f5f9; }
	.action-item i { width: 20px; text-align: center; }
	.action-item.delete { color: #ef4444; }

	.t-details {
		display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px;
		padding-top: 15px; border-top: 1px dashed var(--border-color);
	}

	.t-tag {
		font-size: 11px; font-weight: 700; display: flex; align-items: center; gap: 6px;
		padding: 6px 12px; border-radius: 8px;
		background: var(--bg-body); color: var(--text-muted);
		border: 1px solid transparent; transition: 0.2s;
	}
	.t-tag:hover { border-color: var(--border-color); background: var(--bg-card); }

	/* --- ğŸŒ™ Dark Mode Adjustments (Fix) --- */
	[data-theme="dark"] .t-card { background: #1e293b; border-color: #334155; }
	[data-theme="dark"] .t-icon { background: #0f172a; border-color: #0f172a; }

	/* Ø§Ù„Ø±Ø¨Ø­ ÙÙŠ Ø§Ù„Ø¯Ø§Ø±Ùƒ Ù…ÙˆØ¯ (Ù†ÙŠÙˆÙ†) */
	[data-theme="dark"] .profit-pill {
		background: rgba(16, 185, 129, 0.15);
		color: #34d399;
		border-color: rgba(16, 185, 129, 0.4);
		box-shadow: 0 0 15px rgba(16, 185, 129, 0.1);
	}

	/* Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙÙŠ Ø§Ù„Ø¯Ø§Ø±Ùƒ Ù…ÙˆØ¯ */
	[data-theme="dark"] .status-in .t-icon { color: #34d399; box-shadow: 0 0 0 1px #059669; }
	[data-theme="dark"] .status-out .t-icon { color: #f87171; box-shadow: 0 0 0 1px #dc2626; }
	[data-theme="dark"] .status-warn .t-icon { color: #fbbf24; box-shadow: 0 0 0 1px #d97706; }

	/* Ø§Ù„ÙÙˆØ§ØµÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠØ© */
	.date-divider { margin: 30px 0 15px 0; text-align: right; position: relative; padding-right: 60px; }
	.date-badge {
		display: inline-flex; align-items: center; gap: 8px;
		background: var(--header-grad-2); color: white;
		padding: 6px 16px; border-radius: 30px;
		font-size: 12px; font-weight: 800;
		box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
	}
	/* =========================
	   ğŸŒ™ Dark Mode
	========================= */
	[data-theme="dark"] .t-card {
		background: #0f172a;
		border-color: #1e293b;
		box-shadow: 0 10px 25px rgba(0,0,0,.6);
	}
	[data-theme="dark"] .t-time {
		background: rgba(255,255,255,.08);
		color: #cbd5f5;
	}
	[data-theme="dark"] .t-tag {
		background: rgba(255,255,255,.04);
		color: #cbd5e1;
	}

	/* Profit ÙÙŠ Ø§Ù„Ø¯Ø§Ø±Ùƒ */
	[data-theme="dark"] .profit-pill {
		background: rgba(16,185,129,.15);
		color: #34d399;
		border: 1px solid #059669;
		box-shadow: 0 0 18px rgba(16,185,129,.15);
	}

	/* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ùƒ */
	[data-theme="dark"] .status-in .t-icon {
		background: rgba(16,185,129,.12);
	}
	[data-theme="dark"] .status-out .t-icon {
		background: rgba(239,68,68,.12);
	}
	[data-theme="dark"] .status-warn .t-icon {
		background: rgba(245,158,11,.12);
	}

			  .transition-all { transition: all 0.3s ease; }
		.transition-all:hover { transform: translateY(-3px); border-color: var(--header-grad-2) !important; }
		[data-theme="dark"] .bg-body { background-color: #111827 !important; color: white; }
		[data-theme="light"] .bg-body { background-color: #f3f4f6 !important; }
		.admin-only-section { animation: fadeIn 0.5s ease; }
			  /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ */
		.transition-all { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
		.transition-all:hover { transform: translateY(-3px); border-color: var(--header-grad-2) !important; }

		[data-theme="dark"] .bg-body { background-color: #111827 !important; color: white; }
		[data-theme="light"] .bg-body { background-color: #f3f4f6 !important; }

		.denom-input:focus {
			background-color: var(--bg-card) !important;
			outline: 2px solid var(--header-grad-2);
			box-shadow: none;
		}

		.admin-only-section {
			animation: fadeIn 0.5s ease;
		}

		@keyframes fadeIn {
			from { opacity: 0; }
			to { opacity: 1; }
		}
			  .btn-del-denom {
			display: flex;
			align-items: center;
			justify-content: center;
			transition: transform 0.2s;
		}
		.btn-del-denom:hover {
			transform: scale(1.2);
		}
		.denom-input {
			border-radius: 8px;
			border: 1px solid #dee2e6;
		}
		.denom-input:focus {
			background-color: #fff !important;
			border-color: var(--btn-main-bg);
			box-shadow: 0 0 0 3px rgba(30, 41, 59, 0.1);
		}
		#denominations-container .col-6 {
			transition: all 0.3s;
		}
			  /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ù†ÙƒÙ…Ø§Ø´ ÙˆØ§Ù„ÙˆÙ…Ø¶ Ø¹Ù†Ø¯ Ø§Ù„ØªØµÙÙŠØ± */
		.field-reset-success {
			animation: shrink-and-flash 0.5s ease-out;
		}

		@keyframes shrink-and-flash {
			0% { transform: scale(1); background-color: rgba(16, 185, 129, 0.2); }
			50% { transform: scale(0.95); }
			100% { transform: scale(1); background-color: transparent; }
		}
			  /* Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù†ØªÙ‚Ø§Ù„ÙŠ Ø¹Ù†Ø¯ ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚ÙˆÙ„ */
		input, select {
			transition: all 0.3s ease-in-out;
		}

		/* ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙŠ ØªÙ… ØªØµÙÙŠØ±Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­ */
		.input-reset-flash {
			border-color: #10b981 !important;
			background-color: rgba(16, 185, 129, 0.05) !important;
		}
			  /* Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø´Ø§Ù…Ù„Ø© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
		[data-theme="dark"] .modal-box {
			background-color: #1f2937 !important;
			border-color: #374151 !important;
			color: #ffffff !important;
		}

		[data-theme="dark"] #notificationsList .alert-warning {
			background-color: rgba(245, 158, 11, 0.2) !important;
			color: #fbbf24 !important; /* Ù„ÙˆÙ† Ø£ØµÙØ± ÙØ§ØªØ­ Ù„ÙŠØ¸Ù‡Ø± Ø¨ÙˆØ¶ÙˆØ­ */
		}

		[data-theme="dark"] .text-muted {
			color: #9ca3af !important; /* Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¯Ø§ÙƒÙ† */
		}

		/* ØªÙˆØ­ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ù†ØµÙˆØµ ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
		[data-theme="dark"] .list-group-item, 
		[data-theme="dark"] td, 
		[data-theme="dark"] th {
			color: #f3f4f6 !important;
		}

		/* Ø¥ØµÙ„Ø§Ø­ Ù„ÙˆÙ† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ */
		[data-theme="dark"] .profit-card-white {
			background-color: #1f2937 !important;
			border-color: #374151 !important;
		}

		[data-theme="dark"] .prof-lbl {
			color: #9ca3af !important;
		}
			  /* ØªÙ†Ø³ÙŠÙ‚ Ù†Ù‚Ø·Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙÙˆÙ‚ Ø§Ù„Ø¬Ø±Ø³ */
		.notification-wrapper {
			position: relative;
			display: inline-block;
		}

		.notification-badge {
			position: absolute;
			top: -2px;
			right: -2px;
			width: 10px;
			height: 10px;
			background-color: #ef4444; /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± */
			border-radius: 50%;
			border: 2px solid #0f172a; /* Ù†ÙØ³ Ù„ÙˆÙ† Ø§Ù„Ù‡ÙŠØ¯Ø± Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ¯Ø§Ø®Ù„ */
			display: none; /* Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
		}

		/* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„ÙˆÙ…ÙŠØ¶ */
		.pulse-red {
			animation: pulse-red-animation 1.5s infinite;
		}

		@keyframes pulse-red-animation {
			0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
			70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
			100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
		}
			  /* Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø²ÙˆÙˆÙ… ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
			  /* ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø·ÙˆØ±Ø© */
		/* ØªØµÙ…ÙŠÙ… Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø·ÙˆØ± - Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ ÙƒØ§ÙØ© Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹ */
		.wallet-info-card {
			background: var(--bg-card);
			border: 1px solid var(--border-color);
			border-radius: 12px;
			padding: 15px;
			margin-top: 15px;
			text-align: center;
			box-shadow: 0 4px 6px rgba(0,0,0,0.05);
		}

		.bal-container { margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px dashed var(--border-color); }
		.bal-label { font-size: 20px; color: var(--text-muted); display: block; }
		.bal-value { font-size: 20px; font-weight: 700; font-family: 'Roboto Mono'; }

		.limit-info { display: flex; justify-content: space-around; gap: 15px; }
		.limit-item { flex: 1; }
		.limit-label { font-size: 20px; color: var(--text-muted); display: block; }
		.limit-val { font-size: 20px; font-weight: 700; font-family: 'Roboto Mono'; }

		/* Ø£Ù„ÙˆØ§Ù† Ø°ÙƒÙŠØ© Ù„Ù„Ù†Øµ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© */
		.text-status-good { color: #10b981 !important; } /* Ø£Ø®Ø¶Ø± */
		.text-status-warn { color: #f59e0b !important; } /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
		.text-status-danger { color: #ef4444 !important; } /* Ø£Ø­Ù…Ø± */

		@media screen and (max-width: 768px) {
			input[type="text"], 
			input[type="number"], 
			input[type="tel"], 
			select, 
			textarea {
				font-size: 16px !important;
			}

		body {
			padding-bottom: 10px !important; 
			min-height: 100vh;
		}    
		.view-section {
			padding-bottom: 20px !important;
			overflow: hidden; 
		}

		@media (max-width: 768px) {
			input, select, textarea {
				font-size: 16px !important; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙˆÙ… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ø§Ù„Ø¢ÙŠÙÙˆÙ† ÙˆØ§Ù„Ø§Ù†Ø¯Ø±ÙˆÙŠØ¯ */
			}
			
			.view-section {
				padding-bottom: 300px !important; /* Ù…Ø³Ø§Ø­Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† Ø±ÙØ¹ Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© */
			}
			
			.card-box {
				margin-bottom: 20px;
			}
		}
			  /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„ÙƒØ±ÙˆØª */
		@keyframes fadeInUp {
			from {
				opacity: 0;
				transform: translateY(20px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.dash-card-animated {
		animation: fadeInUp 0.5s ease-out forwards;
		opacity: 0; /* Ù‡ØªØ¨Ø¯Ø£ Ù…Ø®ÙÙŠØ© ÙˆØªØ¸Ù‡Ø± Ø¨Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† */
		}

		/* ØªØ£Ø«ÙŠØ± Ù†Ø¨Ø¶ Ø®ÙÙŠÙ Ù„Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ */
		.pulse-animation {
			animation: pulse-purple 2s infinite;
		}

		@keyframes fadeInUp {
			from { opacity: 0; transform: translateY(15px); }
			to { opacity: 1; transform: translateY(0); }
		}

		/* ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ø§ÙØ¸ (Progress Bars) */
		.pg-bar {
			transition: width 1.5s cubic-bezier(0.1, 0.5, 0.5, 1);
		}
		/* ØªØ­Ø³ÙŠÙ† Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª */

		/* ØªØ­Ø±ÙŠÙƒ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø§Ù„Ù…Ø«Ø¨ØªØ© Ù„Ù„Ø£Ø³ÙÙ„ */
#pinnedWallets {
    display: flex;
    flex-wrap: wrap;
    justify-content: center; /* ØªÙˆØ³ÙŠØ· */
    align-items: flex-start; /* ğŸ‘ˆ Ø¯Ù‡ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø³Ø­Ø±ÙŠ Ø§Ù„Ù„ÙŠ Ø¨ÙŠÙ…Ù†Ø¹Ù‡Ù… ÙŠÙ…Ø·ÙˆØ§ Ø¨Ø¹Ø¶ */
    gap: 10px;
    margin-bottom: 20px;
}
		/* Ø´ÙƒÙ„ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø«Ø¨ØªØ© Ø§Ù„Ù…Ø­Ø¯Ø« */
		/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø§Ù„Ù…Ø«Ø¨ØªØ© Ø¨Ø­Ø¬Ù… Ø£ÙƒØ¨Ø± ÙˆØ®Ø· Ø£ÙˆØ¶Ø­ */
.pin-btn {
    background: #fff; /* Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ */
    border: 1px solid #3b82f6; /* Ø¨Ø±ÙˆØ§Ø² Ø£Ø²Ø±Ù‚ */
    color: #3b82f6; /* ÙƒØªØ§Ø¨Ø© Ø²Ø±Ù‚Ø§Ø¡ */
    border-radius: 15px;
    padding: 8px 12px;
    min-width: 100px;
    cursor: pointer;
    transition: all 0.2s ease;
    height: auto !important; /* Ø§Ù„Ø·ÙˆÙ„ Ø­Ø± Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    
    /* ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¬ÙˆÙ‡ */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
		.pin-btn.active {
			background: #3b82f6 !important;
			color: white !important;
			box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
		}

		/* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø¨ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
		#pinnedWallets {
			margin-top: 20px !important;
			margin-bottom: 20px !important;
			gap: 12px !important;
		}
		/* ØªÙ†Ø³ÙŠÙ‚ ÙƒØ±ÙˆØª Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù„ØªÙƒÙˆÙ† Ù…ØªØ±Ø§ØµØ© Ø¬Ù†Ø¨Ø§Ù‹ Ø¥Ù„Ù‰ Ø¬Ù†Ø¨ */
		#operationCardsContainer .row {
			display: flex !important;
			flex-wrap: wrap !important;
		}

		.op-card {
			height: 100% !important;
			min-height: 85px !important;
			display: flex !important;
			flex-direction: column !important;
			justify-content: center !important;
			align-items: center !important;
			padding: 10px !important;
			text-align: center !important;
		}
		.op-group-title {
		font-size: 14px;
			font-weight: 800;
			margin: 25px 0 10px;
			color: var(--text-main);
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.services-grid {
			display: flex;
			flex-wrap: wrap;
			margin: 0 -5px;
		}
		.service-col {
			flex: 0 0 33.33%; /* ØªØºÙŠÙŠØ± Ù…Ù† 50% Ø¥Ù„Ù‰ 33.33% Ù„Ø¸Ù‡ÙˆØ± 3 ÙƒØ±ÙˆØª */
			max-width: 33.33%;
			padding: 5px;
			box-sizing: border-box;
		}

		.op-group-title::after {
			content: "";
			flex-grow: 1;
			height: 1px;
			background: var(--border-color);
		}

		/* ØªÙˆØ­ÙŠØ¯ ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ±ÙˆØª */
		.op-card {
			background: var(--bg-card);
			border: 1px solid var(--border-color);
			border-radius: 12px;
			padding: 15px 10px;
			text-align: center;
			cursor: pointer;
			transition: all 0.2s ease;
			height: 100%;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			gap: 8px;
			user-select: none; /* Ù…Ù†Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ ÙƒØ£Ù†Ù‡ Ù…Ù„Ù Word */
			-webkit-tap-highlight-color: transparent; /* Ù…Ù†Ø¹ Ø§Ù„ÙˆÙ…ÙŠØ¶ Ø§Ù„Ø£Ø²Ø±Ù‚ ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
		}

		.op-card i {
			font-size: 18px; /* ØªØµØºÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
		}

		.op-card span {
			font-size: 11px; /* ØªØµØºÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ù„Ù†Øµ Ù„ÙŠÙ†Ø§Ø³Ø¨ 3 ÙƒØ±ÙˆØª */
			font-weight: 700;
		}
		/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ§Øª */
		.op-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 8px 15px rgba(0,0,0,0.08);
			border-color: #3b82f6;
		}

		/* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶ØºØ· */
		.op-card:active {
			transform: scale(0.95);
			background-color: var(--bg-body);
		}

		/* Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ù…Ø®ØªØ§Ø± */
		.op-card.active {
			background: #3b82f6 !important;
			color: white !important;
			border-color: #2563eb;
		}

		.op-card.active i, .op-card.active span {
			color: white !important;
		}

		/* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù‡ÙˆÙŠØ© Ù„ÙƒÙ„ Ù‚Ø³Ù… */
		.card-fawry { border-top: 4px solid #ff6b00; color: #ff6b00; }
		.card-maksab { border-top: 4px solid #00c853; color: #00c853; }
		.card-wallets { border-top: 4px solid #2979ff; color: #2979ff; }
		.card-safe { border-top: 4px solid #d50000; color: #d50000; }

		/* ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø«Ø¨ØªØ© (Pinned) */
		.pin-btn {
		background: var(--bg-card);
			border: 1.5px solid #3b82f6;
			color: #3b82f6;
			padding: 6px 15px;
			border-radius: 20px;
			font-size: 12px;
			font-weight: 700;
			transition: 0.2s;
		}
		.table-custom {
			width: 100% !important; /* Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ù…Ø³Ø§Ø­Ø© */
			table-layout: auto; /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
			margin-bottom: 0;
			border-collapse: collapse;
		}
		.table-custom th, .table-custom td {
			padding: 12px 8px !important; /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ø¶ØºØ· */
			vertical-align: middle;
			white-space: nowrap; /* Ù…Ù†Ø¹ Ø§Ù†Ù‚Ø³Ø§Ù… Ø§Ù„Ù†Øµ ÙÙŠ Ø³Ø·Ø±ÙŠÙ† Ø¥Ù„Ø§ Ù„Ù„Ø¶Ø±ÙˆØ±Ø© */
		}
			  /* --- Base Styles and Dark Mode Overrides --- */
			  :root { --bg-body: #f3f4f6; --bg-card: #ffffff; --text-main: #1e293b; --text-muted: #64748b; --border-color: #e2e8f0; --input-bg: #ffffff; --input-color: #1e293b; --header-grad-1: #1e3a8a; --header-grad-2: #3b82f6; --btn-main-bg: linear-gradient(to right, #2563eb, #3b82f6); }
	[data-theme="dark"] {
		/* 1. Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Slate Palette) */
		--bg-body: #0f172a !important;    /* Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙØ­Ø©: ÙƒØ­Ù„ÙŠ ØºØ§Ù…Ù‚ Ø¬Ø¯Ø§Ù‹ */
		--bg-card: #1e293b !important;    /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„ÙƒØ±ÙˆØª */
		--border-color: #334155 !important; /* Ù„ÙˆÙ† Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„ÙØ§ØµÙ„Ø© */
		--text-main: #f1f5f9 !important;  /* Ø§Ù„Ù†Øµ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: Ø£Ø¨ÙŠØ¶ */
		--text-muted: #94a3b8 !important; /* Ø§Ù„Ù†Øµ Ø§Ù„ÙØ±Ø¹ÙŠ: Ø±ØµØ§ØµÙŠ */
	}
	[data-theme="dark"] .bg-light {
		background-color: rgba(255, 255, 255, 0.05) !important;
		border: 1px solid rgba(255, 255, 255, 0.1) !important;
		color: #e2e8f0 !important;
	}
	[data-theme="dark"] .bg-white {
		background-color: #1e293b !important;
		color: #fff !important;
	}
			  [data-theme="dark"] .form-control, [data-theme="dark"] .form-select, [data-theme="dark"] input, [data-theme="dark"] select { background-color: #374151 !important; color: #ffffff !important; border: 1px solid #4b5563 !important; }
			  [data-theme="dark"] .form-control::placeholder { color: #9ca3af !important; }
			  [data-theme="dark"] .card-box, [data-theme="dark"] .modal-box, [data-theme="dark"] .profit-card-white, [data-theme="dark"] .wallet-card-live { background-color: #1f2937 !important; border-color: #374151 !important; color: #ffffff !important; }
			  [data-theme="dark"] .list-group-item { background-color: transparent !important; color: #ffffff !important; border-color: #374151 !important; }
			  [data-theme="dark"] h6, [data-theme="dark"] label, [data-theme="dark"] span { color: #e5e7eb !important; }
			  [data-theme="dark"] #dashContent .text-muted { color: #ffffff !important; }
			  body { background-color: var(--bg-body); color: var(--text-main); font-family: 'Cairo', sans-serif; font-size: 13px; padding-bottom: 20px; transition: 0.3s; }
			  .english-num { font-family: 'Roboto Mono', monospace; direction: ltr; display: inline-block; font-weight: bold; }
			  .app-header { background: linear-gradient(135deg, var(--header-grad-1), var(--header-grad-2)); color: white; padding: 20px; border-radius: 0 0 25px 25px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; box-shadow: 0 10px 20px rgba(0,0,0, 0.2); }
			  .app-header h5 { font-weight: 800; margin: 0; }
		.theme-toggle {
			background: rgba(255, 255, 255, 0.1) !important;
			backdrop-filter: blur(5px);
			border: 1px solid rgba(255, 255, 255, 0.2) !important;
			width: 40px !important;
			height: 40px !important;
			border-radius: 12px !important; /* Ø´ÙƒÙ„ Ù…Ø±Ø¨Ø¹ Ù…Ù†Ø­Ù†ÙŠ Ø£Ø­Ø¯Ø« */
			transition: all 0.3s ease;
		}
		.theme-toggle:hover {
			background: rgba(255, 255, 255, 0.2) !important;
			transform: rotate(15deg);
		}
			  .nav-pills { background: var(--bg-card); border-radius: 50px; padding: 6px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid var(--border-color); }
			  .nav-link { border-radius: 50px !important; color: var(--text-muted); font-weight: 700; font-size: 12px; transition: 0.3s; cursor: pointer; }
			  .nav-link.active { background-color: #3b82f6 !important; color: white !important; box-shadow: 0 4px 10px rgba(59, 130, 246, 0.4); }
			  .card-box { background: var(--bg-card); border-radius: 16px; padding: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 12px; border: 1px solid var(--border-color); color: var(--text-main); }
			  .dash-card-flat { border-radius: 12px; padding: 15px; color: white; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 10px; border: none; position: relative; overflow: hidden; }
			  .card-green { background-color: #10b981; } 
			  .card-blue { background-color: #3b82f6; } 
			  .card-orange { background-color: #f59e0b; } 
			  .card-red { background-color: #ef4444; } 
			  .card-purple { background-color: #8b5cf6; } 
			  .dash-val { font-size: 18px; font-weight: 800; font-family: 'Roboto Mono', monospace; }
			  .dash-lbl { font-size: 11px; font-weight: bold; opacity: 0.9; }
			  .icon-bg { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); font-size: 30px; opacity: 0.2; }
			  .grand-total-bar { background-color: #5b21b6; color: white; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(91, 33, 182, 0.3); }
			  .total-lbl { font-size: 12px; font-weight: bold; }
			  .total-val { font-size: 20px; font-weight: 800; font-family: 'Roboto Mono'; }
			  .profit-card-white { background: var(--bg-card); border-radius: 12px; padding: 15px; text-align: center; border: 1px solid var(--border-color); box-shadow: 0 2px 4px rgba(0,0,0,0.02); height: 100%; color: var(--text-main); }
			  .prof-val { font-size: 16px; font-weight: 800; margin-bottom: 5px; font-family: 'Roboto Mono'; }
			  .prof-lbl { font-size: 11px; color: var(--text-muted); font-weight: bold; }
			  .comp-card-detail { background-color: #d97706; color: white; border-radius: 12px; padding: 10px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
			  .wallet-card-live { background: var(--bg-card); border-radius: 12px; padding: 10px; border-left: 4px solid #3b82f6; border: 1px solid var(--border-color); border-left-width: 4px; margin-bottom: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); color: var(--text-main); }
			  .w-bal { color: #3b82f6; font-weight: 800; font-size: 14px; }
			  .w-header { display: flex; justify-content: space-between; margin-bottom: 5px; align-items: center; }
			  .w-num { 
				  font-size: 11px; 
				  white-space: nowrap; 
				  max-width: 100%; 
			  }
			  .progress-slim { height: 5px; border-radius: 10px; background: #f3f4f6; margin-top: 3px; }
			  .pg-bar { border-radius: 10px; }
			  .form-control, .form-select { border-radius: 10px; font-size: 13px; padding: 10px; }
			  .btn-main { background: var(--btn-main-bg); color: white; border-radius: 10px; width: 100%; padding: 12px; font-weight: bold; border: none; box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2); transition: 0.2s; }
			  .table-custom { color: var(--text-main); }
			  .table-custom th { background: var(--bg-body); color: var(--text-muted); border-bottom: 2px solid var(--border-color); }
			  .table-custom td { border-color: var(--border-color); background: var(--bg-card); color: var(--text-main); }
			  [data-theme="dark"] .table-custom th { background: #111827 !important; color: #9ca3af !important; border-bottom: 1px solid #374151 !important; }
			  [data-theme="dark"] .table-custom td { background: #1f2937 !important; color: #f3f4f6 !important; border-color: #374151 !important; }
			  .custom-toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); padding: 10px 20px; border-radius: 30px; z-index: 9999; font-weight: bold; display: none; min-width: 200px; color: white; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
			  .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(2px); }
			  .modal-box { background: var(--bg-card); width: 90%; max-width: 350px; padding: 20px; border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); border: 1px solid var(--border-color); color: var(--text-main); }

			  /*--------------------------------------
				ğŸ”¥ MOBILE RESPONSIVE UPGRADE â€” SAFE MODE
			  ---------------------------------------*/
		.pin-btn {
			background: var(--bg-card);
			border: 1px solid #3b82f6;
			color: #3b82f6;
			padding: 5px 12px;
			border-radius: 20px;
			font-size: 12px;
			font-weight: bold;
			cursor: pointer;
			transition: 0.2s;
		}
.pin-btn:hover {
    background: #f0f9ff;
    transform: translateY(-2px);
}

/* ğŸ”¥ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· (Ù„Ù…Ø§ ØªØ®ØªØ§Ø± Ø§Ù„Ø²Ø±Ø§Ø± ÙŠÙ‚Ù„Ø¨ Ø£Ø²Ø±Ù‚) */
.pin-btn.active {
    background: #3b82f6 !important; /* Ø®Ù„ÙÙŠØ© Ø²Ø±Ù‚Ø§Ø¡ */
    color: white !important; /* ÙƒØªØ§Ø¨Ø© Ø¨ÙŠØ¶Ø§Ø¡ */
    box-shadow: 0 4px 10px rgba(59, 130, 246, 0.4);
    border-color: #3b82f6;
}
.pin-btn.active i, 
.pin-btn.active div {
    color: white !important;
}
			  /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø§Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„Ø£ÙÙ‚ÙŠ */
			  body, html {
				max-width: 100%;
				overflow-x: hidden;
			  }

			  /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
			  .modal-box {
				width: 94% !important;
				max-width: 380px !important;
				margin: auto;
			  }

			  /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ØªØµØ¨Ø­ Scrollable (ÙƒØ¥Ø¹Ø¯Ø§Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ) */
			  .mobile-view table {
				width: 100%;
				overflow-x: auto;
				display: block;
			  }

			  /* Ù„Ùˆ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø£ÙˆØ³Ø¹ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© â†’ Scroll */
			  @media (max-width: 768px) {
				.mobile-view table {
				  white-space: nowrap;
				}
			  }

			  /* 2) Auto Convert To Cards Ù„Ùˆ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙƒØªÙŠØ± */
			  @media (max-width: 600px) {
				.mobile-view table.auto-card thead {
				  display: none;
				}

				.mobile-view table.auto-card tr {
				  display: block;
				  background: var(--bg-card);
				  margin-bottom: 12px;
				  padding: 10px;
				  border-radius: 12px;
				  border: 1px solid var(--border-color);
				}

				.mobile-view table.auto-card td {
				  display: flex;
				  justify-content: space-between;
				  font-size: 14px;
				  padding: 6px 0;
				  border: none !important;
				}

				.mobile-view table.auto-card td::before {
				  content: attr(data-label);
				  font-weight: bold;
				  color: var(--text-muted);
				}
			  }

			  /* 3) Simple table â†’ Ø¨Ø³ ØªÙƒØ¨ÙŠØ± */
			  .mobile-view table.simple td,
			  .mobile-view table.simple th {
				font-size: 15px !important;
				padding: 10px !important;
			  }


			  /* Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ØªØªØ­ÙˆÙ„ Ù„ØµÙ ÙˆØ§Ø­Ø¯ */
			  @media (max-width: 450px) {

				/* ØªØ¨Ø³ÙŠØ· Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
				.col-4, .col-3, .col-5, .col-6 {
				  width: 100% !important;
				  flex: 0 0 100% !important;
				}

				/* ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„ÙƒØ±ÙˆØª*/
				.dash-card-flat {
				  padding: 12px !important;
				}

				/* ØªØ­Ø³ÙŠÙ† Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ */
				.card-box {
				  padding: 12px !important;
				}

				/* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
				.btn-main {
				  padding: 12px !important;
				  font-size: 14px !important;
				}

				/* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ */
				.form-control, .form-select {
				  font-size: 14px !important;
				  padding: 10px !important;
				}

				/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
				.app-header {
		background: linear-gradient(135deg, #0f172a 0%, #1e40af 100%) !important; /* ØªØ¯Ø±Ø¬ Ù„ÙŠÙ„ÙŠ ÙØ®Ù… */
			padding: 25px 20px !important;
			border-radius: 0 0 30px 30px !important;
			display: flex;
			justify-content: space-between;
			align-items: center;
			box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
			border-bottom: 2px solid rgba(255,255,255,0.1);
		}  
		.header-title-container {
			display: flex;
			flex-direction: column;
			gap: 2px;
		}

		.app-header h5 {
			font-family: 'Cairo', sans-serif;
			font-weight: 800 !important;
			font-size: 20px !important;
			letter-spacing: 0.5px;
			color: #ffffff;
			margin: 0;
			text-shadow: 0 2px 4px rgba(0,0,0,0.2);
		}
		.app-header h5 i {
			color: #60a5fa; /* Ù„ÙˆÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
			margin-left: 8px;
			filter: drop-shadow(0 0 5px rgba(96, 165, 250, 0.5));
		}
		.developer-tag {
			font-size: 10px !important;
			font-weight: 600;
			text-transform: uppercase;
			letter-spacing: 1px;
			color: rgba(255, 255, 255, 0.6); /* Ø´ÙØ§ÙÙŠØ© Ù„Ù„Ù†Øµ Ø§Ù„ÙØ±Ø¹ÙŠ */
			display: flex;
			align-items: center;
			gap: 5px;
		}
		.developer-tag::before {
			content: '';
			width: 12px;
			height: 1px;
			background: rgba(255,255,255,0.3);
		}
				/* Ø§Ù„ÙƒØ±ÙˆØª */
				.wallet-card-live {
				  padding: 10px !important;
				}

				.w-num {
				  max-width: 100% !important; 
				}

				/* Ø§Ù„Ø´Ø§Ø±ØªØ§Øª */
				.grand-total-bar {
				  flex-direction: column;
				  gap: 5px;
				  text-align: center;
				}
				@media (max-width: 350px) {
			.service-col {
				flex: 0 0 50%; /* Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ÙƒØ±ØªÙŠÙ† ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
				max-width: 50%;
			}
			[data-theme="dark"] .text-main {
		color: #ffffff !important;
	}
	/* --- ØªØ®ØµÙŠØµ Ø§Ù„Ù†Øµ Ø§Ù„ÙØ±Ø¹ÙŠ (Ø§Ø³Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©/Ø§Ù„Ø¹Ù…ÙŠÙ„) --- */
	[data-theme="dark"] .text-sec.text-xs {
		color: #D4D6D9 !important; /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ù…Ø²Ø±Ù‚ (Ù…Ù…ÙŠØ² Ø¹Ù† Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø§Ù„Ù†Ø§ØµØ¹) */
		font-size: 18px !important; /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø· (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 11px) */
		font-weight: 700; /* Ø¬Ø¹Ù„ Ø§Ù„Ø®Ø· Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ù…Ø§ÙƒØ© */
		opacity: 1 !important; /* Ø¶Ù…Ø§Ù† Ø§Ù„Ø¸Ù‡ÙˆØ± Ø¨ÙˆØ¶ÙˆØ­ */
	}
	/* --- ØªØµÙ…ÙŠÙ…Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© --- */
	.report-card-modern {
		border-radius: 16px;
		padding: 20px;
		color: white;
		position: relative;
		overflow: hidden;
		box-shadow: 0 10px 20px rgba(0,0,0,0.1);
		transition: transform 0.3s ease;
		border: none;
	}
	.report-card-modern:hover { transform: translateY(-5px); }

	/* ØªØ¯Ø±Ø¬Ø§Øª Ù„ÙˆÙ†ÙŠØ© ÙØ®Ù…Ø© */
	.bg-grad-success { background: linear-gradient(135deg, #10b981 0%, #047857 100%); }
	.bg-grad-danger { background: linear-gradient(135deg, #ef4444 0%, #b91c1c 100%); }
	.bg-grad-primary { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
	.bg-grad-warning { background: linear-gradient(135deg, #f59e0b 0%, #b45309 100%); }

	.report-icon-bg {
		position: absolute;
		left: -10px;
		bottom: -10px;
		font-size: 80px;
		opacity: 0.15;
		transform: rotate(15deg);
	}

	.report-val { font-size: 24px; font-weight: 800; font-family: 'Roboto Mono'; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
	.report-lbl { font-size: 13px; font-weight: bold; opacity: 0.9; }

	/* ÙƒØ§Ø±Øª Ø§Ù„Ù…ÙˆØ¸Ù */
	.user-perf-card {
		background: var(--bg-card);
		border: 1px solid var(--border-color);
		border-radius: 12px;
		padding: 12px;
		margin-bottom: 8px;
		display: flex;
		align-items: center;
		justify-content: space-between;
		transition: 0.2s;
	}
	.user-perf-card:hover { background: var(--bg-body); border-color: #3b82f6; }
	.user-avatar-circle {
		width: 35px; height: 35px; 
		background: #e0e7ff; color: #4338ca;
		border-radius: 50%; 
		display: flex; align-items: center; justify-content: center;
		font-weight: bold; font-size: 14px;
	}
	.perf-bar-bg { height: 4px; background: #e5e7eb; border-radius: 10px; width: 100px; overflow: hidden; }
	.perf-bar-fill { height: 100%; background: #10b981; border-radius: 10px; }
		}
			  }
			  /* --- ğŸ¨ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Z-Report Fixes) --- */
	.z-report-container {
		background: #fff;
		border-radius: 20px;
		box-shadow: 0 5px 25px rgba(0,0,0,0.05);
		overflow: hidden;
		margin-bottom: 20px;
	}
	.z-header-bg {
		background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
		padding: 20px;
		color: white;
	}
	.stat-box-modern {
		background: #f8fafc;
		border-radius: 12px;
		padding: 15px;
		text-align: center;
		border: 1px solid #e2e8f0;
		transition: 0.3s;
	}
	.stat-box-modern:hover { transform: translateY(-3px); border-color: #3b82f6; }
	.stat-icon-circle {
		width: 40px; height: 40px; margin: 0 auto 10px;
		border-radius: 50%; display: flex; align-items: center; justify-content: center;
		font-size: 18px;
	}

	/* --- ğŸ§  ÙƒØ±ÙˆØª Ø°ÙƒØ§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙØ¸ (Wallet Intel Cards) --- */
	.intel-card {
		background: #fff;
		border-radius: 16px;
		padding: 15px;
		margin-bottom: 12px;
		border: 1px solid #f1f5f9;
		box-shadow: 0 4px 6px rgba(0,0,0,0.02);
		position: relative;
		overflow: hidden;
		transition: 0.3s;
	}
	.intel-card:hover {
		box-shadow: 0 10px 20px rgba(0,0,0,0.08);
		transform: translateX(-5px);
		border-right: 4px solid #3b82f6;
	}
	.rank-badge {
		position: absolute; left: 10px; top: 10px;
		font-size: 20px; font-weight: 900; opacity: 0.1;
		font-family: 'Roboto Mono';
	}
	.intel-val { font-size: 15px; font-weight: 800; font-family: 'Roboto Mono'; }
	.intel-label { font-size: 11px; color: #64748b; }

	/* Ø¯Ø§Ø±Ùƒ Ù…ÙˆØ¯ */
	[data-theme="dark"] .z-report-container, 
	[data-theme="dark"] .intel-card {
		background: #1e293b; border-color: #334155;
	}
	[data-theme="dark"] .stat-box-modern {
		background: #0f172a; border-color: #334155;
	}
			</style>
		  </head>
		  <body>
		<script type="module">
		  // Import the functions you need from the SDKs you need
		  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
		  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
		  // TODO: Add SDKs for Firebase products that you want to use
		  // https://firebase.google.com/docs/web/setup#available-libraries

		  // Your web app's Firebase configuration
		  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
		  const firebaseConfig = {
			apiKey: "AIzaSyDVV4VdRSmCZBERbih8YY6q12fvSPhIPNw",
			authDomain: "sadek-cash.firebaseapp.com",
			projectId: "sadek-cash",
			storageBucket: "sadek-cash.firebasestorage.app",
			messagingSenderId: "224657198996",
			appId: "1:224657198996:web:04ba3503b6082a5046c981",
			measurementId: "G-6X0ZFH1R4W"
		  };

		  // Initialize Firebase
		  const app = initializeApp(firebaseConfig);
		  const analytics = getAnalytics(app);
		</script>
		<div class="app-header">
		  <div class="header-main-info">
			<div class="d-flex align-items-center">
			  <h5 id="page-title" class="fw-bold text-white m-0">
				<i class="fa-solid fa-shield-halved me-1 text-info"></i> SADEK CASH
			  </h5>
			</div>
			<span class="developer-tag">Designed by Ezzat Mahmoud</span>
		  </div>
		  <div class="header-actions">
			<div class="notification-wrapper me-3" onclick="showNotifications()">
				<i class="fa-regular fa-bell text-white" style="font-size: 20px; cursor: pointer;"></i>
				<span id="bell-badge" class="notification-badge pulse-red"></span>
			</div>
			
        <button class="btn btn-light btn-sm me-2" onclick="signOut()"><i class="fa-solid fa-right-from-bracket me-1"></i> Ø®Ø±ÙˆØ¬</button>
			<button class="theme-toggle" onclick="toggleTheme()">
			  <i class="fa fa-moon" id="themeIcon"></i>
			</button>
		  </div>
		</div>
			<div id="toastMsg" class="custom-toast"></div>
<div id="toast" class="toast" style="display:none;"></div>

<div class="modern-nav-container">
    <ul class="nav nav-pills nav-fill">
        
        <li class="nav-item" id="nav-dash" style="display:none">
            <a class="nav-link modern-nav-item" onclick="showView('dash')">
                <i class="fa fa-chart-pie"></i>
                <span>Ø§Ù„ØªÙ‚Ø±ÙŠØ±</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link active modern-nav-item" onclick="showView('op')">
                <i class="fa fa-calculator"></i>
                <span>Ø¹Ù…Ù„ÙŠØ§Øª</span>
            </a>
        </li>

        <li class="nav-item" id="nav-manage" style="display:none">
            <a class="nav-link modern-nav-item" onclick="showView('manage')">
                <i class="fa fa-sliders"></i>
                <span>Ø¥Ø¯Ø§Ø±Ø©</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link modern-nav-item" onclick="showView('reports')">
                <i class="fa fa-chart-line"></i>
                <span>ØªÙ‚Ø§Ø±ÙŠØ±</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link modern-nav-item" onclick="showView('settings')">
                <i class="fa fa-cog"></i>
                <span>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
            </a>
        </li>

    </ul>
</div>
			  <div id="view-dash" class="view-section" style="display:none;">
				<div id="dashContent">
				  <div class="text-center p-5 text-muted"><i class="fa fa-circle-notch fa-spin fa-2x mb-3"></i><br>Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±...</div>
				</div>
			  </div>

		<div id="view-op" class="view-section">
			<ul class="nav nav-pills nav-fill mb-3 bg-card p-2 border">
				<li class="nav-item"><a class="nav-link active" data-op-tab="new-op-tab" onclick="showOpTab(this)">Ø¹Ù…Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</a></li>
				<li class="nav-item"><a class="nav-link" data-op-tab="log-op-tab" onclick="showOpTab(this)">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</a></li>
			</ul>
			
<div id="new-op-tab" class="op-tab-content">
    <div id="operationCardsContainer">
        
<div class="op-group-title"><i class="fas fa-layer-group text-primary"></i> Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
<div class="services-grid">
    
    <div class="service-col">
        <div class="op-card card-fawry" onclick="openProviderSelect('client_withdraw')">
            <i class="fas fa-arrow-up-from-bracket text-primary"></i>
            <span>Ø³Ø­Ø¨ Ù…Ù† Ø¹Ù…ÙŠÙ„</span>
        </div>
    </div>
    
    <div class="service-col">
        <div class="op-card card-fawry" onclick="openProviderSelect('pay_bill')">
            <i class="fa fa-file-invoice text-success"></i>
            <span>Ø¯ÙØ¹ ÙÙˆØ§ØªÙŠØ±</span>
        </div>
    </div>

    <div class="service-col">
        <div class="op-card card-fawry" onclick="openProviderSelect('cash_supply')">
            <i class="fas fa-money-bill-transfer text-warning"></i>
            <span>ØªØ²ÙˆÙŠØ¯ (Ø³Ø­Ø¨ ÙƒØ§Ø´)</span>
        </div>
    </div>

    <div class="service-col">
        <div class="op-card card-fawry" onclick="openProviderSelect('visa_withdraw')">
            <i class="fas fa-credit-card text-danger"></i>
            <span>Ø³Ø­Ø¨ ÙÙŠØ²Ø§</span>
        </div>
    </div>
</div>
        <div class="op-group-title"><i class="fa fa-vault text-secondary"></i> Ø§Ù„Ø®Ø²Ù†Ø© ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
        <div class="services-grid">
            <div class="service-col"><div class="op-card card-safe" onclick="setOp('Ù…ØµØ±ÙˆÙØ§Øª', 'SAFE', this)"><i class="fa fa-coins"></i><span>Ù…ØµØ§Ø±ÙŠÙ</span></div></div>
            <div class="service-col"><div class="op-card card-safe" onclick="setOp('Ø³Ø­Ø¨ Ø¯ÙŠÙ†', 'SAFE', this)"><i class="fa fa-user-minus"></i><span>Ø³Ø­Ø¨ Ø¯ÙŠÙ† ( Ø¹Ù„ÙŠÙ‡ )</span></div></div>
            <div class="service-col"><div class="op-card card-safe" onclick="setOp('Ø³Ø¯Ø§Ø¯ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©', 'SAFE', this)"><i class="fa fa-user-check"></i><span>Ø³Ø¯Ø§Ø¯ Ø¯ÙŠÙ† ( Ù„Ù‡ )</span></div></div>
        </div>
                <div class="op-group-title"><i class="fa fa-mobile-screen text-info"></i> Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</div>
        <div class="services-grid">
            <div class="service-col"><div class="op-card card-wallets" onclick="setOp('Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ù…Ø­ÙØ¸Ø©', 'WALLET', this)"><i class="fa fa-upload text-primary"></i><span>Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ù…Ø­ÙØ¸Ø©</span></div></div>
            <div class="service-col"><div class="op-card card-wallets" onclick="setOp('Ø³Ø­Ø¨ Ù…Ù† Ù…Ø­ÙØ¸Ø©', 'WALLET', this)"><i class="fa fa-download text-success"></i><span>Ø³Ø­Ø¨ Ù…Ù† Ù…Ø­ÙØ¸Ø©</span></div></div>
        </div>
    </div>

    <input type="hidden" id="type" value="">
    <div id="pinnedWallets" class="mb-2 d-flex flex-wrap gap-2 justify-content-center"></div>

    <div class="card-box">
        <label class="small fw-bold text-muted mb-1"><i class="fa fa-wallet me-1"></i> Ø§Ù„Ù…Ø­ÙØ¸Ø© / Ø§Ù„Ø®Ø²Ù†Ø©</label>
        <div class="input-group mb-2">
            <select id="wallet" class="form-select english-num" onchange="updateLimitDisplay()">
                <option>...</option>
            </select>
            <button class="btn btn-outline-secondary" onclick="loadWallets()"><i class="fa fa-sync"></i></button>
        </div>
        <div id="limitStatus" style="display:none; margin-bottom:10px;"></div>
        
        <div class="row g-3 mb-3">
            <div class="col-7">
                <label class="small fw-bold text-muted mb-1">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                <input type="text" id="amount" class="form-control text-center english-num" placeholder="0.00" onkeyup="formatNumberInput(this)">
            </div>
            <div class="col-5">
                <label class="small fw-bold text-muted mb-1">Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</label>
                <input type="text" id="comm" class="form-control text-center english-num" placeholder="0" value="0" onkeyup="formatNumberInput(this)">
            </div>
        </div>
        
        <div id="commDestinationContainer" class="mb-3" style="display:none;">
            <label class="small fw-bold mb-1"><i class="fas fa-hand-holding-usd me-1"></i> ÙˆØ¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©/Ø§Ù„Ø±Ø¨Ø­</label>
            <select id="commDestination" class="form-select">
                <option value="CASH" selected>ğŸ’° Ø§Ù„Ø®Ø²Ù†Ø© (Ø§Ù„ÙƒØ§Ø´) - Ø§ÙØªØ±Ø§Ø¶ÙŠ</option>
                <option value="WALLET">ğŸ“± Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</option>
            </select>
        </div> 
        
        <div id="deductCommContainer" class="mb-3 form-check form-switch px-4" style="display:none;">
            <input class="form-check-input" type="checkbox" id="deductCommFromAmount">
            <label class="form-check-label small fw-bold text-danger" for="deductCommFromAmount">
                 Ø®ØµÙ… Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© Ù…Ù† ÙƒØ§Ø´ Ø§Ù„Ø®Ø²Ù†Ø©
            </label>
        </div>                 
        
        <div id="clientFieldContainer" class="mb-2" style="display:none;">
            <label class="small fw-bold">Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
            <select id="client" class="form-select" onchange="fetchClientBalance()">
                <option value="">Ø§Ø®ØªØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„...</option>
            </select>
            <div id="clientBalanceStatus" class="small fw-bold mt-1 text-center"></div>
        </div>
        
        <div class="mb-3">
            <label class="small fw-bold text-muted mb-1">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
            <input type="text" id="note" class="form-control" placeholder="Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©...">
        </div>
        <button type="button" id="btnRun" class="btn-main" onclick="runTransaction()">ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
    </div>
</div>
<div id="providerModal" class="modal-overlay" style="display:none; z-index: 10000;">
    <div class="modal-box" style="max-width: 320px;">
        <h6 class="text-center fw-bold mb-4">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ù†ÙØ°Ø©</h6>
        <input type="hidden" id="selectedServiceKey">
        <div id="providerButtonsGrid" class="d-grid gap-2">
            </div>
        <button class="btn btn-light w-100 mt-3 border" onclick="closeProviderModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>
<div id="log-op-tab" class="op-tab-content" style="display:none;">
    <div class="card-box mb-3 p-2 sticky-top" style="z-index: 99; border-bottom: 3px solid #3b82f6;">
        <div class="d-flex flex-wrap gap-2 align-items-center">
            <div class="flex-grow-1 position-relative" style="min-width: 200px;">
                <input type="text" id="advSearchText" class="form-control form-control-sm ps-5 rounded-pill border-0 bg-light" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ (Ø¹Ù…ÙŠÙ„ØŒ Ù…Ø­ÙØ¸Ø©ØŒ Ù…Ø¨Ù„Øº)..." onkeyup="executeAdvancedSearch()">
                <i class="fa fa-search text-muted position-absolute top-50 start-0 translate-middle-y ms-3"></i>
            </div>
            <div style="width: 140px;">
                <select id="advSearchType" class="form-select form-select-sm border-0 bg-light fw-bold text-primary" onchange="executeAdvancedSearch()" style="border-radius: 10px;">
                    <option value="">ğŸ“‚ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</option>
                    <option value="ÙˆØ§Ø±Ø¯">ğŸŸ¢ ÙˆØ§Ø±Ø¯ (Ø¥ÙŠØ¯Ø§Ø¹)</option>
                    <option value="ØµØ§Ø¯Ø±">ğŸ”´ ØµØ§Ø¯Ø± (Ø³Ø­Ø¨)</option>
                    <option value="Ù…ØµØ±ÙˆÙØ§Øª">ğŸŸ  Ù…ØµØ±ÙˆÙØ§Øª</option>
                    <option value="Ø³Ø­Ø¨ Ù…Ù† Ø¹Ù…ÙŠÙ„">ğŸ‘¤ Ø³Ø­Ø¨ Ù…Ù† Ø¹Ù…ÙŠÙ„</option>
                    <option value="Ø¯ÙØ¹ ÙØ§ØªÙˆØ±Ø©">ğŸ§¾ Ø¯ÙØ¹ ÙÙˆØ§ØªÙŠØ±</option>
                    <option value="Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ù…Ø­ÙØ¸Ø©">ğŸ“± Ø¥ÙŠØ¯Ø§Ø¹ Ù…Ø­ÙØ¸Ø©</option>
                    <option value="Ø³Ø­Ø¨ Ù…Ù† Ù…Ø­ÙØ¸Ø©">ğŸ“² Ø³Ø­Ø¨ Ù…Ø­ÙØ¸Ø©</option>
                </select>
            </div>

            <button class="btn btn-sm btn-light border-0 rounded-circle text-muted" onclick="toggleDateFilters()" title="Ø¨Ø­Ø« Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ®">
                <i class="fa-regular fa-calendar-alt"></i>
            </button>
            
            <button class="btn btn-sm btn-light border-0 rounded-circle text-danger" onclick="resetAdvancedSearch()" title="Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙÙ„Ø§ØªØ±">
                <i class="fa fa-rotate-right"></i>
            </button>
        </div>

        <div id="dateFilterSection" class="row g-2 mt-2 pt-2 border-top" style="display:none; animation: fadeIn 0.3s;">
            <div class="col-6">
                <div class="input-group input-group-sm">
                    <span class="input-group-text bg-transparent border-0 text-muted">Ù…Ù†</span>
                    <input type="date" id="advDateFrom" class="form-control bg-light border-0 rounded" onchange="executeAdvancedSearch()">
                </div>
            </div>
            <div class="col-6">
                <div class="input-group input-group-sm">
                    <span class="input-group-text bg-transparent border-0 text-muted">Ø¥Ù„Ù‰</span>
                    <input type="date" id="advDateTo" class="form-control bg-light border-0 rounded" onchange="executeAdvancedSearch()">
                </div>
            </div>
        </div>
    </div>

    <div class="card-box p-0 shadow-sm border-0">
        <div class="table-responsive" style="max-height: calc(100vh - 250px); overflow-y: auto;">
            <table class="table table-bordered table-sm table-custom text-center small auto-card" id="transactionTableModern">
                <thead class="bg-light sticky-top" style="top: 0; z-index: 1;">
                    <tr>
                        <th width="30">#</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ø¹Ù…Ù„ÙŠØ© / Ø§Ù„Ø­Ø³Ø§Ø¨</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº / Ø§Ù„Ø±Ø¨Ø­</th>
                        <th>Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¹Ø¯</th>
                        <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                        <th>Ø¨ÙˆØ§Ø³Ø·Ø©</th>
                        <th width="50">Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody id="timelineContainer"></tbody>
            </table>
        </div>
        <div id="rowsCountDisplay" class="text-center text-muted small py-2 border-top bg-light"></div>
    </div>
</div>

	<div id="txDetailsModal" class="details-modal-overlay">
		<div class="details-card">
			<button onclick="closeDetailsModal()" style="position:absolute; left:20px; top:20px; background:none; border:none; font-size:18px; color:var(--text-muted);">âœ•</button>
			<div class="text-center mb-4">
				<div id="modalIcon" style="width:60px; height:60px; background:#f3f4f6; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 10px; font-size:24px;"></div>
				<h5 id="modalTitle" class="fw-bold m-0">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h5>
				<div id="modalId" class="text-muted small english-num">#ID</div>
			</div>
			
			<div class="d-flex justify-content-between mb-3 p-3 rounded" style="background:var(--bg-body);">
				<span class="text-muted">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ</span>
				<span id="modalAmount" class="fw-bold english-num fs-5">0.00</span>
			</div>

			<div class="d-flex justify-content-between mb-2 border-bottom pb-2">
				<span class="text-muted small">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</span>
				<span id="modalType" class="fw-bold small"></span>
			</div>
			<div class="d-flex justify-content-between mb-2 border-bottom pb-2">
				<span class="text-muted small">Ø§Ù„Ù…Ø­ÙØ¸Ø© / Ø§Ù„Ø¹Ù…ÙŠÙ„</span>
				<span id="modalWallet" class="fw-bold small"></span>
			</div>
			<div class="d-flex justify-content-between mb-2 border-bottom pb-2">
				<span class="text-muted small">Ø§Ù„Ø±Ø¨Ø­ (Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©)</span>
				<span id="modalProfit" class="fw-bold small text-success english-num"></span>
			</div>
			<div class="d-flex justify-content-between mb-2 border-bottom pb-2">
				<span class="text-muted small">Ù‚Ø§Ù… Ø¨Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</span>
				<span id="modalUser" class="fw-bold small"></span>
			</div>
			<div class="d-flex justify-content-between mb-2">
				<span class="text-muted small">Ø§Ù„ØªÙˆÙ‚ÙŠØª</span>
				<span id="modalTime" class="fw-bold small english-num"></span>
			</div>

			<div class="mt-4 d-flex gap-2">
				<button class="btn btn-primary flex-grow-1" onclick="printCurrentModal()">
					<i class="fa fa-print me-2"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
				</button>
				<button class="btn btn-light border" onclick="closeDetailsModal()">Ø¥ØºÙ„Ø§Ù‚</button>
			</div>
		</div>
	</div>        </div>
		</div>
	</div>
	</div>
				</div>
					  </div>
				  </div>
			  </div>
					<div id="view-manage" class="view-section" style="display:none;">
				
				<ul class="nav nav-pills nav-fill mb-3 bg-card p-2 rounded-3 border">
					<li class="nav-item"><a class="nav-link active" data-tab="clients-tab" onclick="showManageTab(this)"><i class="fa fa-users"></i> Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a></li>
					<li class="nav-item"><a class="nav-link" data-tab="accounts-tab" onclick="showManageTab(this)"><i class="fa fa-cogs"></i> Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</a></li>
					<li class="nav-item"><a class="nav-link" data-tab="users-tab" onclick="showManageTab(this)"><i class="fa fa-user-friends"></i> Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</a></li>
					<li class="nav-item"><a class="nav-link" data-tab="logs-tab" onclick="showManageTab(this)"><i class="fa fa-clipboard-list"></i> Ø§Ù„Ø³Ø¬Ù„</a></li>
				  <li class="nav-item"><a class="nav-link" onclick="showView('counter')"><i class="fa fa-money-bill-1"></i> Ø¹Ø¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</a></li>
				</ul>

<div id="clients-tab" class="manage-tab-content">
  <div class="card-box border-primary mb-3" style="border-width:1px; border-style:dashed; padding: 15px;">
    <h6 class="text-center mb-3 text-primary fw-bold"><i class="fa fa-user-plus"></i> Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h6>
    
    <div class="row g-2 mb-3">
      <div class="col-7">
        <input type="text" id="newClName" class="form-control form-control-sm" placeholder="Ø§Ù„Ø§Ø³Ù…">
      </div>
      <div class="col-5">
        <input type="text" id="newClPhone" class="form-control form-control-sm english-num" placeholder="Ù…ÙˆØ¨Ø§ÙŠÙ„">
      </div>
    </div>
    <button id="btnAddClient" class="btn-main w-100 mb-3" onclick="addClient()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
    
    <div class="text-center small text-muted mb-2 fw-bold" style="background: #f8f9fa; padding: 8px; border-radius: 5px;">
      Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†
    </div>
    
    <div id="manage-clients-body" style="max-height: 400px; overflow-y: auto; padding: 5px;">
        </div>
  </div>
</div>				
<div id="accounts-tab" class="manage-tab-content" style="display:none;">
    <div class="card-box">
        <h6 class="text-center mb-3 text-secondary fw-bold">Ø¥Ø¶Ø§ÙØ© Ù…Ø­ÙØ¸Ø© / Ø´Ø±ÙƒØ©</h6>
        <div class="input-group mb-2">
            <select id="newAccType" class="form-select" style="max-width: 80px;">
                <option value="Wallet">Ù…Ø­ÙØ¸Ø©</option>
                <option value="Company">Ø´Ø±ÙƒØ©</option>
            </select>
            <input type="text" id="newAccName" class="form-control english-num" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© / Ø±Ù‚Ù… ØªÙ„ÙŠÙÙˆÙ† Ø§Ù„Ù…Ø­ÙØ¸Ø©">
        </div>
        <button id="btnAddWallet" class="btn-main" onclick="addWallet()">Ø§Ø¶Ù€Ù€Ù€Ù€Ø§ÙÙ€Ù€Ø©</button>
    </div>
    <div class="card-box p-0">
        <div id="accList" style="max-height: 400px; overflow-y: auto;"></div>
    </div>
</div>

				<div id="users-tab" class="manage-tab-content" style="display:none;">
				  <div class="card-box">
					<h6 class="text-center">ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„</h6>
					<input type="email" id="uEmail" class="form-control mb-2 english-num" placeholder="user@gmail.com">
					<input type="text" id="uName" class="form-control mb-2" placeholder="Ø§Ù„Ø§Ø³Ù…">
					<select id="uRole" class="form-select mb-2">
						<option value="USER">Ù…ÙˆØ¸Ù</option>
						<option value="ADMIN">Admin Assistant</option>
					</select>
					<button id="btnAddUser" class="btn-main" onclick="addUser()">Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ</button>
					<div id="usersList" class="mt-2"></div>
				  </div>
				</div>
				
				<div id="logs-tab" class="manage-tab-content" style="display:none;">
				  <div class="card-box p-0">
					<div id="adminLogsDiv" style="max-height: 400px; overflow-y: auto;">
						<div class="text-center p-5 text-muted"><i class="fa fa-circle-notch fa-spin fa-2x mb-3"></i><br>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„...</div>
					</div>
				  </div>
				</div>

			  </div>
		<div id="view-counter" class="view-section" style="display:none;">
			<div class="card-box shadow-sm border-0 mb-3 text-center" 
				style="background: linear-gradient(135deg, var(--header-grad-1), var(--header-grad-2)); border-radius: 20px; padding: 25px;">
				<div class="py-2">
					<div class="small text-white-50 text-uppercase mb-1 fw-bold" style="letter-spacing: 1.5px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Ø§Ù„ÙØ¹Ù„ÙŠ</div>
					<div class="text-white h1 fw-bold m-0 english-num" style="font-size: 50px;">
						<span id="total-cash">0</span> <small class="fs-5 opacity-75">Ø¬.Ù…</small>
					</div>
				</div>
				
				<div id="reconciliation-badge" class="mt-3 p-2 rounded-3 mx-2 mb-2" 
					style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); display:none; backdrop-filter: blur(10px);">
					<div class="d-flex justify-content-between align-items-center px-2 text-white">
						<span id="diff-label" class="small fw-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</span>
						<span id="diff-value" class="fw-bold english-num" style="font-size: 18px;">0</span>
					</div>
				</div>

		<div class="mt-2">
			<span class="badge rounded-pill bg-dark bg-opacity-25 p-2 px-3">
				<i class="fa fa-vault me-1 text-info"></i> Ø±ØµÙŠØ¯ Ø§Ù„Ø³ÙŠØ³ØªÙ…: 
				<span id="system-vault-val" class="english-num fw-bold ms-1">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
				<i class="fas fa-sync-alt ms-2 text-white-50 shadow-sm" 
				  id="refresh-vault-btn"
				  style="cursor: pointer; transition: 0.3s;" 
				  onclick="fetchVaultBalance()" 
				  title="ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„Ø³ÙŠØ³ØªÙ…"></i>
			</span>
		</div>
			<div class="card-box shadow-sm border-0 mb-3">
				<div class="d-flex justify-content-between align-items-center mb-4">
					<h6 class="fw-bold m-0 text-main" style="font-size: 16px;"><i class="fas fa-cash-register me-2 text-primary"></i>Ø¬Ø±Ø¯ Ø§Ù„Ø®Ø²Ù†Ø©</h6>
					<button class="btn btn-sm btn-light rounded-pill px-3 fw-bold text-muted" onclick="resetCounter()">
						<i class="fa fa-sync-alt me-1"></i> ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯
					</button>
				</div>
				<div id="denominations-container" class="row g-3"></div>
			</div>

			<div class="card-box admin-only-section shadow-sm" id="manage-denoms" style="display:none; border-top: 4px solid var(--header-grad-1); background: var(--bg-body);">
				<h6 class="fw-bold mb-3 text-main small"><i class="fa fa-gears me-2"></i>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙØ¦Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø© (Admin)</h6>
				<div class="row g-2 mb-3">
					<div class="col-8">
						<input type="number" id="new-denom-val" class="form-control form-control-sm" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ¦Ø©">
					</div>
					<div class="col-4">
						<button class="btn btn-primary btn-sm w-100 fw-bold" onclick="addNewDenomination()">Ø¥Ø¶Ø§ÙØ©</button>
					</div>
				</div>
				<div id="delete-denoms-list" class="d-flex flex-wrap gap-2"></div>
			</div>
		</div>
	</div>

	<div id="view-reports" class="view-section" style="display:none;">
		
		<ul class="nav nav-pills nav-fill mb-3 bg-card p-2 border rounded-3">
			<li class="nav-item"><a class="nav-link active" onclick="switchReportTab('z-report')">ğŸ“… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</a></li>
			<li class="nav-item"><a class="nav-link" onclick="switchReportTab('wallet-intel')">ğŸ¦… Ø§Ù„Ù…Ø­Ø§ÙØ¸</a></li>
			<li class="nav-item"><a class="nav-link" onclick="switchReportTab('peak-hours')">â° Ø§Ù„Ø°Ø±ÙˆØ©</a></li>
			<li class="nav-item admin-only" style="display:none"><a class="nav-link" onclick="switchReportTab('pnl-chart')">ğŸ“ˆ Ø£Ø±Ø¨Ø§Ø­</a></li>
		</ul>

		<div id="rep-z-report" class="report-content">
			<div class="card-box mb-3">
				<h6 class="fw-bold m-0 mb-2 text-primary">ÙØªØ±Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h6>
				<div class="d-flex gap-2 align-items-end">
					<div class="flex-grow-1"><label class="small text-muted">Ù…Ù†</label><input type="date" id="zDateFrom" class="form-control form-control-sm"></div>
					<div class="flex-grow-1"><label class="small text-muted">Ø¥Ù„Ù‰</label><input type="date" id="zDateTo" class="form-control form-control-sm"></div>
					<button class="btn btn-primary btn-sm" style="height: 31px;" onclick="loadZReport()"><i class="fa fa-search"></i></button>
				</div>
			</div>

			<div id="zReportResult" style="display:none;">
				<div class="row g-2 mb-3">
					<div class="col-4"><div class="stat-box-modern border-success border-opacity-25 bg-success bg-opacity-10"><div class="intel-val text-success" id="zIn">0</div><div class="intel-label">ÙˆØ§Ø±Ø¯</div></div></div>
					<div class="col-4"><div class="stat-box-modern border-danger border-opacity-25 bg-danger bg-opacity-10"><div class="intel-val text-danger" id="zOut">0</div><div class="intel-label">ØµØ§Ø¯Ø±</div></div></div>
					<div class="col-4"><div class="stat-box-modern border-primary border-opacity-25 bg-primary bg-opacity-10"><div class="intel-val text-primary" id="zProf">0</div><div class="intel-label">Ø±Ø¨Ø­</div></div></div>
				</div>
				
				<div class="row">
					<div class="col-md-6 mb-3">
						<div class="card-box h-100">
							<h6 class="fw-bold small text-muted mb-3 border-bottom pb-2">ğŸ‘¨â€ğŸ’» Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚</h6>
							<div id="zUsersTable"></div>
						</div>
					</div>
					
					<div class="col-md-6 mb-3">
						<div class="card-box h-100">
							<h6 class="fw-bold small text-muted mb-3 border-bottom pb-2">ğŸ”¥ Ø£Ø¨Ø±Ø² Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h6>
							<div id="topTransList" class="trans-list-container">
								</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div id="rep-wallet-intel" class="report-content" style="display:none;">
			<div class="d-flex justify-content-between mb-3 px-2">
				<div><h6 class="fw-bold text-primary m-0">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸</h6><small class="text-muted">Ø§Ù„Ø£Ø±ØµØ¯Ø© ÙˆÙ…Ø¹Ø¯Ù„ Ø§Ù„Ø¯ÙˆØ±Ø§Ù†</small></div>
				<button class="btn btn-sm btn-light border rounded-pill" onclick="loadWalletIntel()"><i class="fa fa-sync-alt"></i></button>
			</div>
			<div id="walletGridArea" class="wallet-grid-pro"></div>
		</div>

		<div id="rep-peak-hours" class="report-content" style="display:none;">
			<div class="card-box mb-3">
				<div class="d-flex justify-content-between align-items-center mb-3">
					<h6 class="fw-bold m-0 text-primary">ğŸ“… Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„</h6>
					<div class="btn-group btn-group-sm">
						<input type="radio" class="btn-check" name="dayMetric" id="btnCount" checked onclick="updateDayChart('count')">
						<label class="btn btn-outline-primary" for="btnCount">Ø§Ù„Ø¹Ø¯Ø¯</label>
						<input type="radio" class="btn-check" name="dayMetric" id="btnProfit" onclick="updateDayChart('profit')">
						<label class="btn btn-outline-success" for="btnProfit">Ø§Ù„Ø±Ø¨Ø­</label>
					</div>
				</div>
				<div style="position: relative; height: 200px; width: 100%;"><canvas id="busyDaysChart"></canvas></div>
			</div>
			<div class="card-box mb-3 text-center">
				<div class="d-flex justify-content-between align-items-center mb-3">
					<h6 class="fw-bold m-0"><i class="fa fa-clock text-danger me-2"></i>Ø§Ù„Ø³Ø§Ø¹Ø§Øª</h6>
					<input type="date" id="peakDateFilter" class="form-control form-control-sm shadow-sm" style="width: auto;" onchange="loadPeakHoursChart()">
				</div>
				<p class="text-muted small mb-2" id="peakChartTitle">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</p>
				<div style="position: relative; height: 220px; width: 100%;"><canvas id="peakHoursChart"></canvas></div>
			</div>
			<div class="card-box mt-3">
				<h6 class="fw-bold small mb-2 text-warning"><i class="fa fa-trophy me-1"></i> Ø£ÙØ¶Ù„ 5 Ø£ÙŠØ§Ù…</h6>
				<ul class="list-group list-group-flush small" id="topDatesList">
					<li class="list-group-item text-center text-muted">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</li>
				</ul>
			</div>
		</div>

		<div id="rep-pnl-chart" class="report-content" style="display:none;">
			<div class="card-box mb-3">
				<h6 class="fw-bold text-center mb-3">Ù†Ù…Ùˆ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (30 ÙŠÙˆÙ…)</h6>
				<div style="height: 250px;"><canvas id="profitChart"></canvas></div>
			</div>
		</div>
	</div>
	<div id="view-settings" class="view-section" style="display:none;"> 
				   <h6 class="text-muted small fw-bold mb-3"><i class="fa fa-wrench"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</h6>
				  <div class="card-box mb-3 d-flex justify-content-between align-items-center">
					<label class="fw-bold">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† (Dark Mode)</label>
					<button class="btn btn-sm btn-light border text-muted" onclick="toggleTheme()"><i class="fa fa-toggle-off" id="darkModeToggleIcon"></i></button>
				  </div>
				  
		<div id="adminSettingsSection" style="display: none;">
			<h6 class="text-muted small fw-bold mb-3 mt-4"><i class="fa fa-chart-bar"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h6>
			<div class="card-box">
				<div class="mb-3">
					<label class="fw-bold d-block mb-1">ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙŠØ¯ÙˆÙŠØ§Ù‹</label>
					<button class="btn-main" id="btnDrawDashboard" onclick="runDrawDashboard()">ØªØ­Ø¯ÙŠØ« Ø±Ø³ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
				</div>
				<div class="small text-muted text-center mb-3">ÙŠØ³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© ÙÙ‚Ø· ÙÙŠ Ø­Ø§Ù„Ø© Ø¸Ù‡ÙˆØ± Ø±Ø³ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ (Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©) ÙÙŠ Ø§Ù„Ø´ÙŠØª ØºÙŠØ± ÙˆØ§Ø¶Ø­Ø©.</div>

				<div class="mb-3">
					<label class="fw-bold d-block mb-1">ÙØ­Øµ ÙˆØ¥ØµÙ„Ø§Ø­ Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</label>
					<button class="btn-main" id="btnCheckSheets" onclick="runCheckSheets()">ÙØ­Øµ ÙˆØ¥ØµÙ„Ø§Ø­ Ø§Ù„Ø´ÙŠØªØ§Øª</button>
				</div>
				<div class="small text-muted text-center">ÙŠÙ‚ÙˆÙ… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠ Ø¬Ø¯ÙˆÙ„ Ù…ÙÙ‚ÙˆØ¯ Ø£Ùˆ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.</div>
			</div>
		</div>

			</div>

		<div id="editModal" class="modal-overlay">
			  <div class="modal-box">
				<h6 class="mb-3 text-center fw-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</h6>
				<input type="hidden" id="editRow">
				
				<div class="mb-2">
				  <label class="small">Ø§Ù„Ø§Ø³Ù…</label>
				  <input type="text" id="editName" class="form-control text-center english-num">
				</div>
<div class="mb-2">
    <label class="small fw-bold">Ù„ÙˆÙ† Ø§Ù„ÙˆØ³Ù…</label>
    <input type="color" id="editColorPicker" class="form-control form-control-color" value="#000000">
</div>
  				<div class="row g-2 mb-2">
				  <div class="col-6"><label class="small">ØµØ§Ø¯Ø± ÙŠÙˆÙ…ÙŠ</label><input type="number" id="editLo" class="form-control text-center english-num"></div>
				  <div class="col-6"><label class="small">ÙˆØ§Ø±Ø¯ ÙŠÙˆÙ…ÙŠ</label><input type="number" id="editLi" class="form-control text-center english-num"></div>
				</div>
				
				<div class="mb-2">
				  <label class="small">Ø­Ø¯ Ø´Ù‡Ø±ÙŠ</label>
				  <input type="number" id="editLm" class="form-control text-center english-num">
				</div>

				<div class="mb-3">
				  <label class="small text-primary fw-bold">ØªØ³ÙˆÙŠØ© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (Ø¥Ø¶Ø§ÙØ©/Ø®ØµÙ…)</label>
				  <input type="text" id="editProfitAdj" class="form-control text-center english-num" placeholder="0" onkeyup="formatNumberInput(this)">
				  <small class="text-muted" style="font-size: 10px;">Ø§Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº Ù„ØªØ¹Ø¯ÙŠÙ„ Ø±ØµÙŠØ¯ Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ø­ÙØ¸Ø©</small>
				</div>

				<div class="d-flex gap-2">
				  <button id="btnSaveEdit" class="btn btn-primary flex-grow-1" onclick="saveEdit()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
				  <button class="btn btn-light border text-muted" onclick="closeEdit()">Ø¥Ù„ØºØ§Ø¡</button>
				</div>
			  </div>
			</div>
				<div id="editClientModal" class="modal-overlay">
			  <div class="modal-box">
				<h6 class="mb-3 text-center fw-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„</h6>
				<input type="hidden" id="editClRow">
				<div class="mb-2"><label class="small">Ø§Ù„Ø§Ø³Ù…</label><input type="text" id="editClName" class="form-control text-center"></div>
				<div class="mb-2"><label class="small">Ù…ÙˆØ¨Ø§ÙŠÙ„</label><input type="text" id="editClPhone" class="form-control text-center english-num"></div>
				<div class="mb-3"><label class="small">Ø§Ù„Ø±ØµÙŠØ¯ (ÙŠØ¯ÙˆÙŠ)</label><input type="number" id="editClBal" class="form-control text-center english-num"></div>
				<div class="d-flex gap-2">
				<button id="btnSaveCl" class="btn btn-primary flex-grow-1" onclick="saveEditClient()">Ø­ÙØ¸</button>
				  <button class="btn btn-light border text-muted" onclick="closeEditCl()">Ø¥Ù„ØºØ§Ø¡</button>
				</div>
			  </div>
			</div>

			<div id="editRoleModal" class="modal-overlay">
			  <div class="modal-box">
				<h6 class="mb-3 text-center fw-bold">ØªØ¹Ø¯ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h6>
				<input type="hidden" id="editRoleEmail">
				<input type="hidden" id="editRoleName">
				
				<div class="mb-3 text-center">
					<label class="small text-muted">ØªØ¹Ø¯ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ©:</label>
					<h5 class="fw-bold" id="currentUserName"></h5>
				</div>

				<div class="mb-3">
					<label class="small fw-bold">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
					<select id="newRoleSelect" class="form-select mb-2">
					  <option value="USER">Ù…ÙˆØ¸Ù</option>
					  <option value="ADMIN">Admin Assistant</option>
					</select>
				</div>

				<div class="d-flex gap-2">
				  <button id="btnSaveRole" class="btn btn-primary flex-grow-1" onclick="saveUserRole()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
				  <button class="btn btn-light border text-muted" onclick="closeEditRole()">Ø¥Ù„ØºØ§Ø¡</button>
				</div>
			  </div>
			</div>
		<div id="notificationModal" class="modal-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:10000; justify-content:center; align-items:center; backdrop-filter:blur(3px);">
			<div class="modal-box" style="background:var(--bg-card); width:90%; max-width:380px; padding:20px; border-radius:16px; border:1px solid var(--border-color);">
				<div class="d-flex justify-content-between align-items-center mb-3">
					<h6 class="fw-bold m-0"><i class="fa fa-bell text-warning me-2"></i>Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h6>
					<button class="btn-close" onclick="closeNotificationModal()"></button>
				</div>
				<div id="notificationsList" style="max-height:300px; overflow-y:auto;">
					</div>
				<button class="btn-main mt-3" onclick="closeNotificationModal()">Ø¥ØºÙ„Ø§Ù‚</button>
			</div>
		</div>
		<div id="confirmOpModal" class="modal-overlay">
			<div class="modal-box" style="border-top: 5px solid #3b82f6;">
				<h6 class="fw-bold mb-3 text-center"><i class="fa fa-shield-check text-primary me-2"></i>ØªØ£ÙƒÙŠØ¯ Ù…Ø³Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h6>
				<div id="opLogicDescription" class="p-3 mb-3" style="background: var(--bg-body); border-radius: 12px; font-size: 13px; line-height: 1.6;">
					</div>
				<div class="d-flex gap-2">
					<button id="btnFinalConfirm" class="btn-main flex-grow-1" onclick="executeFinalTransaction()">ØªØ£ÙƒÙŠØ¯ ÙˆØªÙ†ÙÙŠØ¯</button>
					<button class="btn btn-light border text-muted" onclick="closeConfirmModal()">Ø¥Ù„ØºØ§Ø¡</button>
				</div>
			</div>
		</div>
<div id="tagModal" class="modal-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:10000; justify-content:center; align-items:center;">
  <div class="modal-box" style="background:white; padding:20px; border-radius:10px; width:300px;">
    <h6 class="fw-bold mb-3">ğŸ¨ ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ø­ÙØ¸Ø©</h6>
    <input type="hidden" id="tagRow">
    <div class="mb-3">
      <label class="small fw-bold">Ø§Ù„ÙˆØ³Ù… (Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø®ØªØµØ±)</label>
      <input type="text" id="tagInput" class="form-control" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø´Ø®ØµÙŠ">
    </div>
    <div class="mb-3">
      <label class="small fw-bold">Ø§Ù„Ù„ÙˆÙ†</label>
      <input type="color" id="tagColorInput" class="form-control form-control-color w-100">
    </div>
<div class="d-flex gap-1 flex-wrap">
    <button onclick="saveTagSettings()" id="btnSaveTag" class="btn btn-warning flex-grow-1 fw-bold">Ø­ÙØ¸</button>
    
<button onclick="resetTagSettings()" id="btnResetTag" class="btn btn-outline-danger" title="Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…Ø¸Ù‡Ø±">
    <i class="fa-solid fa-trash-can"></i>
</button>
    
    <button onclick="document.getElementById('tagModal').style.display='none'" class="btn btn-light border">Ø¥Ù„ØºØ§Ø¡</button>
</div>	

<div class="modal fade" id="auditModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="true" style="z-index: 99999 !important;">
  <div class="modal-dialog modal-dialog-centered" style="z-index: 100000 !important;">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title fw-bold"><i class="fa fa-chart-bar me-2"></i>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±ØµØ¯Ø©</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body bg-light" id="auditBody" style="max-height: 400px; overflow-y: auto;">
        </div>
    </div>
  </div>
</div>
<div id="securePassModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:100000; align-items:center; justify-content:center; direction:rtl; font-family:'Cairo', sans-serif;">
    <div style="background:white; padding:25px; border-radius:20px; width:85%; max-width:320px; text-align:center; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
        <i class="fa fa-lock" style="font-size:40px; color:#0d6efd; margin-bottom:15px;"></i>
        <h5 style="font-weight:bold; margin-bottom:20px;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø·Ù„ÙˆØ¨Ø©</h5>
        <input type="password" id="secureInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ" style="width:100%; padding:12px; border:2px solid #eee; border-radius:10px; text-align:center; font-size:20px; margin-bottom:20px; outline:none; background:#f9f9f9;">
        <div style="display: flex; gap: 10px;">
            <button onclick="verifySecurePass()" style="flex:2; padding:12px; background:#0d6efd; color:white; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">Ø¯Ø®ÙˆÙ„</button>
            <button onclick="document.getElementById('securePassModal').style.display='none'" style="flex:1; padding:12px; background:#f8f9fa; border:none; border-radius:10px; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>
</div>		<script>
		let selectedProvider = ""; // Ù…ØªØºÙŠØ± Ø¹Ø§Ù… Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø´Ø±ÙƒØ©

		/**
		 * Ø¯Ø§Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ© - Ù…Ø®ØµØµØ© Ù„Ù‚ÙÙ„ Ø§Ù„Ù…Ø­ÙØ¸Ø© ÙÙŠ (Ø³Ø­Ø¨ Ù…Ù† Ø¹Ù…ÙŠÙ„ / Ø¯ÙØ¹ ÙØ§ØªÙˆØ±Ø©) ÙÙ‚Ø·
		 */
function setOp(typeValue, provider, element) {
        const walletSelect = document.getElementById('wallet');
        document.getElementById('type').value = typeValue;
        selectedProvider = provider; 
        
        // 1. ØªÙ…ÙŠÙŠØ² Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ù…Ø®ØªØ§Ø± Ø¨ØµØ±ÙŠØ§Ù‹
        document.querySelectorAll('.op-card').forEach(c => c.classList.remove('active'));
        element.classList.add('active');
        
        // 2. Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø£Ø¶ÙÙ†Ø§ Ø´Ø±Ø· "Ù…Ø´ØªØ±ÙŠØ§Øª" Ù„Ù„Ù‚ÙÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        let isTargetOp = (provider === 'ÙÙˆØ±ÙŠ' || provider === 'Ù…ÙƒØ³Ø¨' || provider === 'Ù…Ø´ØªØ±ÙŠØ§Øª') && 
                        (typeValue.includes("Ø³Ø­Ø¨ Ù…Ù† Ø¹Ù…ÙŠÙ„") || 
                          typeValue.includes("Ø¯ÙØ¹ ÙØ§ØªÙˆØ±Ø©") || 
                          typeValue.includes("Ø³Ø­Ø¨ ÙÙŠØ²Ø§"));    

        if (isTargetOp) {
            let found = false;
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© (Ù…Ø´ØªØ±ÙŠØ§Øª)
            for (let i = 0; i < walletSelect.options.length; i++) {
                if (walletSelect.options[i].text.includes(provider)) { // Ø§Ø³ØªØ®Ø¯Ø§Ù… text Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø§Ø³Ù…
                    walletSelect.selectedIndex = i;
                    found = true;
                    break;
                }
            }
            // Ù‚ÙÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            walletSelect.disabled = true;
            walletSelect.style.backgroundColor = "var(--bg-body)";
            walletSelect.style.cursor = "not-allowed";
        } else {
            // ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
            walletSelect.disabled = false;
            walletSelect.style.backgroundColor = "var(--input-bg)";
            walletSelect.style.cursor = "default";
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
            if (provider === 'ÙÙˆØ±ÙŠ' || provider === 'Ù…ÙƒØ³Ø¨' || provider === 'Ù…Ø´ØªØ±ÙŠØ§Øª') {
                walletSelect.selectedIndex = 0; 
            }
        }
        
        // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        updateLimitDisplay();
        toggleClientField();
    }
    
		function runTransaction() {
			try {
				const amountEl = document.getElementById('amount');
				const typeEl = document.getElementById('type');
				const walletEl = document.getElementById('wallet');
				
				if (!amountEl || !typeEl || !amountEl.value || !typeEl.value) {
					showToast("âš ï¸ Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©", false);
					return;
				}

				const amount = amountEl.value.replace(/,/g, '');
				const type = typeEl.value;
				const wallet = walletEl ? walletEl.value : "";
				const comm = document.getElementById('comm')?.value.replace(/,/g, '') || "0";
				let currentProvider = (typeof selectedProvider !== 'undefined' && selectedProvider) ? selectedProvider : "Ø§Ù„Ø´Ø±ÙƒØ©";

				let logicHtml = "";
				let isCash = (!wallet || wallet.includes("---") || wallet === "");
				let targetAcc = isCash ? "ğŸ’µ Ø§Ù„Ø®Ø²Ù†Ø© (ÙƒØ§Ø´)" : `ğŸ“± Ù…Ø­ÙØ¸Ø© (${wallet})`;

				// --- 1. Ø®Ø¯Ù…Ø§Øª Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø¯ÙØ¹ (ÙÙˆØ±ÙŠ/Ù…ÙƒØ³Ø¨) ---
				if (type.includes("Ø³Ø­Ø¨ Ù…Ù† Ø¹Ù…ÙŠÙ„") || type.includes("ÙØ§ØªÙˆØ±Ø©") || type.includes("ÙÙŠØ²Ø§")) {
					logicHtml = `
						<div style="text-align:center; margin-bottom:20px; display:flex; align-items:center; justify-content:center; gap:15px;">
							<div style="background:#f59e0b; color:#fff; padding:15px; border-radius:15px; font-weight:900; font-size:20px;">ğŸ¢ ${currentProvider}</div>
							<span style="font-size:40px;">â¬…ï¸</span>
							<div style="background:#10b981; color:#fff; padding:15px; border-radius:15px; font-weight:900; font-size:20px;">ğŸ’µ Ø§Ù„Ø®Ø²Ù†Ø©</div>
						</div>
						<div style="background:#fff; color:#000; padding:20px; border-radius:15px; border:4px solid #f59e0b; font-size:18px; font-weight:900; line-height:1.6; text-align:right; direction:rtl;">
							â€¢ ğŸ“¤ Ø±ØµÙŠØ¯ <b>${currentProvider} Ù‡ÙŠÙ‚Ù„</b> (Ù„Ø£Ù† Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø© Ø¯ÙØ¹Øª).<br>
							â€¢ ğŸ“¥ Ø±ØµÙŠØ¯ <b>Ø§Ù„Ø®Ø²Ù†Ø© Ù‡ÙŠØ²ÙŠØ¯</b> (Ù„Ø£Ù†Ùƒ Ø§Ø³ØªÙ„Ù…Øª ÙƒØ§Ø´ ÙÙŠ Ø¥ÙŠØ¯Ùƒ).
						</div>`;
				} 
				// --- 2. Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø§ÙØ¸ (Ø³Ø­Ø¨ ÙˆØ¥ÙŠØ¯Ø§Ø¹) ---
					else if (type === "Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ù…Ø­ÙØ¸Ø©") {

					logicHtml = `     
						<div style="text-align:center; margin-bottom:20px; display:flex; align-items:center; justify-content:center; gap:15px;">
							<div style="background:#3b82f6; color:#fff; padding:15px; border-radius:15px; font-weight:900; font-size:20px;">ğŸ“± Ø§Ù„Ù…Ø­ÙØ¸Ø©</div>
							<span style="font-size:40px;">â¬…ï¸</span>
							<div style="background:#10b981; color:#fff; padding:15px; border-radius:15px; font-weight:900; font-size:20px;">ğŸ’µ Ø§Ù„Ø®Ø²Ù†Ø©</div>
						</div>
						<div style="background:#fff; color:#000; padding:20px; border-radius:15px; border:4px solid #3b82f6; font-size:18px; font-weight:900; line-height:1.6; text-align:right; direction:rtl;">
							â€¢ ğŸ“¥ Ø±ØµÙŠØ¯Ùƒ ÙÙŠ <b>Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù‡ÙŠØ²ÙŠØ¯</b> (ØªØ­ÙˆÙŠÙ„ Ø±Ù‚Ù…ÙŠ Ø¬Ø§Ù„Ùƒ).<br>
							â€¢ ğŸ“¤ Ø±ØµÙŠØ¯ <b>Ø§Ù„Ø®Ø²Ù†Ø© Ù‡ÙŠÙ‚Ù„</b> (Ù„Ø£Ù†Ùƒ Ø³Ù„Ù…Øª ÙƒØ§Ø´ Ù„Ù„Ø¹Ù…ÙŠÙ„).
						</div>`;
				}
		 else if (type === "Ø³Ø­Ø¨ Ù…Ù† Ù…Ø­ÙØ¸Ø©") {
					logicHtml = `
						<div style="text-align:center; margin-bottom:20px; display:flex; align-items:center; justify-content:center; gap:15px;">
							<div style="background:#10b981; color:#fff; padding:15px; border-radius:15px; font-weight:900; font-size:20px;">ğŸ’µ Ø§Ù„Ø®Ø²Ù†Ø©</div>
							<span style="font-size:40px;">â¬…ï¸</span>
							<div style="background:#3b82f6; color:#fff; padding:15px; border-radius:15px; font-weight:900; font-size:20px;">ğŸ“± Ø§Ù„Ù…Ø­ÙØ¸Ø©</div>
						</div>
						<div style="background:#fff; color:#000; padding:20px; border-radius:15px; border:4px solid #10b981; font-size:18px; font-weight:900; line-height:1.6; text-align:right; direction:rtl;">
							â€¢ ğŸ“¥ Ø±ØµÙŠØ¯ <b>Ø§Ù„Ø®Ø²Ù†Ø© Ù‡ÙŠØ²ÙŠØ¯</b> (Ù„Ø£Ù†Ùƒ Ø§Ø³ØªÙ„Ù…Øª ÙƒØ§Ø´ ÙˆØ±Ù‚).<br>
							â€¢ ğŸ“¤ Ø±ØµÙŠØ¯Ùƒ ÙÙŠ <b>Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù‡ÙŠÙ‚Ù„</b> (Ù„Ø£Ù†Ùƒ Ø­ÙˆÙ„Øª Ù„Ù„Ø¹Ù…ÙŠÙ„).
						</div>`;
				}
				// --- 3. Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¯ÙŠÙˆÙ† (Ø³Ø­Ø¨ ÙˆØ³Ø¯Ø§Ø¯) ---
				else if (type.includes("Ø³Ø­Ø¨ Ø¯ÙŠÙ†")) {
					logicHtml = `
						<div style="text-align:center; margin-bottom:20px; display:flex; align-items:center; justify-content:center; gap:15px;">
							<div style="background:#10b981; color:#fff; padding:15px; border-radius:15px; font-weight:900; font-size:20px;">${targetAcc}</div>
							<span style="font-size:40px;">â¬…ï¸</span>
							<div style="background:#ef4444; color:#fff; padding:15px; border-radius:15px; font-weight:900; font-size:20px;">ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
						</div>
						<div style="background:#fff; color:#000; padding:20px; border-radius:15px; border:4px solid #ef4444; font-size:18px; font-weight:900; line-height:1.6; text-align:right; direction:rtl;">
							â€¢ ğŸ“¤ Ø±ØµÙŠØ¯ <b>${targetAcc} Ù‡ÙŠÙ‚Ù„</b> (Ø¨Ø¶Ø§Ø¹Ø©/ÙÙ„ÙˆØ³ Ø®Ø±Ø¬Øª).<br>
							â€¢ ğŸ“ˆ Ø¯ÙŠÙˆÙ† <b>Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù‡ØªØ²ÙŠØ¯</b> (ÙŠØ¹Ù†ÙŠ Ø¨Ù‚Ù‰ Ø¹Ù„ÙŠÙ‡ ÙÙ„ÙˆØ³ Ø£ÙƒØªØ±).
						</div>`;
				}
				else if (type.includes("Ø³Ø¯Ø§Ø¯ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©")) {
					logicHtml = `
						<div style="text-align:center; margin-bottom:20px; display:flex; align-items:center; justify-content:center; gap:15px;">
							<div style="background:#4b5563; color:#fff; padding:15px; border-radius:15px; font-weight:900; font-size:20px;">ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
							<span style="font-size:40px;">â¬…ï¸</span>
							<div style="background:#10b981; color:#fff; padding:15px; border-radius:15px; font-weight:900; font-size:20px;">${targetAcc}</div>
						</div>
						<div style="background:#fff; color:#000; padding:20px; border-radius:15px; border:4px solid #10b981; font-size:18px; font-weight:900; line-height:1.6; text-align:right; direction:rtl;">
							â€¢ ğŸ“¥ Ø±ØµÙŠØ¯ <b>${targetAcc} Ù‡ÙŠØ²ÙŠØ¯</b> (Ù„Ø£Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¯ÙØ¹ ÙƒØ§Ø´).<br>
							â€¢ ğŸ“‰ Ø¯ÙŠÙˆÙ† <b>Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù‡ØªÙ‚Ù„</b> (Ù„Ø£Ù†Ù‡ Ø³Ø¯Ø¯ Ø§Ù„Ù„ÙŠ Ø¹Ù„ÙŠÙ‡).
						</div>`;
				}
				// --- 4. Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ²ÙˆÙŠØ¯ (Ù†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙˆØ§Ù„Ø´Ø±ÙƒØ§Øª) ---
		// --- 6. Ù…Ø¬Ù…ÙˆØ¹Ø©: Ø³Ø­Ø¨ ÙƒØ§Ø´ ØªØ²ÙˆÙŠØ¯ Ø±ØµÙŠØ¯ (Ù†Ù‚Ù„ Ù…Ù† Ù…Ø­ÙØ¸Ø© Ù„Ø´Ø±ÙƒØ©) ---
		else if (type.includes("ØªØ²ÙˆÙŠØ¯") || type.includes("Ø³Ø­Ø¨ ÙƒØ§Ø´")) {
			logicHtml = `
				<div style="display:flex; align-items:center; justify-content:center; gap:10px; margin-bottom:15px;">
					<span style="background:#3b82f6; color:#fff; padding:8px 12px; border-radius:10px; font-weight:bold; font-size:15px;">ğŸ“± Ø§Ù„Ù…Ø­ÙØ¸Ø©</span>
					<span style="font-size:20px; color:var(--text-main);">â®•</span>
					<span style="background:#f59e0b; color:#fff; padding:8px 12px; border-radius:10px; font-weight:bold; font-size:15px;">ğŸ¢ ${currentProvider}</span>
				</div>
				<div style="background:var(--bg-body); color:var(--text-main); padding:12px; border-radius:10px; border:1px solid #3b82f6; font-size:14px; line-height:1.6; text-align:right; direction:rtl;">
					âš ï¸ <b>ØªÙˆØ¶ÙŠØ­ Ù‡Ø§Ù… Ù„Ù„Ø¹Ù…Ù„ÙŠØ©:</b><br>
					â€¢ ğŸ“¥ Ø±ØµÙŠØ¯ <b>Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø© (${currentProvider}) Ù‡ÙŠØ²ÙŠØ¯</b> Ø¹Ø´Ø§Ù† ØªÙ‚Ø¯Ø± ØªØ´ØªØºÙ„ ÙˆØªØ¯ÙØ¹ ÙÙˆØ§ØªÙŠØ±.<br>
					â€¢ ğŸ“¤ Ø±ØµÙŠØ¯ <b>Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù‡ÙŠÙ‚Ù„</b> (Ù„Ø£Ù† Ø§Ù„ÙÙ„ÙˆØ³ Ø®Ø±Ø¬Øª Ù…Ù†Ù‡Ø§ Ù„Ù„Ø´Ø±ÙƒØ©).<br>
					â€¢ ğŸš« <b>Ø§Ù„Ø®Ø²Ù†Ø© (Ø§Ù„ÙƒØ§Ø´ Ø§Ù„ÙˆØ±Ù‚) Ù…Ø´ Ù‡ØªØªØ£Ø«Ø±</b>Ø› Ù…ÙÙŠØ´ Ø¬Ù†ÙŠÙ‡ Ù‡ÙŠØ®Ø±Ø¬ Ø£Ùˆ ÙŠØ¯Ø®Ù„ Ø§Ù„Ø¯Ø±Ø¬.
				</div>`;
		}
				globalPendingData = {
					wallet: wallet, type: type, provider: currentProvider, amount: amount,
					comm: comm, client: document.getElementById('client')?.value || "",
					note: document.getElementById('note')?.value || "",
					commDest: document.getElementById('commDestination')?.value || "CASH"
				};

				showCustomConfirmModal(logicHtml);

			} catch (err) {
				alert("Ø®Ø·Ø£: " + err.message);
			}
		}
		function executeFinalTransaction() {
			setLoading('btnFinalConfirm', true);
			google.script.run.withSuccessHandler(res => {
				setLoading('btnFinalConfirm', false);
				closeConfirmModal();
				showToast(res.msg, res.success);
				if (res.success) {
					document.getElementById('amount').value = '';
					loadWallets();
					if(typeof loadDash === "function") loadDash();
					loadTransactionLogs();
				}
			}).processTransaction(pendingData);
		}

		function closeConfirmModal() { document.getElementById('confirmOpModal').style.display = 'none'; }
let isRenderingPins = false; // Ù‚ÙÙ„ Ø£Ù…Ø§Ù† Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±

function renderPinnedWallets() {
    const container = document.getElementById('pinnedWallets');
    if (!container || isRenderingPins) return; // Ù„Ùˆ Ø§Ù„Ø¯Ø§Ù„Ø© Ø´ØºØ§Ù„Ø© Ø¯Ù„ÙˆÙ‚ØªÙ‰ØŒ Ù…ØªØ´ØªØºÙ„Ø´ ØªØ§Ù†ÙŠ

    isRenderingPins = true; // Ù‚ÙÙ„Ù†Ø§ Ø§Ù„Ø¯Ø§Ù„Ø©
    
    google.script.run.withSuccessHandler(data => {
        isRenderingPins = false; // ÙØªØ­Ù†Ø§ Ø§Ù„Ù‚ÙÙ„ Ø¨Ø¹Ø¯ ÙˆØµÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        
        container.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙƒØ§Ù† ØªÙ…Ø§Ù…Ø§Ù‹
        
        const pins = data.filter(a => a.isPinned === true);
        
        if (pins.length === 0) {
            container.innerHTML = '<span class="text-muted small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙØ¸ Ù…Ø«Ø¨ØªØ©.</span>';
            return;
        }

        pins.forEach(w => {
            const btn = document.createElement('div');
            btn.className = 'pin-btn shadow-sm';
            
            let tagHtml = '';
            if (w.tag && w.tag.trim() !== "") {
                tagHtml = `
                <div style="
                    font-size: 10px; 
                    font-weight: bold; 
                    background-color: ${w.color || '#f59e0b'}; 
                    color: white; 
                    padding: 2px 8px; 
                    border-radius: 10px; 
                    margin-top: 5px;
                    opacity: 0.9;
                ">
                    ${w.tag}
                </div>`;
            }

            btn.innerHTML = `
                <div style="font-size:13px; font-weight:800; display:flex; align-items:center; gap:5px;">
                    <i class="fa-solid fa-bolt"></i> ${w.name}
                </div>
                ${tagHtml}
            `;
            
            btn.onclick = function() {
                document.querySelectorAll('.pin-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                if(typeof selectWalletFast === 'function') {
                    selectWalletFast(w.name, btn); 
                } else {
                    const select = document.getElementById('wallet');
                    if(select) { 
                        select.value = w.name; 
                        if(typeof updateLimitDisplay === 'function') updateLimitDisplay(); 
                    }
                }
            };

            container.appendChild(btn);
        });
    })
    .withFailureHandler(() => { isRenderingPins = false; }) // Ù„Ùˆ Ø­ØµÙ„ Ø®Ø·Ø£ Ù†ÙØªØ­ Ø§Ù„Ù‚ÙÙ„ Ø¨Ø±Ø¶Ù‡
    .getAllAccountsData();
}
		function selectWalletFast(name, btn) {
			const select = document.getElementById('wallet');
			select.value = name;
			
			// Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„Ù…Ø¶ØºÙˆØ· Ø¹Ù„ÙŠÙ‡
			document.querySelectorAll('.pin-btn').forEach(b => b.classList.remove('active'));
			btn.classList.add('active');
			
			// ØªØ´ØºÙŠÙ„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙŠÙ…ØªØ§Øª ÙÙˆØ±Ø§Ù‹
			updateLimitDisplay();
		}

		// ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© loadWallets Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ Pin Ø£ÙŠØ¶Ø§Ù‹
		const originalLoadWallets = loadWallets;
		loadWallets = function() {
			originalLoadWallets();
			renderPinnedWallets();
		};
			  let isDark = localStorage.getItem('theme') === 'dark';
window.onload = function() { 
    applyTheme(); 
    checkUserRole(); 
    loadWallets(); // Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
    renderWalletsCards(); // ğŸ‘ˆ Ø¶ÙŠÙ Ø¯ÙŠ Ø¹Ø´Ø§Ù† Ø§Ù„ÙƒØ±ÙˆØª ÙˆØ§Ù„ÙØ±Ø´Ø§Ø© ØªØ¸Ù‡Ø±
    loadClientsForDropdown(); 
    toggleClientField(); 
};			  
			  // ğŸ’¡ ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© toggleTheme Ùˆ applyTheme Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
			  function toggleTheme() { 
				  isDark = !isDark; 
				  localStorage.setItem('theme', isDark ? 'dark' : 'light'); 
				  applyTheme(); 
			  }
			  
			  function applyTheme() { 
				  document.body.setAttribute('data-theme', isDark ? 'dark' : 'light'); 
				  document.getElementById('themeIcon').className = isDark ? 'fa fa-sun' : 'fa fa-moon'; 
				  updateThemeToggleIcon(); // ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
			  }

			  function updateThemeToggleIcon() {
				  const icon = document.getElementById('darkModeToggleIcon');
				  if (icon) {
					  icon.className = isDark ? 'fa fa-toggle-on text-primary' : 'fa fa-toggle-off';
				  }
			  }
			  
			  function runDrawDashboard() {
				  setLoading('btnDrawDashboard', true); 
				  google.script.run.withSuccessHandler(res => {
					  setLoading('btnDrawDashboard', false);
					  showToast(res.msg, res.success);
				  }).withFailureHandler(e => {
					  setLoading('btnDrawDashboard', false);
					  showToast("âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯", false);
				  }).drawDashboardManual(); 
			  }

			  // ğŸ’¡ Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ ÙØ­Øµ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
			  function runCheckSheets() {
				  setLoading('btnCheckSheets', true); 
				  google.script.run.withSuccessHandler(res => {
					  setLoading('btnCheckSheets', false);
					  showToast(res.msg, res.success);
					  if (res.success) {
						  loadWallets(); 
						  loadClientsForDropdown();
					  }
				  }).withFailureHandler(e => {
					  setLoading('btnCheckSheets', false);
					  showToast("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù…", false);
				  }).initializeMissingSheets();
			  }
			  
			  // Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
		// ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ù„ØªØ³Ù…Ø­ Ø¨Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø³Ø§Ù„Ø¨
		function formatNumberInput(input) {
			// Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ¥Ø´Ø§Ø±Ø© Ø§Ù„Ø³Ø§Ù„Ø¨ ÙÙ‚Ø·
			let value = input.value.replace(/[^\d-]/g, ''); 
			
			// Ù…Ù†Ø¹ ÙˆØ¬ÙˆØ¯ Ø£ÙƒØ«Ø± Ù…Ù† Ø¥Ø´Ø§Ø±Ø© Ø³Ø§Ù„Ø¨ Ø£Ùˆ ÙˆØ¬ÙˆØ¯Ù‡Ø§ ÙÙŠ ØºÙŠØ± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
			if (value.indexOf('-') > 0) {
				value = value.replace(/-/g, '');
			}
			
			if (value === '' || value === '-') {
				input.value = value;
				return;
			}
			
			// ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±Ù‚Ù… Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ Ù…Ø¹ ÙÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø³Ø§Ù„Ø¨
			const isNegative = value.startsWith('-');
			const absValue = value.replace(/-/g, '');
			input.value = (isNegative ? '-' : '') + Number(absValue).toLocaleString('en-US');
		}
		// ğŸ’¡ ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© showView Ù„ÙØªØ­ Ø£ÙˆÙ„ ØªØ¨ÙˆÙŠØ¨ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
		// Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
	function showView(v) { 
		  // Ø¥Ø®ÙØ§Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
		  document.querySelectorAll('.view-section').forEach(d => d.style.display='none');
		  
		  const target = document.getElementById('view-' + v);
		  if (target) {
			  target.style.display = 'block'; 
		  }

		  // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ©
		  document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active')); 
		  
		  if(v === 'dash') {
			  document.querySelector('#nav-dash .nav-link')?.classList.add('active');
			  if(typeof loadDash === "function") loadDash(); 
		  } 
		  else if(v === 'op') {
			  document.querySelectorAll('.nav-link')[1]?.classList.add('active'); // Ø§Ù„Ø²Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ
			  const firstOpTab = document.querySelector('[data-op-tab="new-op-tab"]');
			  if (firstOpTab) showOpTab(firstOpTab);
		  } 
		  else if(v === 'manage') {
			  document.querySelector('#nav-manage .nav-link')?.classList.add('active');
			  const firstTab = document.querySelector('[data-tab="clients-tab"]');
			  if (firstTab) showManageTab(firstTab);
		  }
		  // ğŸ‘‡ğŸ‘‡ Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ğŸ‘‡ğŸ‘‡
		  else if(v === 'reports') {
			  // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹ (Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±)
			  document.querySelectorAll('.nav-link')[3]?.classList.add('active');
			  // ÙØªØ­ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£ÙˆÙ„ (Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠ) ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
			  switchReportTab('z-report');
		  }
		  // ğŸ‘†ğŸ‘† Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ğŸ‘†ğŸ‘†
		  else if(v === 'settings') { 
			  const settingsLink = document.querySelectorAll('.nav-link');
			  settingsLink[settingsLink.length - 1]?.classList.add('active');
		  }
		}    // Ø¯Ø§Ù„Ø© Ø§Ù„ÙØµÙ„ Ø¨ÙŠÙ† "Ø¹Ù…Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©" Ùˆ "Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª"
		function showManageTab(elem) {
			if(!elem) return;
			
			// Ø¥Ø®ÙØ§Ø¡ ÙƒØ§ÙØ© Ù…Ø­ØªÙˆÙŠØ§Øª ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
			document.querySelectorAll('.manage-tab-content').forEach(c => c.style.display = 'none');
			
			// Ø¥Ø²Ø§Ù„Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©
			document.querySelectorAll('.nav-pills a[data-tab]').forEach(a => a.classList.remove('active'));
			
			const tabId = elem.getAttribute('data-tab');
			const targetContent = document.getElementById(tabId);
			
			if(targetContent) {
				targetContent.style.display = 'block';
				elem.classList.add('active');
			}
			
			// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ù† Ù…Ù„ÙÙƒ Ø§Ù„Ù€ 1281 Ø³Ø·Ø±
			if(tabId === 'clients-tab' && typeof loadClientsTable === "function") loadClientsTable();
			if(tabId === 'accounts-tab' && typeof loadAccountsTable === "function") loadAccountsTable();
			if (tabId === 'users-tab') {
    			loadUsersTable();
									}	
		if(tabId === 'logs-tab' && typeof loadAdminLogs === "function") loadAdminLogs(); 
		}
function showOpTab(btn) {
    const targetId = btn.getAttribute('data-op-tab');
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ§Ø¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
    document.querySelectorAll('.op-tab-content').forEach(t => t.style.display = 'none');
    document.getElementById(targetId).style.display = 'block';

    // ØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„ Ø§Ù„Ø²Ø±Ø§ÙŠØ±
    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
    btn.classList.add('active');

    // Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
    if (targetId === 'log-op-tab') {
        loadTimelineData(); // Ù†Ø¯Ø§Ø¡ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·
    }
}
		// ğŸ’¡ Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (Ù…ØµØ­Ø­Ø© Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©)
async function getTransactionLogs(filters = {}) {
    try {
        let query = supabase.from('transactions').select('*');

        if (filters.type && !filters.type.includes("ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª")) {
            query = query.eq('type', filters.type);
        }
        if (filters.dateFrom) query = query.gte('date', filters.dateFrom);
        if (filters.dateTo) query = query.lte('date', filters.dateTo);

        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¨Ø­Ø« Ù†ØµÙŠØŒ Ø³Ù†Ø¬Ù„Ø¨ ÙƒÙ…ÙŠØ© Ø£ÙƒØ¨Ø± Ø«Ù… Ù†ÙÙ„ØªØ±Ù‡Ø§ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹
        const limitCount = (filters.text || filters.type || filters.dateFrom) ? 1000 : 50;

        const { data, error } = await query
            .order('id', { ascending: false })
            .limit(limitCount);

        if (error) throw error;
        return data;
    } catch (err) {
        console.error("Fetch Error:", err.message);
        return null;
    }
}

		function rollbackTransaction(rowId, type, amount, wallet, comm, client) {
			const msg = `âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø¹Ù…Ù„ÙŠØ© (${type})ØŸ\n\nØ§Ù„Ù…Ø¨Ù„Øº: ${amount}\nØ§Ù„Ù…Ø­ÙØ¸Ø©: ${wallet}\n\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ ÙˆØ¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø£Ø±ØµØ¯Ø© ÙˆØ§Ù„Ù„ÙŠÙ…ÙŠØªØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.`;
			
			if(confirm(msg)) {
				showToast("Ø¬Ø§Ø±ÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ±Ø§Ø¬Ø¹...", true);
				google.script.run.withSuccessHandler(res => {
					showToast(res.msg, res.success);
					if(res.success) {
						loadTransactionLogs(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„
						if(typeof loadDash === "function") loadDash(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
					}
				}).autoRollback(rowId, type, amount, wallet, comm, client);
			}
		}
		// ğŸ’¡ Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
		function loadAdminLogs() {
			const logsDiv = document.getElementById('adminLogsDiv');
			logsDiv.innerHTML = '<div class="text-center p-5 text-muted"><i class="fa fa-circle-notch fa-spin fa-2x mb-3"></i><br>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„...</div>';
			
			google.script.run.withSuccessHandler(data => {
				if (!data || data.length === 0) {
					logsDiv.innerHTML = '<div class="text-center p-5 text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¥Ø¯Ø§Ø±ÙŠØ©.</div>';
					return;
				}
				
				let h = '<table class="table table-bordered table-sm table-custom text-center small auto-card"><thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th><th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th><th>Ø¨ÙˆØ§Ø³Ø·Ø©</th></tr></thead><tbody>';
				
				data.forEach(log => {
					// Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ„ÙˆÙŠÙ†: Ø§Ù„Ù…Ø§Ù„Ùƒ Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± ÙˆØ§Ù„Ù…ÙˆØ¸Ù Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ù‚
					let badgeStyle = (log.user === "Ø§Ù„Ù…Ø§Ù„Ùƒ") 
						? "background-color: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid #ef4444;" 
						: "background-color: rgba(59, 130, 246, 0.1); color: #3b82f6; border: 1px solid #3b82f6;";
					
					h += `<tr>
							<td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª">${log.date}<br><small class="text-muted">${log.time}</small></td>
							<td data-label="Ø§Ù„Ø¹Ù…Ù„ÙŠØ©" class="fw-bold text-dark">${log.action}</td>
							<td data-label="Ø§Ù„ØªÙØ§ØµÙŠÙ„" class="text-end" style="font-size: 11px; max-width: 200px; white-space: normal;">${log.details}</td>
							<td data-label="Ø¨ÙˆØ§Ø³Ø·Ø©">
								<span class="badge px-3 py-2 rounded-pill" style="${badgeStyle} font-size: 12px; font-weight: 800;">
								  <i class="fa fa-user-shield me-1"></i> ${log.user}
								</span>
							</td>
						  </tr>`;
				});
				logsDiv.innerHTML = h + '</tbody></table>';

				if (document.body.classList.contains("mobile-view")) {
					applyMobileTableStyles(document.getElementById('adminLogsDiv').querySelector('table'));
				}
			}).getAdminLogs();
		}
			  function fetchClientBalance() {
				const clientName = document.getElementById('client').value.trim();
				const statusDiv = document.getElementById('clientBalanceStatus');
				statusDiv.innerHTML = '';
				if (!clientName) return;

				statusDiv.innerHTML = '<span style="color:#3b82f6;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>';
				google.script.run.withSuccessHandler(res => {
				  if (res && res.status) {
					let color = (res.bal > 0) ? 'green' : (res.bal < 0 ? 'red' : 'gray');
					statusDiv.innerHTML = `<span style="color:${color};">${res.status}</span>`;
				  } else {
					statusDiv.innerHTML = `<span style="color:gray;">Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø£Ùˆ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±ØµÙŠØ¯</span>`;
				  }
				}).getClientBalanceByName(clientName);
			  }

		// ğŸ’¡ ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© toggleClientField Ù„Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©
		function toggleClientField() {
			const type = document.getElementById('type').value;
			const container = document.getElementById('clientFieldContainer');
			const commDestContainer = document.getElementById('commDestinationContainer');
			const deductCommContainer = document.getElementById('deductCommContainer');

			const isAjel = type.includes("Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©") || type.includes("Ø¯ÙŠÙ†");
			
			// Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: ÙŠØ¸Ù‡Ø± Ø§Ù„Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø£Ùˆ Ø³Ø­Ø¨ Ø§Ù„ÙÙŠØ²Ø§
			const isInternalSupport = type.includes("Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ù…Ø­ÙØ¸Ø©") || type.includes("Ø³Ø­Ø¨ ÙÙŠØ²Ø§");

			container.style.display = isAjel ? 'block' : 'none';
			if (!isAjel) document.getElementById('client').value = '';

			const showCommDest = type.includes("Ø³Ø­Ø¨") || type.includes("Ø¥ÙŠØ¯Ø§Ø¹") || type.includes("ÙØ§ØªÙˆØ±Ø©");
			commDestContainer.style.display = (showCommDest && !isAjel) ? 'block' : 'none';

			// Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø±Ø§Ø± "Ø®ØµÙ… Ù…Ù† ÙƒØ§Ø´ Ø§Ù„Ø®Ø²Ù†Ø©"
			if (isInternalSupport) {
				deductCommContainer.style.display = 'block';
			} else {
				deductCommContainer.style.display = 'none';
				document.getElementById('deductCommFromAmount').checked = false;
			}
		}
		
// Ø¯Ø§Ø®Ù„ Ø¯Ø§Ù„Ø© loadDash() ÙÙŠ Page.html
async function loadDash() {
    // 1. Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø­Ø³Ø¨ Ù†Ø¸Ø§Ù…Ùƒ)
    // 2. Ø¬Ù„Ø¨ Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ù„Ø¯ÙˆØ±/Ø§Ù„Ø±ØªØ¨Ø©)
    let userRole = 'USER'; // Ø§ÙØªØ±Ø§Ø¶ÙŠ
    try {
        // Ø¥Ø°Ø§ ÙƒÙ†Øª Ù…Ø§Ø²Ù„Øª ØªØ³ØªØ®Ø¯Ù… Ø¬ÙˆØ¬Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŒ Ø§ØªØ±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
        const session = await new Promise((resolve) => {
            google.script.run.withSuccessHandler(resolve).getUserSessionData();
        });
        userRole = session.role;
    } catch (e) { console.log("Session error, using default role"); }

    const isUser = userRole === 'USER';

    // 3. Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù† Supabase (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† getDashboardStats)
    // Ø³Ù†Ø­ØªØ§Ø¬ Ù„Ø¹Ù…Ù„ Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª (Queries) Ù„Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù…ÙŠØ¹
    const { data: accounts, error } = await supabase.from('accounts').select('*');
    
    if (error || !accounts) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª:", error);
        return;
    }

    // --- Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ… (Ø¨Ø¯Ù„ Ù…Ø§ ÙƒØ§Ù†Øª Ø¨ØªØªØ­Ø³Ø¨ ÙÙŠ Code.js) ---
    const d = calculateStats(accounts); 
    window.globalWalletsData = d.wallets;

    // --- Ø±Ø³Ù… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù€ HTML Ø¨ØªØ§Ø¹Ùƒ Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ·) ---
    let html = `
    <div class="row g-2 mb-2">
      <div class="col-4"><div class="dash-card-flat card-orange"><i class="fa fa-building icon-bg"></i><div class="dash-val english-num">${d.compTotal.toLocaleString()}</div><div class="dash-lbl">Ø§Ù„Ø´Ø±ÙƒØ§Øª</div></div></div>
      <div class="col-4"><div class="dash-card-flat card-blue"><i class="fa fa-wallet icon-bg"></i><div class="dash-val english-num">${d.walletsTotal.toLocaleString()}</div><div class="dash-lbl">Ø§Ù„Ù…Ø­Ø§ÙØ¸</div></div></div>
      <div class="col-4"><div class="dash-card-flat card-green"><i class="fa fa-money-bill-wave icon-bg"></i><div class="dash-val english-num">${d.cash.toLocaleString()}</div><div class="dash-lbl">Ø§Ù„Ø®Ø²Ù†Ø©</div></div></div>
      <div class="col-6"><div class="dash-card-flat card-red"><i class="fa fa-hand-holding-usd icon-bg"></i><div class="dash-val english-num">${d.clientsOweMe.toLocaleString()}</div><div class="dash-lbl">Ù„ÙŠÙ†Ø§ (Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª)</div></div></div>
      <div class="col-6"><div class="dash-card-flat card-purple"><i class="fa fa-shopping-cart icon-bg"></i><div class="dash-val english-num">${d.clientsHave.toLocaleString()}</div><div class="dash-lbl">Ø¹Ù„ÙŠÙ†Ø§ (Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª)</div></div></div>
    </div>`;

    // (Ø£Ø¶Ù Ù‡Ù†Ø§ Ø¨Ù‚ÙŠØ© ÙƒÙˆØ¯ Ø§Ù„Ù€ HTML Ø§Ù„Ø®Ø§Øµ Ø¨Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙŠÙˆÙ„Ø© ÙˆØ§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø´Ø±ÙƒØ§Øª ÙƒÙ…Ø§ Ù‡Ùˆ ÙÙŠ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ)
    // ... Ù†ÙØ³ ÙƒÙˆØ¯ Ø§Ù„Ù€ HTML Ø§Ù„Ù„ÙŠ Ø£Ù†Øª Ø¨Ø¹ØªÙ‡ ...

    document.getElementById('dashContent').innerHTML = html; 
    renderWallets(d.wallets);
}
 function showToast(msg, isSuccess) { const t = document.getElementById('toastMsg'); t.innerText = msg; t.style.backgroundColor = isSuccess ? '#059669' : '#dc2626'; t.style.display = 'block'; setTimeout(() => { t.style.display = 'none'; }, 3000); }
			  function setLoading(btnId, isLoading) { const btn = document.getElementById(btnId); if(!btn) return; if(isLoading) { btn.disabled=true; btn.dataset.orgText=btn.innerHTML; btn.innerHTML='<i class="fa fa-circle-notch fa-spin"></i>'; } else { btn.disabled=false; btn.innerHTML=btn.dataset.orgText||'ØªÙ†ÙÙŠØ°'; } }
			  function loadWallets() { google.script.run.withSuccessHandler(arr => { let s=document.getElementById('wallet'); s.innerHTML='<option>...</option>'; if(arr.length) { s.innerHTML=''; s.add(new Option("---","")); arr.forEach(w=>s.add(new Option(w,w.split('(')[0].trim()))); } else s.innerHTML='<option>ÙØ§Ø±Øº</option>'; }).getWalletsList(); }
		function updateLimitDisplay() {
		  const w = document.getElementById('wallet').value;
		  const type = document.getElementById('type').value;
		  const box = document.getElementById('limitStatus');

		  if (!w || w.includes("---") || type.includes("Ù…ØµØ±ÙˆÙ")) {
			box.style.display = 'none';
			return;
		  }

		  box.style.display = 'block';
		  box.innerHTML = '<div class="text-center p-2"><i class="fa fa-circle-notch fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</div>';

		  google.script.run.withSuccessHandler(info => {
			if (!info.exists) { box.style.display = 'none'; return; }

			// ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø±ØµÙŠØ¯
			let balClass = "text-status-good";
			if (info.balance < 300) balClass = "text-status-danger";
			else if (info.balance < 1000) balClass = "text-status-warn";

			// ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ù…ØªØ§Ø­ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„Ù‡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙŠÙ…ÙŠØª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
			let incClass = info.availableInc < 1000 ? "text-status-danger" : "text-status-good";
			let outClass = info.availableOut < 1000 ? "text-status-danger" : "text-status-good";

			box.innerHTML = `
			  <div class="wallet-info-card shadow-sm">
				<div class="bal-container">
				  <span class="bal-label">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨Ø§Ù„Ù…Ø­ÙØ¸Ø©</span>
				  <span class="bal-value ${balClass}">${info.balance.toLocaleString()} <small style="font-size:12px">Ø¬.Ù…</small></span>
				</div>
				<div class="limit-info">
				  <div class="limit-item">
					<span class="limit-label"><i class="fa fa-arrow-down"></i> Ù…ØªØ§Ø­ Ø¯Ø®ÙˆÙ„</span>
					<span class="limit-val ${incClass}">${info.availableInc.toLocaleString()}</span>
				  </div>
				  <div class="limit-item" style="border-right: 1px solid var(--border-color)">
					<span class="limit-label"><i class="fa fa-arrow-up"></i> Ù…ØªØ§Ø­ Ø®Ø±ÙˆØ¬</span>
					<span class="limit-val ${outClass}">${info.availableOut.toLocaleString()}</span>
				  </div>
				</div>
				${info.isMonthRestricted ? '<div class="mt-2 text-danger fw-bold" style="font-size:10px">âš ï¸ Ø§Ù†ØªØ¨Ù‡: Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù…Ù‚ÙŠØ¯Ø© Ø¨Ø§Ù„Ø­Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>' : ''}
			  </div>
			`;
		  }).getWalletInfo(w); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
		}
		function loadClientsForDropdown() { 
			google.script.run.withSuccessHandler(l => { 
				let d = document.getElementById('client'); 
				d.innerHTML = '<option value="">Ø§Ø®ØªØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„...</option>'; 
				l.forEach(c => {
					let o = document.createElement('option'); 
					o.value = c; 
					o.text = c; 
					d.appendChild(o);
				}); 
			}).getClientsList(); 
		}

			  // ğŸ’¡ ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© runTransaction Ù„ØªÙ…Ø±ÙŠØ± ÙˆØ¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©
		// Ù…ØªØºÙŠØ± ÙˆØ³ÙŠØ· Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯
		var globalPendingData = null;

		function runTransaction() {
			try {
				const amountEl = document.getElementById('amount');
				const typeEl = document.getElementById('type');
				const walletEl = document.getElementById('wallet');
				const commEl = document.getElementById('comm');
				const commDestEl = document.getElementById('commDestination');
				
				if (!amountEl || !typeEl || !amountEl.value || !typeEl.value) {
					showToast("âš ï¸ Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©", false);
					return;
				}

				const amount = amountEl.value.replace(/,/g, '');
				const type = typeEl.value;
				const wallet = walletEl ? walletEl.value : "";
				const comm = commEl ? commEl.value.replace(/,/g, '') : "0";
				const commDest = commDestEl ? commDestEl.value : "CASH";
				let currentProvider = (typeof selectedProvider !== 'undefined' && selectedProvider) ? selectedProvider : "Ø§Ù„Ø´Ø±ÙƒØ©";

				let logicHtml = "";
				let isCash = (!wallet || wallet.includes("---") || wallet === "");
				let targetAcc = isCash ? "Ø§Ù„Ø®Ø²Ù†Ø© (ÙƒØ§Ø´)" : `Ù…Ø­ÙØ¸Ø© (${wallet})`;
				let themeColor = "#3b82f6"; 
				let iconHeader = "fa-file-invoice-dollar";

				// --- 1. Ø¬Ø²Ø¡ ØªÙØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ø§Ù„ÙØ§ØªÙˆØ±Ø©) ---
				const summaryCard = `
					<div style="background:rgba(255,255,255,0.05); border-radius:18px; padding:15px; margin-bottom:15px; border:1px solid rgba(255,255,255,0.1); direction:rtl;">
						<div style="display:flex; justify-content:space-between; margin-bottom:10px;">
							<span style="color:var(--text-muted); font-size:13px;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</span>
							<span style="color:var(--text-main); font-weight:800; font-size:16px;">${Number(amount).toLocaleString()} Ø¬.Ù…</span>
						</div>
						<div style="display:flex; justify-content:space-between; margin-bottom:10px;">
							<span style="color:var(--text-muted); font-size:13px;">ØµØ§ÙÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</span>
							<span style="color:#10b981; font-weight:800; font-size:16px;">+ ${Number(comm).toLocaleString()} Ø¬.Ù…</span>
						</div>
						<div style="display:flex; justify-content:space-between; padding-top:8px; border-top:1px dashed rgba(255,255,255,0.2);">
							<span style="color:var(--text-muted); font-size:13px;">Ø¥ÙŠØ¯Ø§Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙÙŠ:</span>
							<span style="color:#3b82f6; font-weight:bold; font-size:13px;">${commDest === 'CASH' ? 'ğŸ’° Ø§Ù„Ø®Ø²Ù†Ø©' : 'ğŸ“± Ø§Ù„Ù…Ø­ÙØ¸Ø©'}</span>
						</div>
					</div>`;

				// Ø¯Ø§Ù„Ø© Ø¨Ù†Ø§Ø¡ Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ø¨ØµØ±ÙŠ
				const createFlow = (fromIcon, fromText, toIcon, toText, arrowColor, detailText) => `
					<div style="background:rgba(255,255,255,0.02); padding:15px; border-radius:18px; border:1px solid rgba(255,255,255,0.05);">
						<div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:15px;">
							<div style="text-align:center; width:70px;">
								<div style="width:45px; height:45px; background:rgba(255,255,255,0.1); border-radius:12px; display:flex; align-items:center; justify-content:center; margin:0 auto 5px; color:var(--text-main);"><i class="fas ${fromIcon} fa-lg"></i></div>
								<span style="font-size:10px; color:var(--text-muted); font-weight:bold;">${fromText}</span>
							</div>
							<div style="flex-grow:1; text-align:center;"><i class="fas fa-long-arrow-alt-left fa-2x" style="color:${arrowColor}; opacity:0.8;"></i></div>
							<div style="text-align:center; width:70px;">
								<div style="width:45px; height:45px; background:${arrowColor}; border-radius:12px; display:flex; align-items:center; justify-content:center; margin:0 auto 5px; color:#fff;"><i class="fas ${toIcon} fa-lg"></i></div>
								<span style="font-size:10px; color:var(--text-muted); font-weight:bold;">${toText}</span>
							</div>
						</div>
						<p style="margin:0; font-size:13px; color:var(--text-main); text-align:right; direction:rtl; line-height:1.4;">${detailText}</p>
					</div>`;

				// --- 2. Ø¯Ù…Ø¬ Ø§Ù„Ø´Ø±Ø­ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø© ---

				if (type.includes("Ø³Ø­Ø¨ Ù…Ù† Ù…Ø­ÙØ¸Ø©")) {
					themeColor = "#10b981"; iconHeader = "fa-mobile-alt";
					logicHtml = createFlow("fa-cash-register", "Ø§Ù„Ø®Ø²Ù†Ø©", "fa-wallet", "Ø§Ù„Ù…Ø­ÙØ¸Ø©", themeColor, 
					`ğŸ“¥ <b>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø²Ø§Ø¯</b> (Ø´Ø­Ù†Øª Ù…Ø­ÙØ¸ØªÙƒ).<br>ğŸ“¤ <b>Ø§Ù„ÙƒØ§Ø´ ÙÙŠ Ø§Ù„Ø¯Ø±Ø¬ Ù‚Ù„</b> (Ø¯ÙØ¹Øª Ø«Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯).`);
				} 
				else if (type.includes("Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ù…Ø­ÙØ¸Ø©")) {
					themeColor = "#ef4444"; iconHeader = "fa-hand-holding-usd";
					logicHtml = createFlow("fa-wallet", "Ø§Ù„Ù…Ø­ÙØ¸Ø©", "fa-cash-register", "Ø§Ù„Ø®Ø²Ù†Ø©", themeColor, 
					`ğŸ“¥ <b>Ø§Ù„ÙƒØ§Ø´ ÙÙŠ Ø§Ù„Ø¯Ø±Ø¬ Ø²Ø§Ø¯</b> (Ø§Ø³ØªÙ„Ù…Øª Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„).<br>ğŸ“¤ <b>Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù‚Ù„</b> (Ø­ÙˆÙ„Øª Ù„Ù„Ø¹Ù…ÙŠÙ„).`);
				}
				else if (type.includes("Ø³Ø­Ø¨ Ù…Ù† Ø¹Ù…ÙŠÙ„")) {
					themeColor = "#ef4444"; iconHeader = "fa-user-minus";
					logicHtml = createFlow("fa-cash-register", "Ø§Ù„Ø®Ø²Ù†Ø©", "fa-building", currentProvider, themeColor, 
					`ğŸ“¥ <b>Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø© Ø²Ø§Ø¯</b> (Ø³Ø­Ø¨Øª Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„).<br>ğŸ“¤ <b>Ø§Ù„Ø®Ø²Ù†Ø© Ø§Ù„ÙƒØ§Ø´ Ù‚Ù„Ù‘Øª</b> (Ø³Ù„Ù…Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙƒØ§Ø´).`);
				}
				else if (type.includes("Ø³Ø­Ø¨ ÙƒØ§Ø´") || type.includes("ØªØ²ÙˆÙŠØ¯")) {
					themeColor = "#3b82f6"; iconHeader = "fa-sync-alt";
					logicHtml = createFlow("fa-wallet", "Ø§Ù„Ù…Ø­ÙØ¸Ø©", "fa-building", currentProvider, themeColor, 
					`ğŸ“¥ <b>Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø© Ø²Ø§Ø¯</b> Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø´ØºÙ„.<br>ğŸ“¤ <b>Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù‚Ù„Ù‘Øª</b> (ØªØ­ÙˆÙŠÙ„ Ø±Ù‚Ù…ÙŠ ÙÙ‚Ø·).<br>ğŸš« Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„ÙˆØ±Ù‚ÙŠ.`);
				}
				else if (type.includes("Ø³Ø­Ø¨ Ø¯ÙŠÙ†")) {
					themeColor = "#ef4444"; iconHeader = "fa-user-clock";
					logicHtml = `<div style="padding:15px; border-radius:15px; border:1px solid #ef4444; background:rgba(239, 68, 68, 0.05); text-align:right; direction:rtl; font-size:14px;">
						âš ï¸ <b>Ø³Ø­Ø¨ Ø¯ÙŠÙ†:</b> Ø±ØµÙŠØ¯ <b>${targetAcc} Ù‡ÙŠÙ‚Ù„</b>.<br>ğŸ“ˆ Ø¯ÙŠÙˆÙ† Ø§Ù„Ø¹Ù…ÙŠÙ„ <b>Ù‡ØªØ²ÙŠØ¯</b> (Ø´ÙƒÙƒ).
					</div>`;
				}
				else if (type.includes("Ø³Ø¯Ø§Ø¯ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©")) {
					themeColor = "#10b981"; iconHeader = "fa-user-check";
					logicHtml = `<div style="padding:15px; border-radius:15px; border:1px solid #10b981; background:rgba(16, 185, 129, 0.05); text-align:right; direction:rtl; font-size:14px;">
						âœ… <b>Ø³Ø¯Ø§Ø¯ Ø¯ÙŠÙ†:</b> Ø±ØµÙŠØ¯ <b>${targetAcc} Ù‡ÙŠØ²ÙŠØ¯</b>.<br>ğŸ“‰ Ø¯ÙŠÙˆÙ† Ø§Ù„Ø¹Ù…ÙŠÙ„ <b>Ù‡ØªÙ‚Ù„</b> (Ù„Ø£Ù†Ù‡ Ø³Ø¯Ø¯).
					</div>`;
				}
				else {
					logicHtml = `<p style="text-align:center; color:var(--text-main); font-size:14px; padding:10px;">ØªØ£ÙƒÙŠØ¯ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: <b>${type}</b></p>`;
				}

				globalPendingData = {
					wallet: wallet, type: type, provider: currentProvider, amount: amount,
					comm: comm, client: document.getElementById('client')?.value || "",
					note: document.getElementById('note')?.value || "",
					commDest: commDest
				};

				// Ø¯Ù…Ø¬ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù…Ø¹ Ø§Ù„Ø´Ø±Ø­ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ
				showCustomConfirmModal(summaryCard + logicHtml, themeColor, iconHeader);

			} catch (err) { console.error(err); }
		}
		function showCustomConfirmModal(content, themeColor) {
			const oldModal = document.getElementById('customConfirmModal');
			if (oldModal) oldModal.remove();

			const modalHtml = `
				<div id="customConfirmModal" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(15, 23, 42, 0.85); backdrop-filter: blur(4px); display:flex; justify-content:center; align-items:center; z-index:10000; padding:20px; font-family:'Cairo', sans-serif;">
					<div style="background:var(--bg-card); width:100%; max-width:380px; border-radius:24px; box-shadow:0 20px 50px rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); overflow:hidden;">
						<div style="background:${themeColor}; padding:15px; text-align:center; color:#fff;">
							<i class="fas fa-file-invoice-dollar fa-2x mb-2"></i>
							<h6 style="margin:0; font-weight:800; font-size:16px; letter-spacing:0.5px;">ØªØ£ÙƒÙŠØ¯ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h6>
						</div>
						
						<div style="padding:25px 20px;">
							${content}
						</div>
						
						<div style="padding:0 20px 25px 20px; display:flex; gap:12px;">
							<button onclick="finalExecuteStep(this)" style="flex:2; padding:14px; border:none; border-radius:15px; background:${themeColor}; color:#fff; font-weight:bold; font-size:15px; cursor:pointer; box-shadow: 0 4px 15px ${themeColor}66; transition:0.3s;">
								ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¢Ù†
							</button>
							<button onclick="document.getElementById('customConfirmModal').remove()" style="flex:1; padding:14px; border:1px solid var(--border-color); border-radius:15px; background:rgba(255,255,255,0.05); color:var(--text-muted); font-size:14px; cursor:pointer;">
								Ø¥Ù„ØºØ§Ø¡
							</button>
						</div>
					</div>
				</div>`;
			document.body.insertAdjacentHTML('beforeend', modalHtml);
		}
		function finalExecuteStep(btn) {
			if (!globalPendingData) return;
			
			// ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø± Ù„Ù…Ù†Ø¹ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…ØªÙƒØ±Ø±
			btn.disabled = true;
			btn.innerHTML = '<i class="fa fa-circle-notch fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';

			google.script.run.withSuccessHandler(res => {
				// Ø¥ØºÙ„Ø§Ù‚ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯ ÙÙˆØ± Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø±Ø¯
				const confirmModal = document.getElementById('customConfirmModal');
				if (confirmModal) confirmModal.remove();
				
				showToast(res.msg, res.success);
				
				if (res.success) {
					// --- Ø£- Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø¨ØµØ±ÙŠ Ù„Ù„ØµÙ†Ø¯ÙˆÙ‚ ---
					const opBox = document.querySelector('.card-box');
					if (opBox) {
						opBox.classList.add('field-reset-success');
						// Ø¥Ø²Ø§Ù„Ø© ÙØ¦Ø© Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ£Ø«ÙŠØ± (500ms)
						setTimeout(() => opBox.classList.remove('field-reset-success'), 500);
					}

					// --- Ø¨- ØªØµÙÙŠØ± Ø®Ø§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Ù†ØµÙˆØµ ÙˆØ£Ø±Ù‚Ø§Ù…) ---
					const fieldsToReset = ['amount', 'note'];
					fieldsToReset.forEach(id => {
						const el = document.getElementById(id);
						if (el) el.value = '';
					});

					const commField = document.getElementById('comm');
					if (commField) commField.value = '0';

					// --- Ø¬- Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙˆÙÙƒ Ø§Ù„Ù‚ÙÙ„ ---
					const walletSelect = document.getElementById('wallet');
					if (walletSelect) {
						walletSelect.disabled = false; 
						walletSelect.style.backgroundColor = ""; 
						walletSelect.style.cursor = "default";
						walletSelect.value = ""; 
					}

					// --- Ø¯- Ø¥Ø²Ø§Ù„Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† ÙƒØ±ÙˆØª Ø§Ù„Ø®Ø¯Ù…Ø§Øª ---
					document.querySelectorAll('.op-card').forEach(card => {
						card.classList.remove('active');
					});

					// --- Ù‡Ù€- ØªØµÙÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ù„ÙŠÙ…ÙŠØª ---
					const clientSelect = document.getElementById('client');
					if (clientSelect) clientSelect.value = '';
					
					const clientStatus = document.getElementById('clientBalanceStatus');
					if (clientStatus) clientStatus.innerHTML = '';

					const limitBox = document.getElementById('limitStatus');
					if (limitBox) limitBox.style.display = 'none';

					// --- Ùˆ- ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø³Ø¬Ù„Ø§Øª ÙÙˆØ±Ø§Ù‹ ---
					if (typeof loadWallets === "function") loadWallets();
					if (typeof loadDash === "function") loadDash();
					if (typeof loadTransactionLogs === "function") loadTransactionLogs();

				} else {
					// ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ù…Ø«Ù„Ø§Ù‹ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù„ÙŠÙ…ÙŠØª) Ù†Ø¹ÙŠØ¯ Ø§Ù„Ø²Ø± Ù„Ø­Ø§Ù„ØªÙ‡
					btn.disabled = false;
					btn.innerHTML = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¢Ù†";
				}
			}).withFailureHandler(err => {
				alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±: " + err);
				btn.disabled = false;
				btn.innerHTML = "ØªØ£ÙƒÙŠØ¯ ÙˆØ­ÙØ¸";
			}).processTransaction(globalPendingData);
		}
			  function loadClientsTable() { 
				  document.getElementById('clientsTableDiv').innerHTML='...'; 
				  google.script.run.withSuccessHandler(data=>{ 
					  let h='<table class="table table-bordered table-sm table-custom text-center small auto-card"><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>âš™ï¸</th></tr></thead><tbody>'; 
					  data.forEach(c=>{ 
						  let bal=Number(c.bal); 
						  let color=bal<0?'text-danger':(bal>0?'text-success':''); 
						  h+=`<tr>
								  <td data-label="Ø§Ù„Ø§Ø³Ù…">${c.name}</td>
								  <td data-label="Ø§Ù„Ø±ØµÙŠØ¯" class="${color} english-num" dir="ltr">${bal.toLocaleString()}</td>
								  <td data-label="âš™ï¸">
									  <button class="btn btn-xs btn-light border text-primary" onclick="openEditCl(${c.row}, '${c.name}', '${c.phone}', ${c.bal})">âœï¸</button> 
									  <button class="btn btn-xs btn-light border text-danger" onclick="delClient(${c.row})">ğŸ—‘ï¸</button>
								  </td>
							  </tr>`; 
					  }); 
					  document.getElementById('clientsTableDiv').innerHTML=h+'</tbody></table>';
					  
					  if (document.body.classList.contains("mobile-view")) {
						  applyMobileTableStyles(document.getElementById('clientsTableDiv').querySelector('table'));
					  }
					  
				  }).getClientsData(); 
			  }
			  function delClient(r) { if(confirm("Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ")) google.script.run.withSuccessHandler(res=>{showToast(res.msg,res.success); loadClientsTable(); loadClientsForDropdown();}).deleteClientData(r); }
			  function openEditCl(r,n,p,b) { document.getElementById('editClRow').value=r; document.getElementById('editClName').value=n; document.getElementById('editClPhone').value=p; document.getElementById('editClBal').value=b; document.getElementById('editClientModal').style.display='flex'; }
			  function closeEditCl() { document.getElementById('editClientModal').style.display='none'; }
			  function saveEditClient() { setLoading('btnSaveCl',true); google.script.run.withSuccessHandler(res=>{ setLoading('btnSaveCl',false); closeEditCl(); showToast(res.msg,res.success); loadClientsTable(); }).editClientData(Number(document.getElementById('editClRow').value), document.getElementById('editClName').value, document.getElementById('editClPhone').value, document.getElementById('editClBal').value); }
			  function addWallet() { const n=document.getElementById('newAccName').value; const t=document.getElementById('newAccType').value; if(!n)return; setLoading('btnAddWallet',true); google.script.run.withSuccessHandler(res=>{ setLoading('btnAddWallet',false); showToast(res.msg,res.success); if(res.success){ document.getElementById('newAccName').value=''; loadAccountsTable(); loadWallets(); } }).createNewWallet(n,t); }
			  
function loadAccountsTable() { 
    document.getElementById('accList').innerHTML = '<div class="text-center p-3"><i class="fa fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>'; 
    google.script.run.withSuccessHandler(data => { 
        let h = '<table class="table table-bordered table-sm table-custom mb-0 text-center auto-card"><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>âš™ï¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</th></tr></thead><tbody>'; 
// Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ¨Ø¯Ø£ Ø¨Ù€ h += `<tr> Ø¯Ø§Ø®Ù„ loadAccountsTable ÙˆØ­Ø¯Ø«Ù‡
data.forEach(a => { 
    let pinClass = a.isPinned ? 'text-warning' : 'text-muted';
    let pinIcon = a.isPinned ? 'fa-star' : 'fa-star-half-stroke';
    
    // ğŸ‘‡ ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø§Ø³Ù…
    let circleColor = a.color || "#dee2e6"; 

    h += `<tr>
        <td data-label="Ø§Ù„Ø§Ø³Ù…" class="small fw-bold text-start ps-3">
            <i class="fa-solid fa-circle me-2" style="color: ${circleColor}; font-size: 10px;"></i>
            ${a.name}
            ${a.tag ? '<br><span class="badge" style="background-color:'+circleColor+'; color:white; font-size:9px; margin-right:15px;">'+a.tag+'</span>' : ''}
        </td>
        <td data-label="Ø§Ù„Ø±ØµÙŠØ¯" class="small english-num">${Number(a.balance).toLocaleString()}</td>
        <td data-label="âš™ï¸">
            <div class="d-flex justify-content-center gap-1">
                <button class="btn btn-sm btn-light border ${pinClass}" onclick="togglePin(${a.row}, ${a.isPinned})"><i class="fa ${pinIcon}"></i></button>
                <button class="btn btn-sm btn-light border text-warning" onclick="openTagModal(${a.row}, '${a.tag || ""}', '${a.color || ""}')"><i class="fa-solid fa-paintbrush"></i></button>
                <button class="btn btn-sm btn-light border text-primary" onclick="openEdit(${a.row}, '${a.name}', ${a.lo}, ${a.li}, ${a.lm})"><i class="fa fa-edit"></i></button> 
                <button class="btn btn-sm btn-light border text-danger" onclick="delAcc(${a.row})"><i class="fa fa-trash"></i></button>
            </div>
        </td>
    </tr>`;
});
        document.getElementById('accList').innerHTML = h + '</tbody></table>'; 
    }).getAllAccountsData(); 
}
		// Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ«Ø¨ÙŠØª
function togglePin(row, currentState) {
    // 1. Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø¨Ø³ÙŠØ·Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...", true);

    google.script.run.withSuccessHandler(res => {
        if (res.success) {
            showToast(res.msg, true);
            
            // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­
            loadAccountsTable(); // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
            
            // 3. ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø³Ø±ÙŠØ¹ (Ø§Ù„Ù…Ø±Ø© Ø§Ù„ÙˆØ­ÙŠØ¯Ø© Ù„Ù„Ø±Ø³Ù…)
            renderPinnedWallets();
        } else {
            showToast(res.msg, false);
        }
    }).toggleWalletPin(row, currentState);
}
      function delAcc(r) { if(confirm("Ø­Ø°ÙØŸ")) google.script.run.withSuccessHandler(res=>{showToast(res.msg,res.success); loadAccountsTable();}).deleteAccount(r); }
			  function openEdit(r, n, lo, li, lm) { document.getElementById('editRow').value=r; document.getElementById('editName').value=n; document.getElementById('editLo').value=lo; document.getElementById('editLi').value=li; document.getElementById('editLm').value=lm; document.getElementById('editModal').style.display='flex'; }
			  function closeEdit() { document.getElementById('editModal').style.display='none'; }
    function saveEdit() {
        const row = Number(document.getElementById('editRow').value);
        const walletName = document.getElementById('editName').value;
        
        // Ø§Ù„Ø¢Ù† Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù„Ù† ÙŠØ³Ø¨Ø¨ Ø®Ø·Ø£ Ù„Ø£Ù†Ù†Ø§ Ø£Ø¶ÙÙ†Ø§ Ø§Ù„Ø¹Ù†ØµØ± ÙÙŠ Ø§Ù„Ù€ HTML
        const adjProfitRaw = document.getElementById('editProfitAdj').value.replace(/,/g, ''); 
        const adjProfit = Number(adjProfitRaw);

        setLoading('btnSaveEdit', true);

        // ØªÙ†ÙÙŠØ° Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        google.script.run.withSuccessHandler(res => {
            // ØªÙ†ÙÙŠØ° ØªØ³ÙˆÙŠØ© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø¥Ø°Ø§ ÙˆØ¬Ø¯ Ù…Ø¨Ù„Øº
            if (adjProfit !== 0 && !isNaN(adjProfit)) {
                google.script.run.withSuccessHandler(() => {
                    finishSave();
                }).adjustWalletProfit(walletName, adjProfit);
            } else {
                finishSave();
            }
        }).editAccountDetails(
            row,
            walletName,
            document.getElementById('editLo').value,
            document.getElementById('editLi').value,
            document.getElementById('editLm').value
        );
			function finishSave() {
				setLoading('btnSaveEdit', false);
				closeEdit();
				showToast("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­", true);
				loadAccountsTable();
				document.getElementById('editProfitAdj').value = ''; // ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚Ù„
			}
		}

			  function addUser() { 
				  const email = document.getElementById('uEmail').value.trim();
				  const name = document.getElementById('uName').value.trim();
				  const role = document.getElementById('uRole').value;

				  if (!email) {
					  showToast("âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„", false);
					  return;
				  }
				  if (!name) {
					  showToast("âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…", false);
					  return;
				  }
				  
				  setLoading('btnAddUser',true); 
				  google.script.run.withSuccessHandler(res=>{ 
					  setLoading('btnAddUser',false); 
					  showToast(res.msg,res.success); 
					  if(res.success){
						  document.getElementById('uEmail').value=''; 
						  document.getElementById('uName').value=''; 
						  loadUsersTable();
					  } 
				  }).addNewUser(email, name, role); 
			  }
			  
			  // ğŸ’¡ ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© loadUsersTable Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø³ØªØ± Ø¨Ù„ÙˆÙ† Ø£Ø­Ù…Ø±
			  
			  function openEditRole(email, name, currentRole) { 
				  if (email.toLowerCase() === "srmaster2@gmail.com".toLowerCase()) return;
				  
				  document.getElementById('editRoleEmail').value = email; 
				  document.getElementById('editRoleName').value = name;
				  document.getElementById('currentUserName').innerText = name;
				  
				  document.getElementById('newRoleSelect').value = currentRole;
				  
				  document.getElementById('editRoleModal').style.display = 'flex'; 
			  }
			  
			  function closeEditRole() { 
				  document.getElementById('editRoleModal').style.display = 'none'; 
			  }
			  
			  function saveUserRole() { 
				  const email = document.getElementById('editRoleEmail').value;
				  const newRole = document.getElementById('newRoleSelect').value;
				  setLoading('btnSaveRole', true);
				  
				  google.script.run.withSuccessHandler(res => { 
					  setLoading('btnSaveRole', false);
					  closeEditRole(); 
					  showToast(res.msg, res.success); 
					  loadUsersTable(); 
				  }).editUserRole(email, newRole); 
			  }

			  function delUser(e) { if(confirm("Ø­Ø°ÙØŸ")) google.script.run.withSuccessHandler(res=>{showToast(res.msg,res.success); loadUsersTable();}).removeUser(e); }
			  
			  function addClient() {
			const name = document.getElementById('newClName').value.trim();
			const phone = document.getElementById('newClPhone').value.trim();

			// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…
			if (!name) {
				showToast("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„", false);
				return;
			}

			setLoading('btnAddClient', true);

			// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© addNewClient Ù…Ù† Ù…Ù„Ù Code.js
			google.script.run.withSuccessHandler(res => {
				setLoading('btnAddClient', false);
				showToast(res.msg, res.success);
				if (res.success) {
					// ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
					document.getElementById('newClName').value = '';
					document.getElementById('newClPhone').value = '';
					loadClientsTable(); 
					loadClientsForDropdown(); 
				}
			}).withFailureHandler(err => {
				setLoading('btnAddClient', false);
				showToast("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±", false);
			}).addNewClient(name, phone);
		}

			</script>
			
			<script>
			  // Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
		// Ù…ØµÙÙˆÙØ© Ø¹Ø§Ù…Ø© Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
		let currentAlerts = [];

		function checkSystemAlerts() {
			google.script.run.withSuccessHandler(function(data) {
				currentAlerts = []; // ØªØµÙÙŠØ± Ø§Ù„Ù…ØµÙÙˆÙØ© Ù‚Ø¨Ù„ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯
				if (!data || !data.wallets) return;

				data.wallets.forEach(w => {
					// ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ù†Ø®ÙØ¶
					if (w.bal < 300) {
						currentAlerts.push(`Ø±ØµÙŠØ¯ Ù…Ø­ÙØ¸Ø© (${w.name}) Ù…Ù†Ø®ÙØ¶: ${w.bal} Ø¬.Ù…`);
					}
					// ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù‚ØªØ±Ø§Ø¨ Ù†ÙØ§Ø° Ø§Ù„Ù„ÙŠÙ…ÙŠØª Ø§Ù„ÙŠÙˆÙ…ÙŠ
					if (w.remDay < 500) {
						currentAlerts.push(`Ù„ÙŠÙ…ÙŠØª (${w.name}) Ø£ÙˆØ´Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡!`);
					}
				});

				// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
				const badge = document.getElementById('bell-badge');
				if (badge) {
					badge.style.display = currentAlerts.length > 0 ? 'block' : 'none';
				}
			}).getDashboardStats();
		}
		function showNotifications() {
			const modal = document.getElementById('notificationModal');
			const list = document.getElementById('notificationsList');
			
			if (!modal || !list) return;

			if (currentAlerts.length === 0) {
				list.innerHTML = `
					<div class="text-center py-4 text-muted">
						<i class="fa-solid fa-circle-check text-success fa-2x mb-2"></i>
						<p class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø¨Ø®ÙŠØ±.</p>
					</div>`;
			} else {
				list.innerHTML = currentAlerts.map(msg => `
					<div style="background:rgba(245, 158, 11, 0.1); color:var(--text-main); padding:10px; border-radius:10px; border-right:4px solid #f59e0b; margin-bottom:10px; font-size:12px; font-weight:bold;">
						<i class="fa-solid fa-circle-exclamation me-1 text-warning"></i> ${msg}
					</div>
				`).join('');
			}
			
			modal.style.display = 'flex';
			document.getElementById('bell-badge').style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡
		}

		function closeNotificationModal() {
			document.getElementById('notificationModal').style.display = 'none';
		  
		}  


		// Ù…ØµÙÙˆÙØ© Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
		// Ù…ØµÙÙˆÙØ© Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© (ÙŠÙ…ÙƒÙ† ØªØ®Ø²ÙŠÙ†Ù‡Ø§ ÙÙŠ Ø§Ù„Ù€ LocalStorage Ù„ØªØ¨Ù‚Ù‰ Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­)
		/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ */
		// Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
		// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
		// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ÙØ¦Ø§Øª
		// --- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØµÙØ­Ø© ---
		let denominations = JSON.parse(localStorage.getItem('sadek_cash_denoms')) || [200, 100, 50, 20, 10, 5, 1];
		let vaultBalanceFromSystem = 0;

		/**
		 * 1. Ø¬Ù„Ø¨ Ø±ØµÙŠØ¯ Ø§Ù„Ø®Ø²Ù†Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
		 */
		// Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø±ØµÙŠØ¯ Ø§Ù„Ø®Ø²Ù†Ø© Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
		/**
		 * Ø¬Ù„Ø¨ Ø±ØµÙŠØ¯ Ø§Ù„Ø®Ø²Ù†Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
		 */
		function fetchVaultBalance() {
			const displayEl = document.getElementById('system-vault-val');
			const refreshBtn = document.getElementById('refresh-vault-btn');
			
			if (displayEl) displayEl.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
			
			// Ø¥Ø¶Ø§ÙØ© Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ù„Ù„Ø²Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
			if (refreshBtn) refreshBtn.classList.add('fa-spin');

			google.script.run.withSuccessHandler(d => {
				// Ø¥Ø²Ø§Ù„Ø© Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
				if (refreshBtn) refreshBtn.classList.remove('fa-spin');

				if (d && d.success !== false) {
					// Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù‚ÙŠÙ…Ø© 'cash' Ù…Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ±
					vaultBalanceFromSystem = Number(d.cash) || 0; 
					vaultBalanceForCompare = vaultBalanceFromSystem; // Ù„Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© ÙÙŠ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø£Ø®Ø±Ù‰
					
					if (displayEl) displayEl.innerText = vaultBalanceFromSystem.toLocaleString();
					
					// Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ§Ø±Ù‚ ÙÙˆØ±Ø§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
					calculateTotalCash(); 
					showToast("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø±ØµÙŠØ¯ Ø§Ù„Ø³ÙŠØ³ØªÙ…", true);
				} else {
					if (displayEl) displayEl.innerText = "0 (Ø®Ø·Ø£)";
					showToast("âŒ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯", false);
				}
			}).getDashboardStats(); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
		}
		/**
		 * 2. Ø¨Ù†Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
		 */
		function renderCounter() {
			const container = document.getElementById('denominations-container');
			const deleteList = document.getElementById('delete-denoms-list');
			if (!container) return;
			
			container.innerHTML = '';
			deleteList.innerHTML = '';
			
			denominations.sort((a, b) => b - a).forEach(val => {
				// Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ø¯
				const col = document.createElement('div');
				col.className = 'col-6 col-md-4'; 
				col.innerHTML = `
					<div class="p-3 border rounded-4 bg-card shadow-sm h-100 transition-all text-center border-light">
						<div class="fw-bold text-main mb-2" style="font-size: 22px;"> ${val} <span class="small opacity-50" style="font-size: 13px;">Ø¬Ù†ÙŠØ©</span>
						</div>
						<input type="number" class="form-control form-control-lg text-center fw-bold english-num denom-input border-0 bg-light shadow-none" 
							  style="border-radius: 12px; font-size: 26px; height: 60px;" placeholder="0" data-unit="${val}" oninput="calculateTotalCash()">
						<div class="mt-2 border-top pt-2">
							<span class="small text-primary fw-bold row-total" style="font-family:'Roboto Mono'; font-size: 15px;">0 Ø¬.Ù…</span>
						</div>
					</div>`;
				container.appendChild(col);

				// Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ù†ÙØµÙ„Ø©
				const delBtn = document.createElement('button');
				delBtn.className = 'btn btn-xs btn-outline-danger rounded-pill px-2 admin-only';
				delBtn.style.display = 'none';
				delBtn.innerHTML = `<i class="fa fa-trash me-1"></i> Ø­Ø°Ù ${val}`;
				delBtn.onclick = () => removeDenomination(val);
				deleteList.appendChild(delBtn);
			});

			// Ø¥Ø¯Ø§Ø±Ø© Ø¸Ù‡ÙˆØ± Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
			google.script.run.withSuccessHandler(function(session) {
				if (session && session.role === 'ADMIN') {
					document.getElementById('manage-denoms').style.display = 'block';
					document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'inline-block');
				}
			}).getUserSessionData();
		}

		/**
		 * 3. Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
		 */
		/**
		 * Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© ÙˆØ§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ù…Ø¹ Ø§Ù„Ø³ÙŠØ³ØªÙ…
		 * ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¯ ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (Admin Logs)
		 */
		function calculateTotalCash() {
			let grandTotal = 0;
			let denomDetails = []; // Ù…ØµÙÙˆÙØ© Ù„ØªØ®Ø²ÙŠÙ† ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ØªÙŠ Ø¨Ù‡Ø§ Ù…Ø¨Ø§Ù„Øº ÙÙ‚Ø·
			
			document.querySelectorAll('.denom-input').forEach(input => {
				const unit = parseInt(input.getAttribute('data-unit'));
				const count = parseInt(input.value) || 0;
				const rowTotal = unit * count;
				grandTotal += rowTotal;
				
				// Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¹Ø¯Ø¯ ÙˆØ±Ù‚ØŒ Ù†Ø¶ÙŠÙÙ‡ Ù„Ù„ØªÙØ§ØµÙŠÙ„
				if (count > 0) {
					denomDetails.push(`${unit}Ø¬(${count}ÙˆØ±Ù‚Ø©)`);
				}
				
				const totalSpan = input.parentElement.querySelector('.row-total');
				if (totalSpan) totalSpan.innerText = rowTotal.toLocaleString() + ' Ø¬.Ù…';
			});

			document.getElementById('total-cash').innerText = grandTotal.toLocaleString();
			
			const badge = document.getElementById('reconciliation-badge');
			const label = document.getElementById('diff-label');
			const value = document.getElementById('diff-value');
			
			if (grandTotal === 0) {
				badge.style.display = 'none';
				return;
			}

			badge.style.display = 'block';
			const diff = grandTotal - vaultBalanceFromSystem; 

			// ØªØ­ÙˆÙŠÙ„ Ù…ØµÙÙˆÙØ© Ø§Ù„ÙØ¦Ø§Øª Ø¥Ù„Ù‰ Ù†Øµ ÙˆØ§Ø­Ø¯ Ù…ÙØµÙ„
			const detailsString = denomDetails.join(' - ');

			// ØªØµÙ…ÙŠÙ… Ø§Ù„Ø²Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ (Glassmorphism / Gradient)
			const saveBtnHtml = `
				<div class="mt-3 pt-3" style="border-top: 1px dashed rgba(255,255,255,0.4)">
					<button class="btn w-100 d-flex align-items-center justify-content-center gap-2" 
							style="background: rgba(255,255,255,0.2); 
								  backdrop-filter: blur(10px); 
								  border: 1px solid rgba(255,255,255,0.3); 
								  color: white; 
								  border-radius: 12px; 
								  padding: 8px; 
								  font-size: 12px; 
								  font-weight: 700; 
								  transition: all 0.3s ease;
								  box-shadow: 0 4px 15px rgba(0,0,0,0.1);"
							onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='translateY(-2px)';"
							onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)';"
							onclick="saveInventoryToLog(${vaultBalanceFromSystem}, ${grandTotal}, ${diff}, '${detailsString}')">
						<i class="fas fa-cloud-upload-alt" style="font-size: 16px;"></i> 
						Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¯ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
					</button>
				</div>`;

			if (Math.abs(diff) < 1) { 
				badge.style.background = 'linear-gradient(135deg, #059669 0%, #10b981 100%)';
				label.innerHTML = 'âœ¨ Ø¬Ø±Ø¯ Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø³ÙŠØ³ØªÙ…';
				value.innerHTML = '0' + saveBtnHtml;
			} else if (diff < 0) { 
				badge.style.background = 'linear-gradient(135deg, #dc2626 0%, #ef4444 100%)';
				label.innerHTML = 'âš ï¸ Ø¹Ø¬Ø² Ù…ÙƒØªØ´Ù:';
				value.innerHTML = Math.abs(diff).toLocaleString() + ' Ø¬.Ù…-' + saveBtnHtml;
			} else { 
				badge.style.background = 'linear-gradient(135deg, #2563eb 0%, #3b82f6 100%)';
				label.innerHTML = 'ğŸ’° Ø²ÙŠØ§Ø¯Ø© Ù…ÙƒØªØ´ÙØ©:';
				value.innerHTML = diff.toLocaleString() + ' Ø¬.Ù…+' + saveBtnHtml;
			}
		}

		/**
		 * Ø¯Ø§Ù„Ø© ÙØ±Ø¹ÙŠØ© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø³ÙŠØ±ÙØ± Ù„ÙŠØªÙ… ØªØ¯ÙˆÙŠÙ†Ù‡Ø§ ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
		 */
		function saveInventoryToLog(sys, act, diff, details) {
			const statusText = diff === 0 ? "Ù…Ø·Ø§Ø¨Ù‚ âœ…" : (diff < 0 ? "Ø¹Ø¬Ø² âŒ" : "Ø²ÙŠØ§Ø¯Ø© ğŸ’°");
			
			if(confirm(`ØªØ£ÙƒÙŠØ¯ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø¬Ø±Ø¯ØŸ\n------------------\nØ§Ù„Ù†ØªÙŠØ¬Ø©: ${statusText}\nØ§Ù„ÙØ¦Ø§Øª: ${details}`)) {
				google.script.run.withSuccessHandler(res => {
					showToast(res.msg, res.success);
				}).logCashInventory({
					systemBal: sys,
					actualBal: act,
					diff: diff,
					details: details // Ø¥Ø±Ø³Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª
				});
			}
		}
		/**
		 * 4. Ø±Ø¨Ø· Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ¦Ø§Øª
		 */
		const originalShowViewFinal = showView;
		showView = function(v) {
			if (typeof originalShowViewFinal === 'function') originalShowViewFinal(v);
			if (v === 'counter') {
				renderCounter();
				fetchVaultBalance(); 
			}
		};

		function resetCounter() {
			document.querySelectorAll('.denom-input').forEach(i => i.value = '');
			calculateTotalCash();
		}

		function addNewDenomination() {
			const val = parseInt(document.getElementById('new-denom-val').value);
			if (val && !denominations.includes(val)) {
				denominations.push(val);
				localStorage.setItem('sadek_cash_denoms', JSON.stringify(denominations));
				renderCounter();
				document.getElementById('new-denom-val').value = '';
			}
		}

		function removeDenomination(val) {
			if (confirm(`Ø­Ø°Ù ÙØ¦Ø© ${val} Ø¬Ù†ÙŠÙ‡ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŸ`)) {
				denominations = denominations.filter(d => d !== val);
				localStorage.setItem('sadek_cash_denoms', JSON.stringify(denominations));
				renderCounter();
			}
		}

// Ù…ØªØºÙŠØ± Ù„Ù…Ù†Ø¹ Ø§Ù„Ù†Ø¯Ø§Ø¡ Ø§Ù„Ù…ØªÙƒØ±Ø±
let isDataLoading = false;

async function loadTimelineData() {
    if (isDataLoading) return; // Ù„Ùˆ Ø¨ÙŠØ­Ù…Ù„ ÙØ¹Ù„Ø§Ù‹ Ù…ÙŠØ¹Ù…Ù„Ø´ Ù†Ø¯Ø§Ø¡ ØªØ§Ù†ÙŠ
    isDataLoading = true;

    const container = document.getElementById('timelineContainer');
    container.innerHTML = '<tr><td colspan="8">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>';

    try {
        const { data, error } = await supabase
            .from('transactions')
            .select('*')
            .order('id', { ascending: false })
            .limit(50); // Ø£Ù‡Ù… Ø³Ø·Ø± Ù„Ù„Ø³Ø±Ø¹Ø©

        if (data) {
            // Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
            container.innerHTML = data.map(tx => `
                <tr>
                    <td>${tx.id}</td>
                    <td>${tx.date}</td>
                    <td class="fw-bold">${tx.type}</td>
                    <td class="english-num">${Number(tx.amount).toLocaleString()}</td>
                    <td>${tx.wallet_name}</td>
                    <td>${tx.balance_after}</td>
                    <td>${tx.added_by}</td>
                    <td><i class="fa fa-eye" onclick="showDetails('${tx.id}')"></i></td>
                </tr>
            `).join('');
        }
    } finally {
        isDataLoading = false; // ÙØªØ­ Ø§Ù„Ù‚ÙÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
    }
}
	// ===============================
	// ğŸ” Apply Filters
	// ===============================
	function applyTimelineFilters() {

		// --- Basic Filters ---
		const fFrom   = document.getElementById('fDateFrom')?.value || "";
		const fTo     = document.getElementById('fDateTo')?.value || "";
		const fWallet = (document.getElementById('fWallet')?.value || "").toLowerCase();
		const fType   = document.getElementById('fType')?.value || "";
		const fMin    = document.getElementById('fMin')?.value || "";

		// --- ğŸ’° Profit Filters ---
		const fProfitMode = document.getElementById('fProfitMode')?.value || "";
		const fMinProfit  = document.getElementById('fMinProfit')?.value || "";

		const filtered = timelineGlobalData.filter(log => {

			// --- Date Filter ---
			const logDate = new Date(log.date);
			if (fFrom && logDate < new Date(fFrom)) return false;
			if (fTo && logDate > new Date(fTo)) return false;

			// --- Type ---
			if (fType && !log.type.includes(fType)) return false;

			// --- Amount ---
			if (fMin && log.amount < Number(fMin)) return false;

			// --- Global Search ---
			if (fWallet) {
				const fullText = `
					${log.wallet || ''}
					${log.client || ''}
					${log.note || ''}
					${log.user || ''}
				`.toLowerCase();

				if (!fullText.includes(fWallet)) return false;
			}

			// --- Profit ---
			const profit = Number(log.comm || 0);

			if (fProfitMode === 'with' && profit <= 0) return false;
			if (fProfitMode === 'without' && profit > 0) return false;
			if (fMinProfit && profit < Number(fMinProfit)) return false;

			return true;
		});

		renderTimeline(filtered);
	}
function renderTimeline(data) {
    window.timelineGlobalData = data || [];
    const container = document.getElementById('timelineContainer');
    const countDisplay = document.getElementById('rowsCountDisplay');

    if (!data || data.length === 0) {
        container.innerHTML = '<tr><td colspan="8" class="text-center p-5 text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø³Ø¬Ù„Ø©</td></tr>';
        if(countDisplay) countDisplay.innerText = '';
        return;
    }

    let html = '';
    
    data.forEach((log, index) => {
        // 1. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ù„ÙˆØ§Ù†
        let isOut = log.isOut;
        let typeColor = isOut ? 'text-danger' : 'text-success'; 
        let amountColor = isOut ? 'text-danger' : 'text-dark';
        
        // 2. ÙØ­Øµ ÙˆØ¬ÙˆØ¯ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„ [REF] ÙÙŠ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        let hasAudit = log.note && log.note.includes('[REF');
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø· (Ø¥Ø®ÙØ§Ø¡ ÙƒÙˆØ¯ REF Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ÙŠØ¨Ù‚Ù‰ Ø´ÙƒÙ„Ù‡Ø§ Ù†Ø¸ÙŠÙØ§Ù‹)
        let cleanNote = log.note ? log.note.replace(/\[REF.*?\]/, "").trim() : "-";

        // 3. ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø¨Ø­ (Badge)
        let profitVal = Number(log.comm || 0);
        let profitBadge = profitVal > 0 
            ? `<span class="badge bg-success bg-opacity-10 text-success rounded-pill english-num border border-success border-opacity-25">+${profitVal}</span>` 
            : `<span class="text-muted small">-</span>`;

        // 4. ØªÙ†Ø³ÙŠÙ‚ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù
        let userBadgeStyle = (log.user === "Ø§Ù„Ù…Ø§Ù„Ùƒ") 
            ? "background-color: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid #ef4444;" 
            : "background-color: rgba(59, 130, 246, 0.1); color: #3b82f6; border: 1px solid #3b82f6;";

        // 5. Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
        let accountIcon = log.client ? 'fa-user' : 'fa-wallet';
        let accountName = log.wallet || log.client || 'Ø¹Ø§Ù…';

        // 6. ØªØ¬Ù‡ÙŠØ² Ø²Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ (Ø§Ù„Ø¹ÙŠÙ†)
        // Ø¥Ø°Ø§ ÙˆØ¬Ø¯ ØªØ­Ù„ÙŠÙ„: Ø§Ù„Ø²Ø± ÙŠÙƒÙˆÙ† Ø£Ø²Ø±Ù‚ ØºØ§Ù…Ù‚ ÙˆÙŠØ³ØªØ¯Ø¹ÙŠ showAuditDetails
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯: Ø§Ù„Ø²Ø± ÙŠÙƒÙˆÙ† Ø¨Ø§Ù‡Øª ÙˆÙŠØ³ØªØ¯Ø¹ÙŠ viewDetails Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ©
        let viewBtn = hasAudit 
            ? `<button class="btn btn-sm btn-primary shadow-sm" onclick="showAuditDetails('${log.note.replace(/'/g, "\\'")}')" title="Ø¹Ø±Ø¶ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±ØµØ¯Ø©">
                 <i class="fa fa-eye"></i>
               </button>`
            : `<button class="btn btn-sm btn-light border text-primary" onclick="viewDetails(${index})" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ø§Ù…Ø©">
                 <i class="fa fa-eye"></i>
               </button>`;

        html += `
        <tr class="search-item">
            <td class="text-muted align-middle">${index + 1}</td>
            
            <td data-label="Ø§Ù„ØªØ§Ø±ÙŠØ®" class="align-middle">
                <div class="fw-bold text-dark english-num">${log.date}</div>
                <div class="small text-muted english-num">${log.time}</div>
            </td>
            
            <td data-label="Ø§Ù„Ø¹Ù…Ù„ÙŠØ© / Ø§Ù„Ø­Ø³Ø§Ø¨" class="align-middle text-start ps-3">
                <div class="fw-bold ${typeColor}" style="font-size:13px; margin-bottom:2px;">
                    ${log.type}
                </div>
                <div class="d-flex align-items-center text-muted small">
                    <i class="fa ${accountIcon} me-1 opacity-50"></i>
                    <span class="fw-bold text-dark">${accountName}</span>
                </div>
            </td>
            
            <td data-label="Ø§Ù„Ù…Ø¨Ù„Øº" class="align-middle">
                <div class="fw-bold english-num ${amountColor}" style="font-size:14px;">${Number(log.amount).toLocaleString()}</div>
                <div class="small mt-1">${profitBadge}</div>
            </td>

            <td data-label="Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¹Ø¯" class="align-middle">
                <span class="badge bg-light text-dark border english-num" style="font-size: 11px; font-weight:700;">
                    ${Number(log.balanceAfter || 0).toLocaleString()}
                </span>
            </td>

            <td data-label="Ù…Ù„Ø§Ø­Ø¸Ø§Øª" class="align-middle">
                <div class="text-muted small text-wrap text-truncate" style="max-width: 150px; line-height:1.2;" title="${cleanNote}">
                    ${cleanNote}
                </div>
            </td>

            <td data-label="Ø¨ÙˆØ§Ø³Ø·Ø©" class="align-middle">
                <span class="badge px-2 py-1 rounded-pill" style="${userBadgeStyle} font-size: 10px;">
                    ${log.user ? log.user.split(' ')[0] : '-'}
                </span>
            </td>

            <td data-label="Ø¥Ø¬Ø±Ø§Ø¡" class="align-middle">
                <div class="d-flex justify-content-center gap-2">
                    ${viewBtn}
                    
                    <button class="btn btn-sm btn-light border text-danger" onclick="deleteOp(${index})" title="Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©">
                        <i class="fa fa-trash"></i>
                    </button>
                </div>
            </td>
        </tr>`;
    });

    container.innerHTML = html;
    if(countDisplay) countDisplay.innerText = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª: ${data.length}`;
}
	// --- Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ø²Ø± Ø§Ù„Ø­Ø°Ù ---
	function deleteOp(index) {
		const data = window.timelineGlobalData[index];
		
		// Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯
		if(!confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¹Ù…Ù„ÙŠØ© (${data.type}) Ø¨Ù…Ø¨Ù„Øº ${data.amount}ØŸ\n\nÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.`)) {
			return;
		}

		// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙˆØ³Øª Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø±
		showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...", true);

		// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù ÙÙŠ Google Script (Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Code.js Ø¨Ø§Ø³Ù… rollbackTransaction Ø£Ùˆ deleteTransaction)
		// Ù‡Ù†Ø§ Ø¨Ù†Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø¯Ø§Ù„Ø© Ø§Ù„Ù€ rollback Ø§Ù„Ù„ÙŠ ÙƒØ§Ù†Øª ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„Ø£Ù†Ù‡Ø§ Ø¨ØªØ¹Ù…Ù„ Ø­Ø°Ù ÙˆØªØ¹Ø¯ÙŠÙ„ Ø±ØµÙŠØ¯
		google.script.run.withSuccessHandler(res => {
			showToast(res.msg, res.success);
			if (res.success) {
				loadTimelineData(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„
				if(typeof loadDash === "function") loadDash(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
			}
		}).withFailureHandler(err => {
			showToast("Ø®Ø·Ø£: " + err.message, false);
		// Ù„Ø§Ø­Ø¸: Ù‡Ù†Ø§ Ø¨Ù†Ø¨Ø¹Øª rowId Ø§Ù„Ù„ÙŠ Ø¬Ø§ÙŠ Ù…Ù† Ø§Ù„Ø¯Ø§ØªØ§ Ø¨ÙŠØ² Ø¹Ø´Ø§Ù† ÙŠØ­Ø°Ù Ø§Ù„ØµÙ Ø§Ù„ØµØ­
		}).autoRollback(data.rowId, data.type, data.amount, data.wallet, data.comm, data.client);
	}

	// 2. Ø¯Ø§Ù„Ø© Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø³Ø±ÙŠØ¹ (Search)
	function filterTableModern() {
		const input = document.getElementById("tableSearchInput");
		const filter = input.value.toLowerCase();
		const nodes = document.getElementsByClassName("search-item");

		for (let i = 0; i < nodes.length; i++) {
			// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ÙƒÙ„ Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ
			if (nodes[i].innerText.toLowerCase().includes(filter)) {
				nodes[i].style.display = "";
			} else {
				nodes[i].style.display = "none";
			}
		}
	}

	// 3. Ù…Ù†Ø·Ù‚ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ (View Details)
	let currentModalIndex = -1; // Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ù…Ù† Ø§Ù„Ù…ÙˆØ¯Ø§Ù„

	function viewDetails(index) {
		const data = window.timelineGlobalData[index];
		currentModalIndex = index;

		// ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
		document.getElementById('modalAmount').innerText = Number(data.amount).toLocaleString() + ' Ø¬.Ù…';
		document.getElementById('modalType').innerText = data.type;
		document.getElementById('modalWallet').innerText = data.wallet || data.client || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
		document.getElementById('modalProfit').innerText = Number(data.comm).toLocaleString();
		document.getElementById('modalUser').innerText = data.user;
		document.getElementById('modalTime').innerText = `${data.date} - ${data.time}`;
		document.getElementById('modalId').innerText = `Ref: ${Date.now().toString().slice(-6)}`; // Ø±Ù‚Ù… Ù…Ø±Ø¬Ø¹ÙŠ ÙˆÙ‡Ù…ÙŠ Ù„Ù„Ø´ÙƒÙ„

		// ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
		let isOut = data.isOut;
		let iconHTML = isOut 
			? '<i class="fa fa-arrow-up text-danger"></i>' 
			: '<i class="fa fa-arrow-down text-success"></i>';
		document.getElementById('modalIcon').innerHTML = iconHTML;

		// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
		document.getElementById('txDetailsModal').style.display = 'flex';
	}

	function closeDetailsModal() {
		document.getElementById('txDetailsModal').style.display = 'none';
	}

	function printCurrentModal() {
		if(currentModalIndex >= 0) printReceipt(currentModalIndex);
	}

	// 4. Ù…Ù†Ø·Ù‚ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø­Ø±Ø§Ø±ÙŠ (Professional Receipt)
	function printReceipt(index) {
		const data = window.timelineGlobalData[index];
		
		// ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¥ÙŠØµØ§Ù„
		const receiptHTML = `
			<html>
			<head>
				<title>Ø¥ÙŠØµØ§Ù„ Ø¹Ù…Ù„ÙŠØ©</title>
				<style>
					body { font-family: 'Courier New', monospace; text-align: center; width: 300px; margin: 0 auto; direction: rtl; }
					.header { border-bottom: 2px dashed #000; padding-bottom: 10px; margin-bottom: 10px; }
					.logo { font-size: 20px; font-weight: bold; }
					.info-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 12px; }
					.total { border-top: 2px dashed #000; border-bottom: 2px dashed #000; padding: 10px 0; margin: 10px 0; font-size: 18px; font-weight: bold; }
					.footer { font-size: 10px; margin-top: 20px; }
					@media print { .no-print { display: none; } }
				</style>
			</head>
			<body>
				<div class="header">
					<div class="logo">SADEK CASH</div>
					<div style="font-size:10px;">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</div>
					<div style="font-size:10px;">${new Date().toLocaleString()}</div>
				</div>
				
				<div class="content">
					<div class="info-row"><span>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</span> <strong>${data.type}</strong></div>
					<div class="info-row"><span>Ø§Ù„Ø­Ø³Ø§Ø¨:</span> <span>${data.wallet || data.client || '-'}</span></div>
					<div class="info-row"><span>Ø¨ÙˆØ§Ø³Ø·Ø©:</span> <span>${data.user}</span></div>
					
					<div class="total">
						${Number(data.amount).toLocaleString()} Ø¬.Ù…
					</div>
					
					<div class="info-row"><span>Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¹Ø¯:</span> <span>${data.balanceAfter || '-'}</span></div>
					<div class="info-row"><span>Ø±Ù‚Ù… Ù…Ø±Ø¬Ø¹ÙŠ:</span> <span>${Date.now().toString().slice(-8)}</span></div>
				</div>
				
				<div class="footer">
					<p>Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§</p>
					<p>*** Ù†Ø³Ø®Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„ ***</p>
				</div>
				
				<script>
					window.onload = function() { window.print(); setTimeout(function(){ window.close(); }, 500); }
				<\/script>
			</body>
			</html>
		`;

		// ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
		const printWindow = window.open('', '_blank', 'width=350,height=500');
		printWindow.document.write(receiptHTML);
		printWindow.document.close();
	}
	// Ø¯Ø§Ù„Ø© Ù„ÙØªØ­ ÙˆÙ‚ÙÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµØºÙŠØ±Ø© (3 Ù†Ù‚Ø·)
	// ===============================
	// ğŸ“Š Update Stats
	// ===============================
	function updateStats(c, a, p) {
		document.getElementById('sCount').innerText = c;
		document.getElementById('sAmt').innerText   = Number(a).toLocaleString();
		document.getElementById('sProf').innerText  = Number(p).toLocaleString();
	}

	// ===============================
	// â™»ï¸ Reset Filters
	// ===============================
	function resetTimelineFilters() {
		[
			'fDateFrom',
			'fDateTo',
			'fWallet',
			'fType',
			'fMin',
			'fProfitMode',
			'fMinProfit'
		].forEach(id => {
			const el = document.getElementById(id);
			if (el) el.value = '';
		});

		applyTimelineFilters();
	}
	// Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø¢Ø®Ø± Ù‚Ø§Ø¦Ù…Ø© Ù…ÙØªÙˆØ­Ø©
	// Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø¢Ø®Ø± Ù‚Ø§Ø¦Ù…Ø© Ù…ÙØªÙˆØ­Ø©
	let currentOpenDropdownId = null;

	function toggleActionMenu(element, index) {
		const dropdownId = `dropdown-${index}`;
		const dropdown = document.getElementById(dropdownId);
		const currentRow = element.closest('tr'); // Ù‡Ø§Øª Ø§Ù„ØµÙ Ø§Ù„Ø­Ø§Ù„ÙŠ

		// 1. Ù„Ùˆ ÙÙŠÙ‡ Ù‚Ø§Ø¦Ù…Ø© ØªØ§Ù†ÙŠØ© Ù…ÙØªÙˆØ­Ø©ØŒ Ø§Ù‚ÙÙ„Ù‡Ø§ ÙˆØ±Ø¬Ø¹ Ø§Ù„Ù€ z-index Ù„Ù„ØµÙ Ø¨ØªØ§Ø¹Ù‡Ø§
		if (currentOpenDropdownId && currentOpenDropdownId !== dropdownId) {
			const prevDropdown = document.getElementById(currentOpenDropdownId);
			if (prevDropdown) {
				prevDropdown.classList.remove('show');
				// Ø±Ø¬Ø¹ Ø§Ù„ØµÙ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„Ø·Ø¨ÙŠØ¹ØªÙ‡
				const prevRow = prevDropdown.closest('tr');
				if(prevRow) prevRow.style.zIndex = '';
			}
		}

		// 2. Ø§Ø¹ÙƒØ³ Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
		if (dropdown.classList.contains('show')) {
			dropdown.classList.remove('show');
			currentRow.style.zIndex = ''; // Ø±Ø¬Ø¹ Ø§Ù„ØµÙ Ù„Ø·Ø¨ÙŠØ¹ØªÙ‡
			currentOpenDropdownId = null;
		} else {
			dropdown.classList.add('show');
			currentRow.style.zIndex = '100'; // Ø®Ù„ÙŠ Ø§Ù„ØµÙ Ø¯Ù‡ ÙÙˆÙ‚ ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ØªØ§Ù†ÙŠØ©
			currentOpenDropdownId = dropdownId;
		}

		// 3. Ø§Ù‚ÙÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· ÙÙŠ Ø§Ù„Ø®Ø§Ø±Ø¬
		document.addEventListener('click', function closeMenu(e) {
			if (!element.contains(e.target)) {
				dropdown.classList.remove('show');
				currentRow.style.zIndex = ''; // Ø±Ø¬Ø¹ Ø§Ù„ØµÙ Ù„Ø·Ø¨ÙŠØ¹ØªÙ‡
				currentOpenDropdownId = null;
				document.removeEventListener('click', closeMenu);
			}
		}, { once: false });
	}// 1. Ø¯Ø§Ù„Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± (Ø§Ù„Ø¨Ø­Ø« + Ø§Ù„ØªØ±ØªÙŠØ¨)
	function applyWalletFilters() {
		const searchText = document.getElementById('dashWalletSearch').value.toLowerCase();
		const sortMode = document.getElementById('sortWalletsSelect').value;
		
		// Ø£Ø®Ø° Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©
		let filteredData = [...window.globalWalletsData];

		// Ø£ÙˆÙ„Ø§Ù‹: ØªØµÙÙŠØ© Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…/Ø§Ù„Ø±Ù‚Ù…
		if (searchText) {
			filteredData = filteredData.filter(w => w.name.toLowerCase().includes(searchText));
		}

		// Ø«Ø§Ù†ÙŠØ§Ù‹: ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
		switch (sortMode) {
			case 'max_bal': // Ø§Ù„Ø£ÙƒØ«Ø± Ø±ØµÙŠØ¯Ø§Ù‹
				filteredData.sort((a, b) => b.bal - a.bal);
				break;
			case 'max_day': // Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ÙŠÙˆÙ…ÙŠ
				filteredData.sort((a, b) => b.usedDay - a.usedDay);
				break;
			case 'min_day': // Ø§Ù„Ø£Ù‚Ù„ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ÙŠÙˆÙ…ÙŠ
				filteredData.sort((a, b) => a.usedDay - b.usedDay);
				break;
			case 'max_mon': // Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø´Ù‡Ø±ÙŠ
				filteredData.sort((a, b) => b.usedMon - a.usedMon);
				break;
			case 'min_mon': // Ø§Ù„Ø£Ù‚Ù„ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø´Ù‡Ø±ÙŠ
				filteredData.sort((a, b) => a.usedMon - b.usedMon);
				break;
			default: // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (ÙƒÙ…Ø§ Ø¬Ø§Ø¡Øª Ù…Ù† Ø§Ù„Ø´ÙŠØª)
				break;
		}

		// Ø«Ø§Ù„Ø«Ø§Ù‹: Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„ÙƒØ±ÙˆØª
		renderWallets(filteredData);
	}

	// 2. Ø¯Ø§Ù„Ø© Ø±Ø³Ù… Ø§Ù„ÙƒØ±ÙˆØª (Rendering Function)
	function renderWallets(walletsList) {
		// ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙˆÙ†ØªÙŠÙ†Ø± Ø§Ù„Ø°ÙŠ Ø³ÙŠØ­ØªÙˆÙŠ Ø§Ù„ÙƒØ±ÙˆØª
		// (Ø§Ø³ØªØ®Ø¯Ù… walletsLiveGrid Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø¹Ù„ÙˆÙŠØ©ØŒ Ø£Ùˆ dashContent Ù„Ùˆ Ø¹Ø§ÙŠØ² ØªÙ…Ø³Ø­ ÙƒÙ„ Ø­Ø§Ø¬Ø©)
		const container = document.getElementById('walletsLiveGrid'); 
		
		if (!walletsList || walletsList.length === 0) {
			if(container) container.innerHTML = '<div class="text-center text-muted p-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙØ¸</div>';
			return;
		}

		// Ø¨Ø¯Ø§ÙŠØ© HTML (Ø§Ù„Ù‡ÙŠØ¯Ø± + ÙØªØ­Ø© Ø§Ù„Ù€ row)
		let html = `<h6 class="text-muted small fw-bold mb-2"><i class="fa fa-mobile-alt"></i> Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ (Live)</h6><div class="row g-2">`; 

		walletsList.forEach(w => { 
			// 1. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨ Ø§Ù„Ù…Ø¦ÙˆÙŠØ©
			let dayPct = w.limDay > 0 ? (w.usedDay / w.limDay) * 100 : 0; 
			let monPct = w.limMon > 0 ? (w.usedMon / w.limMon) * 100 : 0; 
			
			// 2. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† (Ø£Ø­Ù…Ø± Ù„Ùˆ Ø¹Ø¯Ù‰ 90%)
			let dayColor = dayPct > 90 ? '#ef4444' : '#10b981'; 

			// 3. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (Ø§Ù„Ù„Ù…ÙŠØª - Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ)
			let remDay = w.limDay - w.usedDay;
			let remMon = w.limMon - w.usedMon;

			// Ù…Ù†Ø¹ Ø§Ù„Ø³ÙˆØ§Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
			if (remDay < 0) remDay = 0;
			if (remMon < 0) remMon = 0;

			// 4. Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙƒØ§Ø±Øª (Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±Ø³Ù„ Ù…Ù†Ùƒ Ø¨Ø§Ù„Ø¶Ø¨Ø· Ù…Ø¹ ØªØ¹ÙˆÙŠØ¶ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ)
			html += `
			<div class="col-4">
				<div class="wallet-card-live">
					<div class="w-header">
						<div class="w-bal english-num">${w.bal.toLocaleString()}</div>
						<div class="w-num english-num"><i class="fa fa-sim-card text-muted me-1"></i>${w.name}</div>
					</div>
					
					<div class="d-flex justify-content-between text-muted monitor-lbl">
						<span>Ù…ØªØ¨Ù‚ÙŠ: <span class="english-num fw-bold">${remDay.toLocaleString()}</span></span>
						<span>${Math.round(dayPct)}%</span>
					</div>
					<div class="progress-slim">
						<div class="pg-bar" style="width:${dayPct}%; background:${dayColor}; height:100%"></div>
					</div>
					
					<div class="d-flex justify-content-between text-muted mt-2 monitor-lbl">
						<span>Ø´Ù‡Ø±ÙŠ: <span class="english-num fw-bold">${remMon.toLocaleString()}</span></span>
						<span>${Math.round(monPct)}%</span>
					</div>
					<div class="progress-slim">
						<div class="pg-bar bg-info" style="width:${monPct}%; height:100%"></div>
					</div>
				</div>
			</div>`; 
		}); 

		html += `</div>`; // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ row

		// Ø§Ù„Ø­Ù‚Ù† ÙÙŠ Ø§Ù„ØµÙØ­Ø©
		if(container) container.innerHTML = html;
	}// --- Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ---

	// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
	// ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø´Ø§Ø±ØªÙŠÙ†
	let myDaysChart = null;
	let myPeakChart = null;
	let busyDaysData = null; 

	// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª (Ù…Ø­Ø¯Ø«Ø©)
function switchReportTab(tabId) {
    // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    document.querySelectorAll('.report-content').forEach(d => d.style.display = 'none');
    document.querySelectorAll('#view-reports .nav-link').forEach(l => l.classList.remove('active'));
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
    const target = document.getElementById('rep-' + tabId);
    if(target) target.style.display = 'block';
    
    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
    const buttons = document.querySelectorAll('#view-reports .nav-link');
    
    if(tabId === 'z-report') {
        buttons[0].classList.add('active');
        if(document.getElementById('zDateFrom') && !document.getElementById('zDateFrom').value) {
            document.getElementById('zDateFrom').valueAsDate = new Date();
        }
    } 
    else if (tabId === 'wallet-intel') {
        buttons[1].classList.add('active');
        loadWalletIntel();
    }
    else if (tabId === 'peak-hours') { 
        buttons[2].classList.add('active'); 
        // âš¡ ØªØ£Ø®ÙŠØ± 200 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© ÙÙ‚Ø· Ù„Ø¶Ù…Ø§Ù† Ø£Ù† Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ Ø¸Ø§Ù‡Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø±Ø³Ù…
        setTimeout(function() {
            loadBusyDaysChart();
            loadPeakHoursChart();
            loadTopDates();
        }, 200);
    }
    else if (tabId === 'pnl-chart') {
        buttons[3].classList.add('active');
        setTimeout(loadPnLCharts, 200);
    }
}
function loadBusyDaysChart() {
    const canvas = document.getElementById('busyDaysChart');
    if (!canvas) return; // Ø­Ù…Ø§ÙŠØ©: Ù„Ùˆ Ø§Ù„Ø¹Ù†ØµØ± Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø®Ø±Ø¬

    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø³ÙŠØ±ÙØ±
    google.script.run.withSuccessHandler(function(data) {
        // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù…
        busyDaysData = data;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª
        let totalCount = 0;
        if(data.counts) totalCount = data.counts.reduce((a, b) => a + b, 0);

        if (totalCount === 0) {
             console.log("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„");
             // Ù…Ù…ÙƒÙ† ØªØ¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø© Ù‡Ù†Ø§ Ù„Ùˆ Ø­Ø§Ø¨Ø¨
             return;
        }

        updateDayChart('count'); // Ø±Ø³Ù… Ø§Ù„Ø´Ø§Ø±Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø§Ù„Ø¹Ø¯Ø¯)
    }).getBusyDaysData();
}
function updateDayChart(metric) {
    // Ø­Ù…Ø§ÙŠØ©: Ù„Ùˆ Ù…ÙÙŠØ´ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ùˆ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ØŒ Ù…ØªÙƒÙ…Ù„Ø´ Ø¹Ø´Ø§Ù† Ø§Ù„Ø³ÙŠØ³ØªÙ… Ù…ÙŠØ¹Ù„Ù‚Ø´
    if (!busyDaysData) return;
    const canvas = document.getElementById('busyDaysChart');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');

    // ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø´Ø§Ø±Øª Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¨Ø£Ù…Ø§Ù†
    if (myDaysChart) {
        myDaysChart.destroy();
        myDaysChart = null;
    }

    let dataset = [], label = "", color = "";
    
    // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø¹Ø¯Ø¯ ÙˆÙ„Ø§ Ø±Ø¨Ø­)
    if (metric === 'count') { 
        dataset = busyDaysData.counts; 
        label = 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª'; 
        color = '#3b82f6'; 
    } else if (metric === 'profit') { 
        dataset = busyDaysData.profits; 
        label = 'Ø§Ù„Ø±Ø¨Ø­'; 
        color = '#10b981'; 
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ø§Ø±Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯
    myDaysChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: busyDaysData.labels, // ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯"...]
            datasets: [{
                label: label,
                data: dataset,
                backgroundColor: color,
                borderRadius: 4,
                barPercentage: 0.6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            animation: { duration: 500 }, // ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
            scales: {
                y: { beginAtZero: true, grid: { display: false } },
                x: { grid: { display: false } }
            },
            plugins: { legend: { display: false } }
        }
    });
}

function loadPeakHoursChart() {
    const canvas = document.getElementById('peakHoursChart');
    if (!canvas) return; // Ø­Ù…Ø§ÙŠØ©
    
    const ctx = canvas.getContext('2d');
    const dateFilter = document.getElementById('peakDateFilter').value;
    const titleEl = document.getElementById('peakChartTitle');

    if (myPeakChart) myPeakChart.destroy();
    if(titleEl) titleEl.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...";

    google.script.run.withSuccessHandler(data => {
        if (!data || !data.success || data.values.length === 0) {
             if(titleEl) titleEl.innerHTML = `<span class="text-danger small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªÙˆÙ‚ÙŠØª</span>`;
             return; 
        }
        if(titleEl) titleEl.innerText = dateFilter ? `ØªÙˆØ²ÙŠØ¹ ÙŠÙˆÙ…: ${dateFilter}` : "ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¹Ø§Øª (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ)";
        
        let gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, '#ef4444'); gradient.addColorStop(1, '#fee2e2'); 

        myPeakChart = new Chart(ctx, {
            type: 'bar',
            data: { labels: data.labels, datasets: [{ label: 'Ø¹Ù…Ù„ÙŠØ§Øª', data: data.values, backgroundColor: gradient, borderRadius: 4 }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true }, x: { grid: { display: false } } }, plugins: { legend: { display: false } } }
        });
    }).getPeakHoursData(dateFilter);
}
	// 3. Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù (Top Dates)
	function loadTopDates() {
		google.script.run.withSuccessHandler(list => {
			let html = '';
			list.forEach((item, index) => {
				let icon = index === 0 ? 'ğŸ‘‘' : `#${index + 1}`;
				html += `<li class="list-group-item d-flex justify-content-between align-items-center">
					<span>${icon} ${item[0]}</span>
					<span class="fw-bold text-success english-num">+${item[1].toLocaleString()}</span>
				</li>`;
			});
			document.getElementById('topDatesList').innerHTML = html;
		}).getTopDatesLeaderboard();
	}

	// 1. Ø¯Ø§Ù„Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ§ÙŠÙ… Ù„Ø§ÙŠÙ†)
	function loadZReport() {
		const dFrom = document.getElementById('zDateFrom');
		const dTo = document.getElementById('zDateTo');
		
		if (!dFrom) return;
		if (!dFrom.value) dFrom.valueAsDate = new Date();
		
		document.getElementById('zReportResult').style.display = 'none';
		showToast("â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...", true);

		google.script.run.withSuccessHandler(rep => {
			document.getElementById('zReportResult').style.display = 'block';
			document.getElementById('zIn').innerText = rep.totalIn.toLocaleString();
			document.getElementById('zOut').innerText = rep.totalOut.toLocaleString();
			document.getElementById('zProf').innerText = rep.totalProfit.toLocaleString();

			// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (ÙƒÙ…Ø§ Ù‡Ùˆ)
			let userHtml = '';
			for (const [user, stats] of Object.entries(rep.usersStats)) {
				let initial = user.charAt(0).toUpperCase();
				userHtml += `
				<div class="user-stat-row">
					<div class="d-flex align-items-center gap-2">
						<div style="width:32px; height:32px; background:#e0e7ff; color:#4338ca; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:12px;">${initial}</div>
						<div><div class="fw-bold small text-dark">${user}</div><div class="text-muted" style="font-size:10px;">${stats.opsCount} Ø¹Ù…Ù„ÙŠØ©</div></div>
					</div>
					<div class="text-end"><div class="text-success fw-bold english-num small">+${stats.profit.toLocaleString()}</div></div>
				</div>`;
			}
			document.getElementById('zUsersTable').innerHTML = userHtml || '<div class="text-center small text-muted py-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div>';

			// ğŸ”¥ Ø±Ø³Ù… Ù‚Ø§Ø¦Ù…Ø© "Ø£Ù‡Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª" Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Timeline Style)
			let transHtml = '';
			if (rep.topTransactions && rep.topTransactions.length > 0) {
				rep.topTransactions.forEach(t => {
					let isOut = t.type.includes('Ø³Ø­Ø¨') || t.type.includes('Ø¯ÙØ¹') || t.type.includes('ØµØ§Ø¯Ø±');
					let typeClass = isOut ? 'type-out' : 'type-in';
					let iconClass = isOut ? 'icon-out' : 'icon-in';
					let icon = isOut ? 'fa-arrow-up' : 'fa-arrow-down';
					let amountColor = isOut ? 'text-danger' : 'text-success';

					transHtml += `
					<div class="trans-item ${typeClass}">
						<div class="d-flex align-items-center">
							<div class="trans-icon ${iconClass}"><i class="fa ${icon}"></i></div>
							<div class="trans-details me-2">
								<h6>${t.type}</h6>
								<span>${t.fullDate || 'Ø§Ù„ÙŠÙˆÙ…'} â€¢ ${t.user.split(' ')[0]}</span>
							</div>
						</div>
						<div class="trans-amount ${amountColor} english-num">${t.amount.toLocaleString()}</div>
					</div>`;
				});
			} else {
				transHtml = '<div class="text-center text-muted p-4"><i class="fa fa-inbox fa-2x mb-2 opacity-50"></i><br>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª ÙƒØ¨Ø±Ù‰</div>';
			}
			document.getElementById('topTransList').innerHTML = transHtml;

		}).getDailyClosingReport(dFrom.value, dTo.value);
	}

	// 2. Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ (Ø§Ù„ÙƒØ±ÙˆØª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©)
	function loadWalletIntel() {
		const container = document.getElementById('walletGridArea');
		if(!container) return;
		container.innerHTML = '<div class="col-12 text-center p-5"><i class="fa fa-spinner fa-spin text-muted"></i></div>';

		google.script.run.withSuccessHandler(data => {
			if(!data || data.length === 0) {
				container.innerHTML = '<div class="col-12 text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div>';
				return;
			}
			
			let html = '';
			data.forEach(w => {
				let isActive = w.txCount > 5;
				let dotClass = isActive ? 'dot-on' : 'dot-off';
				let icon = w.name.includes('ÙÙˆØ¯Ø§ÙÙˆÙ†') ? 'fa-mobile-alt' : 'fa-wallet';
				
				html += `
				<div class="wallet-card-pro">
					<div class="wc-dot ${dotClass}" title="${isActive ? 'Ù†Ø´Ø·Ø©' : 'Ø®Ø§Ù…Ù„Ø©'}"></div>
					<div class="wc-head">
						<div class="wc-info">
							<h5>${w.name}</h5>
							<span class="english-num">${w.txCount} Ø¹Ù…Ù„ÙŠØ©</span>
						</div>
						<div class="wc-icon"><i class="fa ${icon}"></i></div>
					</div>
					<div class="wc-balance">
						<small style="font-size:10px; font-weight:normal; color:var(--text-muted);">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</small>
						<span class="text-success">+${w.totalProfit.toLocaleString()}</span>
					</div>
					<div class="wc-footer">
						<div class="wc-stat">Ø­Ø¬Ù… ØªØ¯Ø§ÙˆÙ„<b>${(w.totalVol/1000).toFixed(1)}k</b></div>
						<div class="wc-stat" style="border-right:1px solid var(--border-color); padding-right:10px;">Ù…ØªÙˆØ³Ø·<b>${Math.round(w.totalProfit/(w.txCount||1))}</b></div>
					</div>
				</div>`;
			});
			container.innerHTML = html;
		}).getWalletIntelligence('ALL');
	}// 2. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠ (Ù…Ø¹ Ø£Ù‡Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØªÙˆØ³ÙŠØ· Ø§Ù„Ù†ÙˆØ¹)
function loadPnLCharts() {
    const ctxP = document.getElementById('profitChart');
    const ctxE = document.getElementById('expensesChart');
    if (!ctxP || !ctxE) return; // Ø­Ù…Ø§ÙŠØ©

    if(myProfitChart) { myProfitChart.destroy(); myProfitChart = null; }
    if(myExpChart) { myExpChart.destroy(); myExpChart = null; }

    google.script.run.withSuccessHandler(data => {
        if (!data.success) return;

        myProfitChart = new Chart(ctxP.getContext('2d'), {
            type: 'line',
            data: { labels: data.dates, datasets: [{ label: 'Ø§Ù„Ø±Ø¨Ø­', data: data.profits, borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.1)', fill: true, tension: 0.3 }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true }, x: { grid: { display: false } } } }
        });
        
        myExpChart = new Chart(ctxE.getContext('2d'), {
            type: 'doughnut',
            data: { labels: data.expensesLabels, datasets: [{ data: data.expensesValues, backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#6366f1', '#8b5cf6'], borderWidth: 0 }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { font: { size: 10 } } } } }
        });
    }).getPnLChartData();
}

function confirmDelete(rowId, type, amount, wallet, comm, client) {
    // 1. Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯
    if (!confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆØ§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† ØªØ£Ø«ÙŠØ±Ù‡Ø§ Ø§Ù„Ù…Ø§Ù„ÙŠØŸ\n\nØ³ÙŠØªÙ… Ø¹ÙƒØ³ Ø§Ù„Ø±ØµÙŠØ¯ ÙˆØ§Ù„Ù„ÙŠÙ…ÙŠØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.")) {
        return; // Ù„Ùˆ Ø¶ØºØ· Cancel Ù†Ø®Ø±Ø¬
    }

    // 2. Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ¯ÙŠÙ†Ø¬ Ø¨Ø³ÙŠØ· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    showToast("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ©...", "info");

    // 3. Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± (Code.js)
    google.script.run
        .withSuccessHandler(function(response) {
            if (response.success) {
                showToast(response.msg, "success"); // Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
                updateHistory(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ø´Ø§Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØªØ®ØªÙÙŠ
                updateCards();   // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ±ÙˆØª (Ø§Ù„Ø£Ø±ØµØ¯Ø©)
            } else {
                alert(response.msg); // Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ (Ù…Ø«Ù„Ø§ Ù„Ùˆ Ù…Ø´ Ø£Ø¯Ù…Ù†)
            }
        })
        .withFailureHandler(function(e) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: " + e);
        })
        .autoRollback(rowId, type, amount, wallet, comm, client); // Ù‡Ù†Ø§ Ø¨Ù†Ù†Ø§Ø¯ÙŠ Ø¯Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±
}

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ÙØªØ­ Ø§Ù„ØªÙØ§ØµÙŠÙ„ (Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø§Ø³Ù… ØµØ­ÙŠØ­ Ø£ÙŠØ¶Ø§Ù‹)
function openDetailsWrapper(btn) {
    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®ÙÙŠØ© Ø¨Ø¬ÙˆØ§Ø± Ø§Ù„Ø²Ø±
    let dataDiv = btn.parentElement.nextElementSibling || btn.nextElementSibling;
    
    // Ø­Ù„ Ø¨Ø¯ÙŠÙ„ Ù„Ùˆ Ø§Ù„Ø²Ø±Ø§Ø± Ø¬ÙˆÙ‡ div
    if (!dataDiv || !dataDiv.classList.contains('row-data')) {
         dataDiv = btn.parentElement.querySelector('.row-data');
    }
    
    if (dataDiv) {
        let data = JSON.parse(dataDiv.innerHTML);
        // Ù†Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (openTxModal)
        openTxModal(data.id, data.date, data.type, data.amount, data.profit, data.wallet, data.client, data.user);
    }
}
// ----------------------------------------------------
    // Ø¯Ø§Ù„Ø© ØªØ¹Ø¯ÙŠÙ„ ÙˆØ³Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© (Tag)
    // ----------------------------------------------------
    function editWalletTag(row, currentTag) {
        // Ø±Ø³Ø§Ù„Ø© ØªØ·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙ„Ù…Ø©
        let newTag = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø© (Tag) Ø§Ù„ØªÙŠ Ø³ØªØ¸Ù‡Ø± Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ù…Ø­ÙØ¸Ø©:", currentTag);
        
        // Ø¥Ø°Ø§ Ø¶ØºØ· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "Ø¥Ù„ØºØ§Ø¡" Ù†ÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
        if (newTag === null) return; 
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø±
        showToast("Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„ÙˆØ³Ù…...", true);

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø³ÙŠØ±ÙØ± (Code.js)
        google.script.run.withSuccessHandler(res => {
            showToast(res.msg, res.success);
            if (res.success) {
                loadAccountsTable(); // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø¹Ø´Ø§Ù† Ø§Ù„ÙˆØ³Ù… ÙŠØ¸Ù‡Ø±
                renderPinnedWallets(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø«Ø¨ØªØ© ÙÙˆÙ‚
            }
        }).saveWalletTag(row, newTag);
    }
    // ----------------------------------------------------
// Ø¯Ø§Ù„Ø© Ø±Ø³Ù… Ø§Ù„ÙƒØ±ÙˆØª (Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
// ----------------------------------------------------
function renderWalletsCards() {
    const container = document.getElementById('walletsContainer');
    if (!container) return;

    container.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-warning" role="status"></div><p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸...</p></div>';

    google.script.run.withSuccessHandler(data => {
        let html = '';
        if (!data || data.length === 0) {
            container.innerHTML = '<div class="alert alert-info text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙØ¸.</div>';
            return;
        }

        data.forEach(r => {
            let cardColor = r.color || "#6c757d"; 
            
            // --- ğŸ’¡ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø·ÙˆÙ„ (Ø§Ù„ÙˆØ³Ù… Ø§Ù„ÙˆÙ‡Ù…ÙŠ) ---
            let tagBadge = '';
            if (r.tag && r.tag.trim() !== "") {
                tagBadge = `<div style="background-color: ${cardColor}; color: #fff; padding: 2px 8px; border-radius: 8px; font-size: 10px; font-weight: bold; width: 100%; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">${r.tag}</div>`;
            } else {
                // ÙˆØ³Ù… Ø´ÙØ§Ù ØªÙ…Ø§Ù…Ø§Ù‹ Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø¹Ø´Ø§Ù† Ø§Ù„ÙƒØ§Ø±Øª Ù…ÙŠÙƒØ´Ø´
                tagBadge = `<div style="background-color: transparent; padding: 2px 8px; border-radius: 8px; font-size: 10px; width: 100%; visibility: hidden;">&nbsp;</div>`;
            }

            html += `
            <div class="col-12 col-md-6 col-lg-4 mb-3">
                <div class="card shadow-sm border-0 h-100" style="border-top: 5px solid ${cardColor} !important; min-height: 230px;">
                    <div class="card-body d-flex flex-column justify-content-between p-3">
                        
                        <div class="d-flex flex-column align-items-center mb-2" style="min-height: 55px; gap: 5px;">
                            <div style="font-size: 14px; font-weight: 800; color: var(--text-main); text-align: center;">
                                <i class="fa fa-bolt text-primary small me-1"></i>${r.name}
                            </div>
                            ${tagBadge}
                        </div>

                        <div class="text-center my-2">
                            <h2 class="fw-bold text-dark mb-0 english-num" style="font-size: 1.8rem;">${Number(r.balance).toLocaleString()}</h2>
                            <small class="text-muted" style="font-size: 10px;">Ø¬.Ù…</small>
                        </div>

                        <div class="bg-light p-2 rounded mb-3 border">
                            <div class="d-flex justify-content-between text-muted" style="font-size: 10px;">
                                <span>ğŸ“… ÙŠÙˆÙ…ÙŠ: <b class="english-num text-dark">${Number(r.lo).toLocaleString()}</b></span>
                                <span style="border-right: 1px solid #ddd; margin: 0 5px;"></span>
                                <span>ğŸ—“ï¸ Ø´Ù‡Ø±ÙŠ: <b class="english-num text-dark">${Number(r.lm).toLocaleString()}</b></span>
                            </div>
                        </div>

                        <div class="d-flex gap-2 border-top pt-3">
                            <button class="btn btn-outline-primary btn-sm flex-grow-1 fw-bold" onclick="openEditModal(${r.row}, '${r.name}', ${r.lo}, ${r.li}, ${r.lm})">
                                <i class="fa-solid fa-pen"></i> ØªØ¹Ø¯ÙŠÙ„
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="openTagModal(${r.row}, '${r.tag || ""}', '${r.color || ""}')">
                                <i class="fa-solid fa-paintbrush"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>`;
        });
        container.innerHTML = html;
    }).getAllAccountsData();
}
// ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¸Ù‡Ø±
// Ø¯Ø§Ù„Ø© ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù„ÙˆÙ† ÙˆØ§Ù„ÙˆØ³Ù…
function openTagModal(id, currentTag, currentColor) {
    document.getElementById('tagRow').value = id; // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù€ ID Ù‡Ù†Ø§
    document.getElementById('tagInput').value = currentTag || "";
    document.getElementById('tagColorInput').value = currentColor || "#6c757d";
    document.getElementById('tagModal').style.display = 'flex';
}
// Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸
function saveTagSettings() {
    const row = Number(document.getElementById('tagRow').value);
    const tag = document.getElementById('tagInput').value;
    const color = document.getElementById('tagColorInput').value;
    
    setLoading('btnSaveTag', true);
    google.script.run.withSuccessHandler(res => {
        setLoading('btnSaveTag', false);
        document.getElementById('tagModal').style.display = 'none';
        showToast(res.msg, res.success);
        
        if (res.success) { 
            // ğŸ‘‡ Ø£Ù‡Ù… Ø³Ø·Ø±: Ø¨ÙŠØ¨Ø¹Øª Ø¥Ø´Ø§Ø±Ø© Ù„ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¥Ù† ÙÙŠÙ‡ "Ø£ÙƒØ´Ù†" Ø­ØµÙ„
            google.script.run.triggerSyncUpdate(); 
            
            renderWalletsCards();
            loadAccountsTable();
            renderPinnedWallets();
        }
    }).updateWalletAppearance(row, tag, color);
}
function resetTagSettings() {
    if(!confirm("âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„ØªØ®ØµÙŠØµ (Ø§Ù„Ù„ÙˆÙ† ÙˆØ§Ù„ÙˆØ³Ù…) Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­ÙØ¸Ø©ØŸ")) return;
    
    const row = Number(document.getElementById('tagRow').value);
    
    // ØªØµÙÙŠØ± Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    document.getElementById('tagInput').value = "";
    document.getElementById('tagColorInput').value = "#6c757d"; // Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠ

    setLoading('btnSaveTag', true);

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ÙØ§Ø±ØºØ© Ù„Ù„Ø³ÙŠØ±ÙØ± Ù„Ù…Ø³Ø­Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¹Ù…ÙˆØ¯ 14 Ùˆ 15
    google.script.run.withSuccessHandler(res => {
        setLoading('btnSaveTag', false);
        document.getElementById('tagModal').style.display = 'none';
        showToast("âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ù…Ø¸Ù‡Ø± Ø§Ù„Ù…Ø­ÙØ¸Ø©", true);
        
        if (res.success) {
            renderWalletsCards();   // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ±ÙˆØª ÙÙˆØ±Ø§Ù‹
            loadAccountsTable();    // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙÙˆØ±Ø§Ù‹
            renderPinnedWallets();  // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø³Ø±ÙŠØ¹
        }
    }).updateWalletAppearance(row, "", ""); // Ø¥Ø±Ø³Ø§Ù„ ÙØ±Ø§ØºØ§Øª Ù„Ù„Ù…Ø³Ø­
}
// --- ğŸ”„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Sync) ---
// Ø¯Ù‡ Ù‡ÙŠØ®Ù„ÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ±Ø§Ø¬Ø¹ Ø§Ù„Ø´ÙŠØª ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ ÙˆÙŠØ¬ÙŠØ¨ Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª (Ø£Ù„ÙˆØ§Ù†ØŒ ØªØ«Ø¨ÙŠØªØŒ Ø±ØµÙŠØ¯)
function setUpdateSignal() {
  // ØªØ®Ø²ÙŠÙ† ÙˆÙ‚Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¤Ù‚ØªØ©
  PropertiesService.getScriptProperties().setProperty('LAST_CHANGE', new Date().getTime());
}

function checkUpdateSignal(clientTime) {
  const lastChange = PropertiesService.getScriptProperties().getProperty('LAST_CHANGE');
  // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙˆÙ‚Øª Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£Ø­Ø¯Ø«ØŒ Ù†Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„ØªØ­Ø¯ÙŠØ«
  return lastChange && lastChange !== clientTime ? lastChange : null;
}
let myLastKey = null;

// ÙØ­Øµ Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹ (ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ) Ù„Ø®Ù„ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø³ Ù…Ø´ Ø¨ÙŠØªÙ‚Ù„ Ø§Ù„Ø¬Ù‡Ø§Ø²
setInterval(function() {
    google.script.run.withSuccessHandler(serverKey => {
        if (myLastKey === null) {
            myLastKey = serverKey;
            return;
        }
        
        // Ù„Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ø®ØªÙ„ÙØŒ ÙŠØ¹Ù†ÙŠ ÙÙŠÙ‡ Ø­Ø¯ Ø¯Ø§Ø³ "Ø­ÙØ¸"
        if (serverKey !== myLastKey) {
            myLastKey = serverKey;
            console.log("âš¡ Ø¥Ø´Ø§Ø±Ø© ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø±Ø¯Ø©.. Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©");
            renderPinnedWallets(); // Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ­ØµÙ„ Ù‡Ù†Ø§ "Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©" Ø¨Ø³
        }
    }).getGlobalSyncKey();
}, 60000);


// 1. Ø¯Ø§Ù„Ø© ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
let searchTimeout = null;

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
function executeAdvancedSearch() {
    const text = document.getElementById('advSearchText').value.trim();
    const type = document.getElementById('advSearchType').value;
    const dFrom = document.getElementById('advDateFrom').value;
    const dTo = document.getElementById('advDateTo').value;

    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙÙ„Ø§ØªØ± ÙØ§Ø±ØºØ©ØŒ Ø§Ø±Ø¬Ø¹ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø¢Ø®Ø± 50 Ø¹Ù…Ù„ÙŠØ©)
    if (!text && !type && !dFrom && !dTo) {
        loadTimelineData();
        return;
    }

    // "Debounce" Ù„Ù…Ù†Ø¹ Ø¶ØºØ· Ø§Ù„Ø³ÙŠØ±ÙØ± Ù…Ø¹ ÙƒÙ„ Ø­Ø±Ù
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
        const container = document.getElementById('timelineContainer');
        container.innerHTML = `<tr><td colspan="8" class="text-center p-4"><i class="fa fa-sync fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ÙƒØ§Ù…Ù„ Ø§Ù„Ø¯ÙØªØ±...</td></tr>`;

        google.script.run.withSuccessHandler(data => {
            window.timelineGlobalData = data; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØµÙÙˆÙØ© Ø¨Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            renderTimeline(data);
            
            const countDiv = document.getElementById('rowsCountDisplay');
            if (data.length > 0) {
                countDiv.innerHTML = `<span class="text-primary fw-bold">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data.length} Ø¹Ù…Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ÙƒØ§Ù…Ù„</span>`;
            } else {
                countDiv.innerHTML = `<span class="text-danger fw-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© ÙÙŠ ÙƒØ§Ù…Ù„ Ø§Ù„Ø³Ø¬Ù„</span>`;
            }
        }).searchAllLogsServer(text, type, dFrom, dTo); // Ø·Ù„Ø¨ Ø§Ù„Ø¨Ø­Ø« Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
    }, 500); 
}

// Ø¥ØµÙ„Ø§Ø­ Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† (Reset)
function resetAdvancedSearch() {
    document.getElementById('advSearchText').value = '';
    document.getElementById('advSearchType').value = '';
    document.getElementById('advDateFrom').value = '';
    document.getElementById('advDateTo').value = '';
    document.getElementById('dateFilterSection').style.display = 'none';
    
    // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø¹Ø±Ø¶ Ø¢Ø®Ø± 50 Ø¹Ù…Ù„ÙŠØ©
    loadTimelineData(); 
    showToast("ØªÙ…Øª Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø¹Ø±Ø¶ Ø¢Ø®Ø± 50 Ø¹Ù…Ù„ÙŠØ©", true);
}

function toggleDateFilters() {
    const sec = document.getElementById('dateFilterSection');
    if (sec.style.display === 'none') {
        sec.style.display = 'flex';
    } else {
        sec.style.display = 'none';
        // ØªØµÙÙŠØ± Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø®ÙØ§Ø¡
        document.getElementById('advDateFrom').value = '';
        document.getElementById('advDateTo').value = '';
        executeAdvancedSearch(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
    }
}
// 1. ØªØ¹Ø±ÙŠÙ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„ÙƒÙ„ Ø®Ø¯Ù…Ø©
const serviceMap = {
    'client_withdraw': {
        title: 'Ø³Ø­Ø¨ Ù…Ù† Ø¹Ù…ÙŠÙ„ (ØªØ²ÙˆÙŠØ¯ Ø´Ø±ÙƒØ©)',
        providers: ['ÙÙˆØ±ÙŠ', 'Ù…ÙƒØ³Ø¨', 'Ù…Ø´ØªØ±ÙŠØ§Øª']
    },
    'pay_bill': {
        title: 'Ø¯ÙØ¹ ÙØ§ØªÙˆØ±Ø©', // Ø³ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù… Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø­Ø³Ø¨ Ø§Ù„Ø´Ø±ÙƒØ©
        providers: ['ÙÙˆØ±ÙŠ', 'Ù…ÙƒØ³Ø¨', 'Ù…Ø´ØªØ±ÙŠØ§Øª']
    },
    'cash_supply': {
        title: 'Ø³Ø­Ø¨ ÙƒØ§Ø´ (ØªØ²ÙˆÙŠØ¯)', // Ø³ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù… Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø­Ø³Ø¨ Ø§Ù„Ø´Ø±ÙƒØ©
        providers: ['ÙÙˆØ±ÙŠ', 'Ù…ÙƒØ³Ø¨'] // Ù…Ø´ØªØ±ÙŠØ§Øª Ø¹Ø§Ø¯Ø© Ù„Ø§ ØªØ¯Ø¹Ù… Ø³Ø­Ø¨ ÙƒØ§Ø´ ÙƒØ®Ø¯Ù…Ø© ØªØ²ÙˆÙŠØ¯ Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©ØŒ Ø¹Ø¯Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø­Ø³Ø¨ Ø±ØºØ¨ØªÙƒ
    },
    'visa_withdraw': {
        title: 'Ø³Ø­Ø¨ ÙÙŠØ²Ø§',
        providers: ['ÙÙˆØ±ÙŠ'] // Ø¹Ø§Ø¯Ø© Ù…Ø§ÙƒÙŠÙ†Ø§Øª ÙÙˆØ±ÙŠ ÙÙ‚Ø·ØŒ Ø£Ø¶Ù Ù…ÙƒØ³Ø¨ Ù„Ùˆ Ù…ØªØ§Ø­
    }
};

// 2. Ø¯Ø§Ù„Ø© ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
function openProviderSelect(serviceKey) {
    const config = serviceMap[serviceKey];
    if (!config) return;

    document.getElementById('selectedServiceKey').value = serviceKey;
    const grid = document.getElementById('providerButtonsGrid');
    grid.innerHTML = ''; // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©

    config.providers.forEach(prov => {
        const btn = document.createElement('button');
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„Ø§Ø³ ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©
        let btnClass = 'btn-secondary';
        let icon = 'fa-building';
        
        if (prov === 'ÙÙˆØ±ÙŠ') { btnClass = 'btn-fawry'; icon = 'fa-bolt'; }
        else if (prov === 'Ù…ÙƒØ³Ø¨') { btnClass = 'btn-maksab'; icon = 'fa-rocket'; }
        else if (prov === 'Ù…Ø´ØªØ±ÙŠØ§Øª') { btnClass = 'btn-moshtrayat'; icon = 'fa-shopping-cart'; }

        btn.className = `provider-btn ${btnClass}`;
        btn.innerHTML = `<span><i class="fa ${icon} me-2"></i> ${prov}</span> <i class="fa fa-chevron-left opacity-50"></i>`;
        
        // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·ØŒ Ù†Ù†ÙØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆÙ†ØºÙ„Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
        btn.onclick = function() {
            confirmProviderSelection(serviceKey, prov);
        };

        grid.appendChild(btn);
    });

    document.getElementById('providerModal').style.display = 'flex';
}

// 3. Ø¯Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ÙˆØªÙ†ÙÙŠØ° setOp
function confirmProviderSelection(serviceKey, provider) {
    let opTitle = "";

    // Ø¨Ù†Ø§Ø¡ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙˆØ¬ÙŠÙƒ Ø§Ù„Ù‚Ø¯ÙŠÙ…
    switch (serviceKey) {
        case 'client_withdraw':
            opTitle = 'Ø³Ø­Ø¨ Ù…Ù† Ø¹Ù…ÙŠÙ„ (ØªØ²ÙˆÙŠØ¯ Ø´Ø±ÙƒØ©)';
            break;
        case 'pay_bill':
            opTitle = provider === 'Ù…ÙƒØ³Ø¨' ? 'Ø¯ÙØ¹ ÙØ§ØªÙˆØ±Ø© (ØµØ§Ø¯Ø± Ù…Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©)' : 'Ø¯ÙØ¹ ÙØ§ØªÙˆØ±Ø© ';
            break;
        case 'cash_supply':
            opTitle = provider === 'Ù…ÙƒØ³Ø¨' ? 'Ø³Ø­Ø¨ ÙƒØ§Ø´ (ØªØ²ÙˆÙŠØ¯ Ù…ÙƒØ³Ø¨)' : 'Ø³Ø­Ø¨ ÙƒØ§Ø´ (ØªØ²ÙˆÙŠØ¯ ÙÙˆØ±ÙŠ)';
            break;
        case 'visa_withdraw':
            opTitle = 'Ø³Ø­Ø¨ ÙÙŠØ²Ø§ (Ù…Ø§ÙƒÙŠÙ†Ø© ÙÙˆØ±ÙŠ)';
            break;
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
    closeProviderModal();

    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„ØªÙ…ÙŠÙŠØ²Ù‡ ÙƒÙ€ active (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    // Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„ÙƒØ±ÙˆØª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø­Ø°ÙØªØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ ØªÙ…Ø±ÙŠØ± null Ø£Ùˆ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø°ÙŠ ØªÙ… Ø§Ù„Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡
    // Ù„ÙƒÙ† setOp ØªØ­ØªØ§Ø¬ element Ù„ØªØ¶ÙŠÙ Ø¹Ù„ÙŠÙ‡ active class. 
    // Ù„Ù„ØªØ¨Ø³ÙŠØ·ØŒ Ø³Ù†Ù…Ø±Ø± null ÙˆØ§Ù„Ù€ setOp Ø³ØªØ¹Ù…Ù„ØŒ Ù„ÙƒÙ† Ù„Ù† ÙŠØ¸Ù‡Ø± Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ø¹Ù„Ù‰ ÙƒØ§Ø±Øª Ø§Ù„Ø®Ø¯Ù…Ø© (ÙˆÙ‡Ø°Ø§ Ø£ÙØ¶Ù„ Ù„Ø£Ù†Ù‡ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡ ÙˆØ§Ù†ØªÙ‡Ù‰)
    
    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© setOp Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ ÙƒÙˆØ¯Ùƒ
    // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù…Ø±Ø±Ù†Ø§ document.body ÙƒØ¹Ù†ØµØ± Ù…Ø¤Ù‚Øª Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ØŒ Ø£Ùˆ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ setOp Ù„ØªÙ‚Ø¨Ù„ null
    setOp(opTitle, provider, document.querySelector(`.op-card[onclick*="${serviceKey}"]`) || document.body);
    
    // ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØªØ±ÙƒÙŠØ² Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ø¨Ø§Ø´Ø±Ø© Ù„ØªØ¬Ø±Ø¨Ø© Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙØ¶Ù„
    setTimeout(() => document.getElementById('amount').focus(), 100);
}

function closeProviderModal() {
    document.getElementById('providerModal').style.display = 'none';
}
function showAuditDetails(fullNote) {
  const match = fullNote.match(/\[(REF.*?)\]/);
  if (!match) return;
  const refId = match[1];

  const modalElem = document.getElementById('auditModal');
  const auditBody = document.getElementById('auditBody');

  // Ø®Ø·ÙˆØ© Ù‡Ø§Ù…Ø©: Ù†Ù‚Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù„ÙŠÙƒÙˆÙ† Ø§Ø¨Ù† Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù€ body Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø³Ø¬Ù† Ø®Ù„Ù Ø§Ù„Ø¹Ù†Ø§ØµØ±
  document.body.appendChild(modalElem);

  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù„ÙˆØ¯Ù†Ø¬
  auditBody.innerHTML = '<div class="text-center p-4"><div class="spinner-border text-primary"></div></div>';

  // ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹
  try {
    const myModal = bootstrap.Modal.getOrCreateInstance(modalElem);
    myModal.show();
  } catch (e) {
    // Ø­Ù„ Ø¨Ø¯ÙŠÙ„ ÙŠØ¯ÙˆÙŠ ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ Ø§Ù„Ù…ÙƒØªØ¨Ø©
    modalElem.style.display = 'block';
    modalElem.classList.add('show');
    document.body.classList.add('modal-open');
    const backdrop = document.createElement('div');
    backdrop.className = 'modal-backdrop fade show';
    document.body.appendChild(backdrop);
  }

  // Ø·Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  google.script.run.withSuccessHandler(function(details) {
    if (!details || details.length === 0) {
      auditBody.innerHTML = '<div class="text-center p-3 text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ØªØ­Ù„ÙŠÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</div>';
      return;
    }

    let html = '';
    details.forEach(item => {
      let isPos = item.change >= 0;
      html += `
        <div class="card mb-3 border-0 shadow-sm">
          <div class="card-body p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="fw-bold text-dark">${item.account}</span>
              <span class="badge ${isPos ? 'bg-success' : 'bg-danger'} english-num" style="font-size:12px;">
                ${isPos ? '+' : ''}${item.change.toLocaleString()}
              </span>
            </div>
            <div class="row g-0 text-center border-top pt-2">
              <div class="col-6 border-end">
                <small class="text-muted d-block">Ù‚Ø¨Ù„</small>
                <span class="english-num fw-bold text-secondary">${item.balBefore.toLocaleString()}</span>
              </div>
              <div class="col-6">
                <small class="text-muted d-block">Ø¨Ø¹Ø¯</small>
                <span class="english-num fw-bold text-primary">${item.balAfter.toLocaleString()}</span>
              </div>
            </div>
          </div>
        </div>`;
    });
    auditBody.innerHTML = html;
  }).getTransactionAuditDetails(refId);
}


// 3. Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
// 1. Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¹ÙŠÙ†
// Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
window.openSecureModal = function() {
    const icon = document.getElementById('mainEyeIcon');
    if (icon && icon.classList.contains('fa-eye-slash')) {
        document.getElementById('securePassModal').style.display = 'flex';
        document.getElementById('secureInput').value = '';
        document.getElementById('secureInput').focus();
    } else {
        applyVisibility(false);
    }
};

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚
window.verifySecurePass = function() {
    const input = document.getElementById('secureInput').value;
    if (input === "123") {
        applyVisibility(true);
        document.getElementById('securePassModal').style.display = 'none';
    } else {
        alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø·Ø£!");
    }
};

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ù„Ø¥Ø®ÙØ§Ø¡
window.applyVisibility = function(show) {
    const items = document.querySelectorAll('.secure-item');
    const icon = document.getElementById('mainEyeIcon');
    items.forEach(el => {
        el.innerText = show ? el.getAttribute('data-real') : "****";
    });
    if (icon) {
        if (show) icon.classList.replace('fa-eye-slash', 'fa-eye');
        else icon.classList.replace('fa-eye', 'fa-eye-slash');
    }
};
// Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª - ØªÙˆØ¶Ø¹ Ø¯Ø§Ø®Ù„ <script> ÙÙŠ Page.html
function calculateStats(accounts) {
    let stats = {
        compTotal: 0, 
        walletsTotal: 0, 
        cash: 0,
        clientsOweMe: 0, 
        clientsHave: 0,
        totalAvailable: 0, 
        grandTotal: 0,
        wallets: [], 
        companies: [], 
        clientsCards: [],
        exp: 0, monProf: 0, dayProf: 0 // Ù‡Ø°Ù‡ Ø³ØªØ­ØªØ§Ø¬ Ù„Ø¬Ù„Ø¨Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
    };

    accounts.forEach(acc => {
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø£Ø±Ù‚Ø§Ù… Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø­Ø¯ÙˆØ« Ø®Ø·Ø£ Ø­Ø³Ø§Ø¨ÙŠ
        const bal = parseFloat(acc.balance || 0);
        const tag = acc.tag ? acc.tag.trim() : "";

        // ØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù€ Tag Ø§Ù„Ù„ÙŠ ÙÙŠ Supabase
        if (acc.name && acc.name.includes("Ø§Ù„Ø®Ø²Ù†Ø©")) {
                    } else if (tag === "Ø´Ø±ÙƒØ©") {
            stats.compTotal += bal;
            stats.companies.push({ name: acc.name, bal: bal });
        } else if (tag === "Ù…Ø­ÙØ¸Ø©") {
            stats.walletsTotal += bal;
            stats.wallets.push(acc);
        } else if (tag === "Ø¹Ù…ÙŠÙ„") {
            if (bal < 0) {
                stats.clientsHave += Math.abs(bal);
            } else {
                stats.clientsOweMe += bal;
            }
            stats.clientsCards.push({ name: acc.name, bal: bal });
        }
    });

    // Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ø³ÙŠÙˆÙ„Ø©
        
    return stats;
}
 	</script>
		  </body>
		</html>
